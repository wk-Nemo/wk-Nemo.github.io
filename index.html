<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
<meta property="og:type" content="website">
<meta property="og:title" content="wkçš„åšå®¢">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="wkçš„åšå®¢">
<meta property="og:description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="wk">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>wkçš„åšå®¢</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">wkçš„åšå®¢</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">è®°å½•æŠ€æœ¯ã€å­¦ä¹ å’Œç”Ÿæ´»çš„åšå®¢</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wk"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">wk</p>
  <div class="site-description" itemprop="description">ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wk-Nemo" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;wk-Nemo" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.cn/user/3122268755465879" title="æ˜é‡‘ â†’ https:&#x2F;&#x2F;juejin.cn&#x2F;user&#x2F;3122268755465879" rel="noopener me" target="_blank">æ˜é‡‘</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/16/vite%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%EF%BC%88%E4%B8%8A%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/16/vite%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%EF%BC%88%E4%B8%8A%EF%BC%89/" class="post-title-link" itemprop="url">viteæ ¸å¿ƒåŸç†ï¼ˆä¸Šï¼‰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-05-16 09:30:09 / Modified: 09:57:44" itemprop="dateCreated datePublished" datetime="2023-05-16T09:30:09+08:00">2023-05-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/Vite/" itemprop="url" rel="index"><span itemprop="name">Vite</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>æ„å»ºå·¥å…·æ˜¯å‰ç«¯å¼€å‘ææ•ˆçš„é‡è¦å·¥å…·ï¼Œå®ƒæ‹¥æœ‰å„ç§å„æ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ€»ç»“ä¸ºä¸€æ¡å°±æ˜¯â€”â€”è§£å†³å‰ç«¯å·¥ç¨‹ä¸­çš„ç—›ç‚¹ã€‚å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¨¡å—åŠ è½½ï¼šæŒ‰ç…§åˆ¶å®šçš„æ¨¡å—è§„èŒƒï¼ŒåŠ è½½æ–‡ä»¶</li>
<li>è¯­æ³•è½¬è¯‘ï¼štsè½¬æ¢jsã€scssè½¬æ¢css</li>
<li>äº§ç‰©è´¨é‡ï¼šå‹ç¼©ä»£ç ã€ä»£ç æ£€æµ‹ã€tree-shaking</li>
<li>å¼€å‘æ•ˆç‡ï¼šçƒ­æ›´æ–°</li>
</ul>
<h2 id="1-æ¨¡å—åŒ–"><a href="#1-æ¨¡å—åŒ–" class="headerlink" title="1 æ¨¡å—åŒ–"></a>1 æ¨¡å—åŒ–</h2><blockquote>
<p>æ¨¡å—åŒ–è§„èŒƒ</p>
<p>æ„å»ºå·¥å…·è§£å†³çš„é—®é¢˜</p>
</blockquote>
<p>åœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè‡ªèº«å°±å…·å¤‡äº†å¾ˆå¥½çš„æ–‡ä»¶å’ŒåŒ…ç®¡ç†æœºåˆ¶ï¼Œé€šè¿‡importã€includeã€requireç­‰ç­‰å‘½ä»¤ï¼Œå¯ä»¥å¼•å…¥å…¶ä»–æ¨¡å—ã€åŒ…æˆ–è€…æ–‡ä»¶ã€‚è€Œjsæ—©æœŸè¢«è®¤å®šä¸ºç®€å•çš„ç½‘é¡µè„šæœ¬è¯­è¨€ï¼Œåšä¸€äº›ç®€å•çš„è¡¨å•éªŒè¯æˆ–åŠ¨ç”»ï¼Œé‚£æ—¶å€™çš„ä»£ç é‡è¿˜æ˜¯å¾ˆå°‘çš„ï¼Œå› æ­¤åªéœ€è¦å°†jså†™å…¥scriptæ ‡ç­¾å³å¯ã€‚ä½†æ˜¯éšç€å‰ç«¯å’Œjsçš„å¿«é€Ÿå‘å±•ï¼Œjsçš„ä»£ç è¶Šæ¥è¶Šå¤æ‚ï¼Œæ²¡æœ‰æ¨¡å—åŒ–ä¼šå¸¦æ¥å¾ˆå¤šçš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šä»£ç çš„å¤ç”¨æ€§ã€éš”ç¦»æ€§å’Œå¯ç»´æŠ¤æ€§ç­‰ã€‚ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p>
<p><strong>ä¸€ã€æ—©æœŸçš„æ¨¡å—åŒ–æ‰‹æ®µ</strong></p>
<p>æ—©æœŸæ¨¡å—åŒ–è¿˜æ²¡æœ‰è¯ç”Ÿæ—¶ï¼Œä¸šç•Œå°±å·²ç»äº§ç”Ÿäº†ä¸€äº›æ¨¡å—åŒ–å¼€å‘çš„æ‰‹æ®µâ€”â€”<strong>æ–‡ä»¶åˆ’åˆ†</strong></p>
<p>æ–‡ä»¶åˆ’åˆ†æ˜¯å°†åº”ç”¨çš„çŠ¶æ€å’Œé€»è¾‘åˆ†æ•£åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œæœ€åé€šè¿‡scriptæ ‡ç­¾å¼•å…¥ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// moudle-a.js</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;wukui&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// module-b.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">helloWorld</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;script src=&quot;./modlue-a.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;./modlue-b.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        console.log(name)</span><br><span class="line">        helloWorld()</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹å¼å­˜åœ¨å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><strong>ä¾èµ–ç®¡ç†ï¼š</strong>æ–‡ä»¶ä¹‹é—´å­˜åœ¨åŠ è½½é¡ºåºï¼Œå½“æ¨¡å—ä¹‹é—´ç›¸äº’ä¾èµ–æ—¶ï¼Œéšç€æ¨¡å—çš„å¢åŠ å¾ˆéš¾æ¢³ç†æ¸…æ¥šï¼Œè¿˜ä¼šäº§ç”Ÿè¿è¡Œæ—¶çš„é”™è¯¯</li>
<li><strong>éš”ç¦»æ€§ï¼š</strong>å„æ¨¡å—ä¹‹é—´çš„å˜é‡å‘½åä¼šäº§ç”Ÿå†²çª</li>
</ul>
<p><strong>äºŒã€è¶…å¤§æ–‡ä»¶çš„ç»´æŠ¤</strong></p>
<p>å½“ä»£ç è¡Œæ•°è¶Šæ¥è¶Šå¤šæ—¶ï¼Œé€æ¸å°±æ¼”å˜æˆäº†æˆ‘ä»¬å£ä¸­çš„ğŸ’©å±±ï¼Œä»£ç å˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç†è§£å’Œç»´æŠ¤ï¼Œå¯¹ç¨‹åºå‘˜é€ æˆäº†æå¤§çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚æ¨¡å—åŒ–å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡åˆç†çš„å±‚æ¬¡å’Œé€»è¾‘åˆ’åˆ†ï¼Œå¯ä»¥è®©ä»£ç ä¹‹é—´çš„å…³è”å˜å¾—æ¸…æ™°ï¼Œå•ä¸ªæ¨¡å—çš„èŒè´£æ˜ç¡®ï¼Œä»£ç é‡è‡ªç„¶å°±å°‘äº†ï¼Œå¯é˜…è¯»æ€§å’Œç»´æŠ¤æ€§ä¹Ÿéšä¹‹è€Œå‡ã€‚</p>
<p>ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p>
<p>ä»è¾ƒä¸ºå®è§‚çš„è§’åº¦æ¥çœ‹ï¼Œç°ä»£å‰ç«¯å¼€å‘æ¡†æ¶çš„æ¨¡å¼MVVM(Model-View-ViewModel)ï¼ŒModelå±‚ç”±åç«¯æ§åˆ¶ï¼ŒViewå±‚ç”±æ¡†æ¶æ¥æ§åˆ¶ï¼Œå› æ­¤å¼€å‘äººå‘˜ä¸éœ€è¦å…³æ³¨æ•°æ®æ•°æ®çš„ä¸šåŠ¡é€»è¾‘å’ŒDOMçš„æ“ä½œï¼Œåªéœ€è¦ä¸“æ³¨äºViewModelå¤„ç†ç›¸åº”çš„æ•°æ®çš„çŠ¶æ€å³å¯ã€‚æå¤§çš„ä¿ƒè¿›äº†å‰åç«¯çš„åˆ†ç¦»ï¼Œä¹Ÿæå‡äº†å‰ç«¯çš„å¼€å‘æ•ˆç‡ã€‚</p>
<p>å†ç»†ç²’åº¦çš„æ¥çœ‹ï¼Œä¼šæœ‰ä¸€äº›çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå¸®åŠ©æˆ‘ä»¬å°†ViewModelåˆ†ä¸ºæœåŠ¡å±‚å’Œé€»è¾‘å±‚ã€‚æœåŠ¡å±‚ä¸“æ³¨äºå’Œåç«¯çš„äº¤äº’ï¼Œé€šè¿‡ajaxæ‹¿åˆ°åç«¯çš„æ•°æ®ã€‚é€»è¾‘å±‚è´Ÿè´£å¤„ç†æ•°æ®ï¼Œå®ƒä¸å…³å¿ƒå¦‚ä½•è·å–æ•°æ®ï¼Œåªéœ€è¦å…³æ³¨æ•°æ®çš„çŠ¶æ€å˜åŒ–ã€‚</p>
<p>é™¤äº†ä»£ç å±‚é¢ï¼Œä»ä»£ç çš„ç®¡ç†ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°æ¨¡å—åŒ–çš„å¥½å¤„ã€‚vue2æºç æ‰˜ç®¡åœ¨srcç›®å½•ä¸­ï¼Œç„¶åæ›´å…·åŠŸèƒ½æ‹†åˆ†å‡ºäº†ç„¶åä¾æ®åŠŸèƒ½æ‹†åˆ†å‡ºäº† compilerã€coreã€platformsã€serverã€sfcã€sharedç­‰ç›®å½•ã€‚è€Œåˆ°äº†vue3ï¼Œåˆ™æ˜¯é€šè¿‡monoropeçš„æ–¹å¼ç»´æŠ¤ï¼Œå°†ä¸åŒçš„åŠŸèƒ½æ‹†åˆ†åˆ°ä¸åŒçš„æ¨¡å—å½“ä¸­ã€‚äº‹å®ä¸Šä¸æ­¢vueï¼Œéšç€monoropeæ–¹æ¡ˆçš„æˆç†Ÿï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€æºé¡¹ç›®éƒ½åœ¨ä½¿ç”¨monoropeçš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚</p>
<p><strong>ä¸‰ã€CommonJS æ¨ªç©ºå‡ºä¸–ï¼Œnodeåº”è¿è€Œç”Ÿ</strong></p>
<p>2009å¹´1æœˆ29æ—¥ï¼ŒMozillaçš„å·¥ç¨‹å¸ˆKevin Dangoorå‘å¸ƒäº†ä¸€ç¯‡æ–‡ç« ã€ŠWhat Server Side JavaScript needsã€‹ï¼Œå¹¶åœ¨Google Groupsä¸­åˆ›å»ºäº†ä¸€ä¸ªServerJSå°ç»„ï¼Œæ—¨åœ¨æ„å»ºæ›´å¥½çš„JavaScriptç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬æœåŠ¡å™¨ç«¯ã€æµè§ˆå™¨ç«¯ï¼Œè€Œåæ›´åä¸ºCommonJSå°ç»„ï¼Œå‘èµ·äº†CommonJSçš„ææ¡ˆã€‚å½“å¹´å¹´æœ«ï¼ŒnodeåŸºäºCommonJSè§„èŒƒæ¨ªç©ºå‡ºä¸–ï¼Œnodeè·Ÿå…·æ¨¡å—çš„ä¸åŒæ¥æºåˆ†ä¸ºäº†ä¸‰å¤§ç±»ï¼š</p>
<ul>
<li>å†…ç½®æ¨¡å—ï¼šfsã€pathã€httpç­‰</li>
<li>è‡ªå®šä¹‰æ¨¡å—ï¼šç”¨æˆ·æŒ‰ç…§CommonJSè§„èŒƒåˆ›å»ºçš„ js æ–‡ä»¶</li>
<li>ç¬¬ä¸‰æ–¹æ¨¡å—ï¼šç”±ç¬¬ä¸‰æ–¹å¼€å‘çš„æ¨¡å—ï¼Œå¹¶ä½¿ç”¨npmè¿›è¡Œç®¡ç†</li>
</ul>
<p>å‡­å€Ÿç€nodeâ€œå•çº¿ç¨‹â€å’Œâ€œå¤©ç„¶å¼‚æ­¥APIâ€ä¸‹çš„é«˜æ€§èƒ½è¿è¡Œæ—¶ï¼ŒJavaScriptæ­£å¼çš„è¸å…¥äº†æœåŠ¡ç«¯é¢†åŸŸã€‚è‡ªCommonJSè¯ç”Ÿä»¥æ¥ï¼Œå‰ç«¯ç¤¾åŒºå¯¹æ¨¡å—åŒ–æ¢ç´¢çš„è„šæ­¥ä¸€ç›´æœªåœæ­¢ï¼Œå…ˆåå‡ºç°äº†AMDã€CMDã€UMDå’ŒESModuleç­‰æ¨¡å—åŒ–è§„èŒƒï¼Œå¹¶è¯ç”Ÿå‡ºäº†ä¸€ç³»åˆ—çš„å·¥å…·</p>
<ul>
<li>åŸºäºCommonJSè§„èŒƒï¼šnode</li>
<li>åŸºäºAMDè§„èŒƒï¼šrequireJS</li>
<li>åŸºäºCMDè§„èŒƒï¼šSeaJS</li>
<li>åŸºäºESModuleï¼šnodeã€webpackã€viteã€æµè§ˆå™¨åŸç”Ÿæ”¯æŒ</li>
</ul>
<p><strong>å››ã€ESModule</strong></p>
<p>ES Moduleç®€ç§°ESMï¼ŒESMæ˜¯ES6çš„å¼€å‘è§„èŒƒã€‚ES6äº2015å¹´6æœˆæ­£å¼å‘å¸ƒï¼Œç›®å‰å·²ç»è¢«å¤§éƒ¨åˆ†ä¸»æµæµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œåªè¦HTMLä¸­æœ‰type&#x3D;â€moduleâ€å±æ€§çš„scriptæ ‡ç­¾ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šæŒ‰ç…§ES Moduleè§„èŒƒäº†æ¥è¿›è¡Œä¾èµ–åŠ è½½å’Œæ¨¡å—è§£æã€‚Nodeæœ€å¼€å§‹ä½¿ç”¨çš„æ˜¯CommonJSè§„èŒƒï¼Œä½†è‡ªä»v13.2.0ä¹‹åä¹Ÿå¼•å…¥äº†ES Moduleæœºåˆ¶ã€‚</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7effc532c8c46b49fcf250f724e9e41~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f7c6e427c874515b7a7946c306d1225~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>1ï¼‰å¯¼å‡ºæ¨¡å—</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">&#x27;wk&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">helloWorld</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// name.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;wk&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">helloWorld</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; name, helloWorld &#125;</span><br></pre></td></tr></table></figure>

<p>2ï¼‰å¯¼å…¥åŠŸèƒ½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; name, helloWorld &#125; <span class="keyword">from</span> <span class="string">&#x27;./name.js&#x27;</span></span><br></pre></td></tr></table></figure>

<p>3ï¼‰HTMLåº”ç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;module&quot;</span> src=<span class="string">&quot;./name.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>4ï¼‰é»˜è®¤å¯¼å‡ºå¯¼å…¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// name.js</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;wk&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> name</span><br><span class="line"></span><br><span class="line"><span class="comment">// hello.js å¯¼å‡ºåŒ¿åå‡½æ•°</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">import</span> name <span class="keyword">from</span> <span class="string">&#x27;./name.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> helloWorld <span class="keyword">from</span> <span class="string">&#x27;./hello.js&#x27;</span></span><br></pre></td></tr></table></figure>

<p>5ï¼‰as é¿å…å‘½åå†²çª</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inside module.js</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  function1 <span class="keyword">as</span> newFunctionName,</span><br><span class="line">  function2 <span class="keyword">as</span> anotherNewFunctionName</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inside main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; newFunctionName, anotherNewFunctionName &#125; <span class="keyword">from</span> <span class="string">&#x27;/modules/module.js&#x27;</span>;</span><br><span class="line"><span class="comment">// inside module.js</span></span><br><span class="line"><span class="keyword">export</span> &#123; function1, function2 &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inside main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; function1 <span class="keyword">as</span> newFunctionName,</span><br><span class="line">         function2 <span class="keyword">as</span> anotherNewFunctionName &#125; <span class="keyword">from</span> <span class="string">&#x27;/modules/module.js&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>6ï¼‰åˆå¹¶æ¨¡å—</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;a.js&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">&#x27;name.js&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123; helloWorld &#125; <span class="keyword">from</span> <span class="string">&#x27;./hello.js&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-viteçš„ä½¿ç”¨"><a href="#2-viteçš„ä½¿ç”¨" class="headerlink" title="2 viteçš„ä½¿ç”¨"></a>2 viteçš„ä½¿ç”¨</h2><blockquote>
<p>ç®€ä»‹</p>
<p>é¡¹ç›®æ­å»º</p>
<p>é…ç½®</p>
</blockquote>
<p>viteä½œä¸ºæ–°ä¸€ä»£çš„æ„å»ºå·¥å…·ï¼Œæœ€çªå‡ºçš„äº®ç‚¹å°±æ˜¯æå¿«çš„æ„å»ºé€Ÿåº¦å’Œçƒ­æ›´æ–°é€Ÿåº¦ï¼Œå¤§å¤§çš„æå‡äº†ç ”å‘æ•ˆç‡ï¼Œè¿™ä¸€ç‚¹ä¼šåœ¨åé¢è¯¦ç»†ä»‹ç»ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œviteåœ¨å…¶ä»–æ–¹é¢ä¹Ÿè¡¨ç°ä¸ä¿—ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨viteæ­å»ºvue3é¡¹ç›®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vite</span><br></pre></td></tr></table></figure>

<p>ç›®å½•:</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7424f96355c74ae595050e65e6563592~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>package.json:</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6188a5ea1d314b199fd88a1e25a4724a~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>é¡¹ç›®å®‰è£…å’Œå¯åŠ¨ï¼šè™½ç„¶é¡¹ç›®è¾ƒå°ï¼Œä½†æ˜¯viteæ„å»ºå®Œæˆçš„æ—¶é—´ä»…ä½¿ç”¨äº†789ms</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i // å®‰è£…</span><br><span class="line">npm run dev // å¯åŠ¨</span><br></pre></td></tr></table></figure>

<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81d34826c3a544a08bf08efa35b34763~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<h3 id="2-1-çƒ­æ›´æ–°"><a href="#2-1-çƒ­æ›´æ–°" class="headerlink" title="2.1 çƒ­æ›´æ–°"></a>2.1 çƒ­æ›´æ–°</h3><p>Vite æä¾›äº†ä¸€å¥—åŸç”Ÿ ESM çš„ **<a target="_blank" rel="noopener" href="https://cn.vitejs.dev/guide/api-hmr.html">HMR API</a>**ã€‚ å…·æœ‰ HMR åŠŸèƒ½çš„æ¡†æ¶å¯ä»¥åˆ©ç”¨è¯¥ API æä¾›å³æ—¶ã€å‡†ç¡®çš„æ›´æ–°ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½é¡µé¢æˆ–æ¸…é™¤åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚Vite å†…ç½®äº† HMR åˆ° <strong><a target="_blank" rel="noopener" href="https://github.com/vitejs/vite-plugin-vue/tree/main/packages/plugin-vue">Vue å•æ–‡ä»¶ç»„ä»¶ï¼ˆSFCï¼‰</a></strong> å’Œ <strong><a target="_blank" rel="noopener" href="https://github.com/vitejs/vite-plugin-react/tree/main/packages/plugin-react">React Fast Refresh</a></strong> ä¸­ï¼Œå½“ä½ é€šè¿‡ <strong><a target="_blank" rel="noopener" href="https://cn.vitejs.dev/guide/">create-vite</a></strong> åˆ›å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œæ‰€é€‰æ¨¡æ¿å·²ç»ä¸ºä½ é¢„å…ˆé…ç½®äº†è¿™äº›ã€‚å¾—ç›Šäºæµè§ˆå™¨åŸç”Ÿæ”¯æŒESMï¼Œå½“ä¿®æ”¹æŸä¸ªæ–‡ä»¶æ—¶ï¼Œçƒ­æ›´æ–°åŸºæœ¬ä¸éœ€è¦æ—¶é—´ã€‚è¿™ç‚¹ä¼šåœ¨ä¸‹é¢è¯¦ç»†æè¿°ã€‚</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8c0d21817694bcf8170f404373c27a3~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b668a1fc3fd64a60aca3c81f47949f15~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>viteçš„æ’ä»¶å…¼å®¹äº†rollupçš„æ‰€æœ‰é’©å­ã€‚å¦‚æœä½ çš„æ’ä»¶ä»…ä½¿ç”¨äº†è¿™äº›é’©å­ï¼Œé‚£ä¹ˆè¯¥æ’ä»¶ä»¥ rollup-plugin- å‰ç¼€ï¼Œè¡¨ç¤ºè¯¥æ’ä»¶æ˜¯å…¼å®¹rollupçš„ã€‚</p>
<ul>
<li>æœåŠ¡å™¨å¯åŠ¨æ—¶è¢«è°ƒç”¨ï¼šoptionsã€buildStart</li>
<li>ä¼ å…¥æ¨¡å—æ—¶è¢«è°ƒç”¨ï¼šresolveIdã€loadã€transform</li>
<li>æœåŠ¡å™¨å…³é—­æ—¶è¢«è°ƒç”¨ï¼šbuildEndã€closeBundle</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œviteè¿˜æä¾›äº†ä¸€äº›ä¸“å±çš„é’©å­ï¼Œè¿™äº›é’©å­ä¼šè¢«rollupå¿½ç•¥ï¼Œè¿™ç±»æ’ä»¶ä»¥ vite-plugin- å‰ç¼€ã€‚</p>
<ul>
<li>è§£æviteé…ç½®å‰ï¼šconfig</li>
<li>è§£æviteé…ç½®åï¼šconfigResolve</li>
<li>é…ç½®å¼€å‘æœåŠ¡å™¨ï¼šconfigureServer</li>
<li>è½¬æ¢index.htmlï¼štransformIndexHtml</li>
<li>HMRå¤„ç†ï¼šhandleHotUpdate</li>
</ul>
<p>æ¥ä¸‹æ¥ä»æºç çš„è§’åº¦æ¥åˆ†æviteå¦‚ä½•åšåˆ°çƒ­æ›´æ–°ã€‚</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f56a81a6cddc40eaa4fb70d3d7f99a63~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<h4 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h4><p>node.js æœ¬èº«æä¾›äº†å®˜æ–¹çš„ API ä¾‹å¦‚ fs.watch fs.watchFile æ¥ç›‘å¬æ–‡ä»¶çš„å˜åŒ–ï¼Œvite åˆ™ä½¿ç”¨äº†è¿™äº› API æ›´ä¸Šå±‚çš„å°è£…æ¨¡å—<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/chokidar">chokidar</a>æ¥è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿçš„å˜åŠ¨ç›‘å¬ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å¯ç›‘å¬</span></span><br><span class="line"><span class="keyword">const</span> watcher = chokidar.<span class="title function_">watch</span>(</span><br><span class="line">  <span class="comment">// config file dependencies and env file might be outside of root</span></span><br><span class="line">  [root, ...config.<span class="property">configFileDependencies</span>, config.<span class="property">envDir</span>],</span><br><span class="line">  resolvedWatchOptions,</span><br><span class="line">) <span class="keyword">as</span> <span class="title class_">FSWatcher</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§¦å‘é’©å­å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onHMRUpdate</span> = <span class="keyword">async</span> (<span class="params">file: string, configOnly: boolean</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (serverConfig.<span class="property">hmr</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">handleHMRUpdate</span>(file, server, configOnly)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      ws.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="attr">err</span>: <span class="title function_">prepareError</span>(err),</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–‡ä»¶æ–°å¢ã€åˆ é™¤è§¦å‘é’©å­</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onFileAddUnlink</span> = <span class="keyword">async</span> (<span class="params">file: string</span>) =&gt; &#123;</span><br><span class="line">  file = <span class="title function_">normalizePath</span>(file)</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">handleFileAddUnlink</span>(file, server)</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">onHMRUpdate</span>(file, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬æ–‡ä»¶å˜åŒ–</span></span><br><span class="line">watcher.<span class="title function_">on</span>(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">async</span> (file) =&gt; &#123;</span><br><span class="line">  file = <span class="title function_">normalizePath</span>(file)</span><br><span class="line">  <span class="keyword">if</span> (file.<span class="title function_">endsWith</span>(<span class="string">&#x27;/package.json&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">invalidatePackageData</span>(packageCache, file)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// invalidate module graph cache on file change</span></span><br><span class="line">  moduleGraph.<span class="title function_">onFileChange</span>(file)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">onHMRUpdate</span>(file, <span class="literal">false</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬æ–°å¢æ–‡ä»¶</span></span><br><span class="line">watcher.<span class="title function_">on</span>(<span class="string">&#x27;add&#x27;</span>, onFileAddUnlink)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬åˆ é™¤æ–‡ä»¶</span></span><br><span class="line">watcher.<span class="title function_">on</span>(<span class="string">&#x27;unlink&#x27;</span>, onFileAddUnlink)</span><br></pre></td></tr></table></figure>

<p>å½“æ–‡ä»¶æœ‰å˜åŠ¨æ—¶ï¼Œviteä¼šè§¦å‘handleHotUpdateé’©å­ï¼Œæ‹¿åˆ°å¤„ç†åçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶é€šè¿‡webSocketå»ºç«‹çš„é€šé“å‘ŠçŸ¥æµè§ˆå™¨è¿›è¡Œåˆ·æ–°æˆ–è€…åŠ è½½æ–‡ä»¶ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰§è¡Œé’©å­å‡½æ•°ï¼Œè·å–ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> hook <span class="keyword">of</span> config.<span class="title function_">getSortedPluginHooks</span>(<span class="string">&#x27;handleHotUpdate&#x27;</span>)) &#123;</span><br><span class="line">  <span class="keyword">const</span> filteredModules = <span class="keyword">await</span> <span class="title function_">hook</span>(hmrContext)</span><br><span class="line">  <span class="keyword">if</span> (filteredModules) &#123;</span><br><span class="line">    hmrContext.<span class="property">modules</span> = filteredModules</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€šçŸ¥é‡æ–°åŠ è½½</span></span><br><span class="line"><span class="keyword">if</span> (!hmrContext.<span class="property">modules</span>.<span class="property">length</span>) &#123;</span><br><span class="line">  <span class="comment">// html file cannot be hot updated</span></span><br><span class="line">  <span class="keyword">if</span> (file.<span class="title function_">endsWith</span>(<span class="string">&#x27;.html&#x27;</span>)) &#123;</span><br><span class="line">    config.<span class="property">logger</span>.<span class="title function_">info</span>(colors.<span class="title function_">green</span>(<span class="string">`page reload `</span>) + colors.<span class="title function_">dim</span>(shortFile), &#123;</span><br><span class="line">      <span class="attr">clear</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">timestamp</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    ws.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;full-reload&#x27;</span>,</span><br><span class="line">      <span class="attr">path</span>: config.<span class="property">server</span>.<span class="property">middlewareMode</span></span><br><span class="line">      ? <span class="string">&#x27;*&#x27;</span></span><br><span class="line">      : <span class="string">&#x27;/&#x27;</span> + <span class="title function_">normalizePath</span>(path.<span class="title function_">relative</span>(config.<span class="property">root</span>, file)),</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// loaded but not in the module graph, probably not js</span></span><br><span class="line">    <span class="title function_">debugHmr</span>(<span class="string">`[no modules matched] <span class="subst">$&#123;colors.dim(shortFile)&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šçŸ¥æ›´æ–°</span></span><br><span class="line"><span class="keyword">if</span> (updates.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="title function_">debugHmr</span>(colors.<span class="title function_">yellow</span>(<span class="string">`no update happened `</span>) + colors.<span class="title function_">dim</span>(file))</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">config.<span class="property">logger</span>.<span class="title function_">info</span>(</span><br><span class="line">  colors.<span class="title function_">green</span>(<span class="string">`hmr update `</span>) +</span><br><span class="line">  colors.<span class="title function_">dim</span>([...<span class="keyword">new</span> <span class="title class_">Set</span>(updates.<span class="title function_">map</span>(<span class="function">(<span class="params">u</span>) =&gt;</span> u.<span class="property">path</span>))].<span class="title function_">join</span>(<span class="string">&#x27;, &#x27;</span>)),</span><br><span class="line">  &#123; <span class="attr">clear</span>: !afterInvalidation, <span class="attr">timestamp</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">)</span><br><span class="line">ws.<span class="title function_">send</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;update&#x27;</span>,</span><br><span class="line">  updates,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h4><p>æµè§ˆå™¨åœ¨æ•´ä¸ªç³»ç»Ÿæ‰®æ¼”ç€å®¢æˆ·ç«¯çš„è§’è‰²ï¼Œviteé€šè¿‡transformIndexHtmlçš„hookå°†å®¢æˆ·ç«¯ä»£ç æ’å…¥äº†index.html</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5fdcd95093904b2ab41230c566748ceb~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>å®¢æˆ·ç«¯æ¥å—åˆ°æ¶ˆæ¯åï¼Œä¼šæ ¹æ®æœåŠ¡ç«¯å‘é€çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚ä¼šæ ¹æ®ä¸åŒæƒ…å†µï¼Œè¿›è¡Œè¯·æ±‚æ–‡ä»¶å†åˆ·æ–°æˆ–è€…æ˜¯ç›´æ¥åˆ·æ–°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&#x27;update&#x27;</span>:</span><br><span class="line">      <span class="title function_">notifyListeners</span>(<span class="string">&#x27;vite:beforeUpdate&#x27;</span>, payload)</span><br><span class="line">      <span class="comment">// if this is the first update and there&#x27;s already an error overlay, it</span></span><br><span class="line">      <span class="comment">// means the page opened with existing server compile error and the whole</span></span><br><span class="line">      <span class="comment">// module script failed to load (since one of the nested imports is 500).</span></span><br><span class="line">      <span class="comment">// in this case a normal update won&#x27;t work and a full reload is needed.</span></span><br><span class="line">      <span class="keyword">if</span> (isFirstUpdate &amp;&amp; <span class="title function_">hasErrorOverlay</span>()) &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">clearErrorOverlay</span>()</span><br><span class="line">        isFirstUpdate = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">        payload.<span class="property">updates</span>.<span class="title function_">map</span>(<span class="keyword">async</span> (update): <span class="title class_">Promise</span>&lt;<span class="keyword">void</span>&gt; =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (update.<span class="property">type</span> === <span class="string">&#x27;js-update&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">queueUpdate</span>(<span class="title function_">fetchUpdate</span>(update))</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// css-update</span></span><br><span class="line">          <span class="comment">// this is only sent when a css file referenced with &lt;link&gt; is updated</span></span><br><span class="line">          <span class="keyword">const</span> &#123; path, timestamp &#125; = update</span><br><span class="line">          <span class="keyword">const</span> searchUrl = <span class="title function_">cleanUrl</span>(path)</span><br><span class="line">          <span class="comment">// can&#x27;t use querySelector with `[href*=]` here since the link may be</span></span><br><span class="line">          <span class="comment">// using relative paths so we need to use link.href to grab the full</span></span><br><span class="line">          <span class="comment">// URL for the include check.</span></span><br><span class="line">          <span class="keyword">const</span> el = <span class="title class_">Array</span>.<span class="title function_">from</span>(</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">querySelectorAll</span>&lt;<span class="title class_">HTMLLinkElement</span>&gt;(<span class="string">&#x27;link&#x27;</span>),</span><br><span class="line">          ).<span class="title function_">find</span>(</span><br><span class="line">            <span class="function">(<span class="params">e</span>) =&gt;</span></span><br><span class="line">              !outdatedLinkTags.<span class="title function_">has</span>(e) &amp;&amp; <span class="title function_">cleanUrl</span>(e.<span class="property">href</span>).<span class="title function_">includes</span>(searchUrl),</span><br><span class="line">          )</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!el) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> newPath = <span class="string">`<span class="subst">$&#123;base&#125;</span><span class="subst">$&#123;searchUrl.slice(<span class="number">1</span>)&#125;</span><span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            searchUrl.includes(<span class="string">&#x27;?&#x27;</span>) ? <span class="string">&#x27;&amp;&#x27;</span> : <span class="string">&#x27;?&#x27;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">          &#125;</span>t=<span class="subst">$&#123;timestamp&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// rather than swapping the href on the existing tag, we will</span></span><br><span class="line">          <span class="comment">// create a new link tag. Once the new stylesheet has loaded we</span></span><br><span class="line">          <span class="comment">// will remove the existing link tag. This removes a Flash Of</span></span><br><span class="line">          <span class="comment">// Unstyled Content that can occur when swapping out the tag href</span></span><br><span class="line">          <span class="comment">// directly, as the new stylesheet has not yet been loaded.</span></span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> newLinkTag = el.<span class="title function_">cloneNode</span>() <span class="keyword">as</span> <span class="title class_">HTMLLinkElement</span></span><br><span class="line">            newLinkTag.<span class="property">href</span> = <span class="keyword">new</span> <span class="title function_">URL</span>(newPath, el.<span class="property">href</span>).<span class="property">href</span></span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">removeOldEl</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">              el.<span class="title function_">remove</span>()</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">debug</span>(<span class="string">`[vite] css hot updated: <span class="subst">$&#123;searchUrl&#125;</span>`</span>)</span><br><span class="line">              <span class="title function_">resolve</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            newLinkTag.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, removeOldEl)</span><br><span class="line">            newLinkTag.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>, removeOldEl)</span><br><span class="line">            outdatedLinkTags.<span class="title function_">add</span>(el)</span><br><span class="line">            el.<span class="title function_">after</span>(newLinkTag)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;),</span><br><span class="line">      )</span><br><span class="line">      <span class="title function_">notifyListeners</span>(<span class="string">&#x27;vite:afterUpdate&#x27;</span>, payload)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;full-reload&#x27;</span>:</span><br><span class="line">      <span class="title function_">notifyListeners</span>(<span class="string">&#x27;vite:beforeFullReload&#x27;</span>, payload)</span><br><span class="line">      <span class="keyword">if</span> (payload.<span class="property">path</span> &amp;&amp; payload.<span class="property">path</span>.<span class="title function_">endsWith</span>(<span class="string">&#x27;.html&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// if html file is edited, only reload the page if the browser is</span></span><br><span class="line">        <span class="comment">// currently on that page.</span></span><br><span class="line">        <span class="keyword">const</span> pagePath = <span class="built_in">decodeURI</span>(location.<span class="property">pathname</span>)</span><br><span class="line">        <span class="keyword">const</span> payloadPath = base + payload.<span class="property">path</span>.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          pagePath === payloadPath ||</span><br><span class="line">          payload.<span class="property">path</span> === <span class="string">&#x27;/index.html&#x27;</span> ||</span><br><span class="line">          (pagePath.<span class="title function_">endsWith</span>(<span class="string">&#x27;/&#x27;</span>) &amp;&amp; pagePath + <span class="string">&#x27;index.html&#x27;</span> === payloadPath)</span><br><span class="line">        ) &#123;</span><br><span class="line">          location.<span class="title function_">reload</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        location.<span class="title function_">reload</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="3-viteçš„å¿«ä¸æ…¢"><a href="#3-viteçš„å¿«ä¸æ…¢" class="headerlink" title="3 viteçš„å¿«ä¸æ…¢"></a>3 viteçš„å¿«ä¸æ…¢</h2><blockquote>
<p>å†·å¯åŠ¨ã€çƒ­æ›´æ–°</p>
<p>é¦–å±æ¸²æŸ“ã€æ‡’åŠ è½½</p>
</blockquote>
<h3 id="3-1-viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ"><a href="#3-1-viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="3.1 viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ"></a>3.1 viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ</h3><p>viteç»™äººçš„ç¬¬ä¸€å°è±¡å°±æ˜¯å¿«ï¼Œå¿«é€Ÿçš„æ„å»ºï¼Œå¿«é€Ÿçš„çƒ­æ›´æ–°ï¼Œå¤§å¹…åº¦çš„æå‡äº†å‰ç«¯å¼€å‘çš„æ•ˆç‡ã€‚è€Œè¿™ä¸»è¦å½’åŠŸäºï¼š1ï¼‰åŸºäºæµè§ˆå™¨æ”¯æŒESçš„å®ç° 2ï¼‰é«˜æ€§èƒ½å¼•æ“ESBuild</p>
<p><strong>ä¸€ã€åŸºäºæµè§ˆå™¨æ”¯æŒESçš„å®ç°</strong></p>
<p><strong>äºŒã€é«˜æ€§èƒ½å¼•æ“ESBuild</strong></p>
<h3 id="3-2-viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ"><a href="#3-2-viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ" class="headerlink" title="3.2 viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ"></a>3.2 viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ</h3><p>æˆä¹Ÿè§ä½•ï¼Œè´¥ä¹Ÿè§ä½•ã€‚å› ä¸ºä¼ ç»Ÿæ„å»ºå·¥å…·çš„æ‰“åŒ…å·¥ä½œäº¤ç»™äº†æµè§ˆå™¨å¤„ç†ï¼Œå› æ­¤åœ¨é¡µé¢æ‰“å¼€æ—¶éœ€è¦å¤§é‡çš„åŠ è½½httpè¯·æ±‚ï¼Œå¯¼è‡´äº†viteæ„å»ºå¼€å‘ç¯å¢ƒä¸‹çš„äº§ç‰©é¦–å±æ¸²æŸ“å’Œæ‡’åŠ è½½ä¼šå¾ˆæ…¢ã€‚ç„¶è€Œviteåœ¨æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒçš„äº§ç‰©æ—¶ä½¿ç”¨çš„rollupï¼Œå› æ­¤ä¸ä¼šå­˜åœ¨é¦–å±æ¸²æŸ“å’Œæ‡’åŠ è½½çš„é—®é¢˜ã€‚æ‰€ä»¥ç›¸æ¯”viteå¸¦æ¥çš„æé€Ÿæ„å»ºé€Ÿåº¦ï¼Œé¦–å±æ¸²æŸ“å’Œæ‡’åŠ è½½å¸¦æ¥çš„é—®é¢˜æ˜¾å¾—â€œå¾®ä¸è¶³é“â€ï¼Œè€Œä¸”é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œä¸šç•Œä¹Ÿæœ‰äº†å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 id="4-viteæ’ä»¶å¼€å‘"><a href="#4-viteæ’ä»¶å¼€å‘" class="headerlink" title="4 viteæ’ä»¶å¼€å‘"></a>4 viteæ’ä»¶å¼€å‘</h2><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7068273153952186398#heading-7">è¯¦è°ˆå‰ç«¯æ¨¡å—åŒ–è¿™åå››å¹´çš„å‘å±•å²ï¼šCommonJSã€AMDã€CMDã€ES6</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/book/7050063811973218341/section/7050063812044685343">æ·±å…¥æµ…å‡º Vite</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7129041114174062628">æ¼«è°ˆæ„å»ºå·¥å…·(å››): ä¸ºä»€ä¹ˆæœ‰äººè¯´ vite å¿«ï¼Œæœ‰äººå´è¯´ vite æ…¢ï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7067827608842403848#heading-3">ååˆ†é’Ÿå¸¦ä½ äº†è§£viteæ’ä»¶å¼€å‘</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6968793122029436959#heading-3">viteæºç åˆ†æ(4) :vite çƒ­æ›´æ–°åŸç†åˆ†æ</a></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/15/2023%E5%B9%B4%E5%BA%A6%E8%AE%A1%E5%88%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/15/2023%E5%B9%B4%E5%BA%A6%E8%AE%A1%E5%88%92/" class="post-title-link" itemprop="url">2023å¹´åº¦è®¡åˆ’</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-05-15 19:59:46" itemprop="dateCreated datePublished" datetime="2023-05-15T19:59:46+08:00">2023-05-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-16 09:18:00" itemprop="dateModified" datetime="2023-05-16T09:18:00+08:00">2023-05-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B9%B4%E5%BA%A6%E8%AE%A1%E5%88%92/" itemprop="url" rel="index"><span itemprop="name">å¹´åº¦è®¡åˆ’</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="æ—¥ç¨‹å®‰æ’"><a href="#æ—¥ç¨‹å®‰æ’" class="headerlink" title="æ—¥ç¨‹å®‰æ’"></a>æ—¥ç¨‹å®‰æ’</h2><ul>
<li>7.00-8.00  èµ·åºŠï¼Œæ´—æ¼±</li>
<li>8.00-10.00  åƒé¥­ï¼Œä¸Šç­ã€å­¦ä¹ </li>
<li>10.00-11.40  å·¥ä½œ</li>
<li>11.40-12.40  å›å®¶ï¼Œåšé¥­ï¼Œåƒé¥­</li>
<li>12.40-13.40  åˆç¡</li>
<li>14.00-18.00  å·¥ä½œ</li>
<li>18.00-19.00  æ™šé¥­ä¼‘æ¯</li>
<li>19.00-20.00  å·¥ä½œ</li>
<li>20.00-22.00  å›å®¶ï¼Œæ´—æ¼±ï¼Œæ”¶æ‹¾ï¼Œå‡†å¤‡åˆé¥­</li>
<li>22.00-23.30  å¨±ä¹</li>
<li>23.30  ç¡è§‰</li>
</ul>
<h2 id="å­¦ä¹ "><a href="#å­¦ä¹ " class="headerlink" title="å­¦ä¹ "></a>å­¦ä¹ </h2><p>è®¡ç®—æœºåŸºç¡€ï¼š</p>
<ul>
<li>è®¡ç®—æœºç½‘ç»œï¼šçœ‹ä¸€æœ¬ç»å…¸çš„ä¹¦ã€åšå¥½ç›¸å…³ç¬”è®°</li>
<li>ç®—æ³•ï¼šçœ‹ä¸€æœ¬ç»å…¸çš„ä¹¦ã€å¼„æ‡‚æ¯ä¸ªç±»å‹çš„ç®—æ³•çš„ç»å…¸é¢˜å‹ã€åšç¬”è®°</li>
</ul>
<p>å‰ç«¯ï¼š</p>
<ul>
<li>JavaScriptï¼šæ–°çŸ¥è¯†ç‚¹æ€»ç»“ã€å·¥ä½œä¸­çš„ç»éªŒæ€»ç»“<ul>
<li><a target="_blank" rel="noopener" href="https://wk-nemo.github.io/2022/03/21/js%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E2%80%94%E2%80%94%E5%81%A5%E5%A3%AE%E6%80%A7/">jsä»£ç è´¨é‡â€”â€”å¥å£®æ€§</a></li>
<li><a target="_blank" rel="noopener" href="https://wk-nemo.github.io/2022/03/23/js%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E2%80%94%E2%80%94%E9%80%BB%E8%BE%91%E6%AD%A3%E7%A1%AE%E6%80%A7/">jsä»£ç è´¨é‡â€”â€”é€»è¾‘æ­£ç¡®æ€§</a></li>
</ul>
</li>
<li>Nodeï¼šåŸºç¡€çŸ¥è¯†ç¬”è®°ã€åŸç†å­¦ä¹ æ€»ç»“ã€å®æˆ˜åº”ç”¨æ€»ç»“</li>
<li>Vueï¼šVue3åŸç†å­¦ä¹ ã€åšç¬”è®°<ul>
<li><a target="_blank" rel="noopener" href="https://wk-nemo.github.io/2022/03/24/%E8%B7%9F%E7%9D%80%E3%80%8AVue.js%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E3%80%8B%E5%AD%A6%E4%B9%A0Vue3%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91/">è·Ÿç€ã€ŠVue.jsè®¾è®¡ä¸å®ç°ã€‹å­¦ä¹ Vue3æ¨¡æ¿ç¼–è¯‘</a></li>
<li><a target="_blank" rel="noopener" href="https://wk-nemo.github.io/2022/07/17/vue3%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%B8%8A%EF%BC%89/">vue3å“åº”å¼ç³»ç»Ÿä½œç”¨ä¸å®ç°ï¼ˆä¸Šï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://wk-nemo.github.io/2022/08/20/vue3%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%B8%AD%EF%BC%89/">vue3å“åº”å¼ç³»ç»Ÿä½œç”¨ä¸å®ç°ï¼ˆä¸­ï¼‰</a></li>
</ul>
</li>
<li>æ„å»ºå·¥å…·ï¼šå·¥ä½œæ€»ç»“ã€viteã€webpackã€æ€»ç»“</li>
<li>å¾®ä¿¡å°ç¨‹åºï¼šå·¥ä½œæ€»ç»“ã€åŸç†ã€æ€»ç»“</li>
<li>webæ€§èƒ½ä¼˜åŒ–ï¼šå·¥ä½œæ€»ç»“ã€ç½‘ä¸Šå­¦ä¹ ã€ç¬”è®°</li>
</ul>
<h2 id="æ¸¸æˆ"><a href="#æ¸¸æˆ" class="headerlink" title="æ¸¸æˆ"></a>æ¸¸æˆ</h2><p>å•æœºï¼š</p>
<ul>
<li>å¡å°”è¾¾ä¼ è¯´ï¼šæ—·é‡ä¹‹æ¯</li>
<li>å¡å°”è¾¾ä¼ è¯´ï¼šç‹å›½ä¹‹æ³ª</li>
<li>å·«å¸ˆ3</li>
</ul>
<p>ç½‘æ¸¸ï¼š</p>
<ul>
<li>LOL</li>
<li>CSGO</li>
<li>é›€é­‚</li>
</ul>
<h2 id="æ—…æ¸¸"><a href="#æ—…æ¸¸" class="headerlink" title="æ—…æ¸¸"></a>æ—…æ¸¸</h2><ul>
<li>é‡åº†</li>
<li>æˆéƒ½</li>
<li>é’å²›</li>
</ul>
<h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><ul>
<li>å­¦åšé¥­<ul>
<li><a target="_blank" rel="noopener" href="https://wk-nemo.github.io/2023/05/13/%E7%A8%8B%E5%BA%8F%E7%8C%BF%E7%83%A7%E9%A5%AD%E6%8C%87%E5%8D%97%E2%80%94%E2%80%94%E5%87%86%E5%A4%87%E7%AF%87/">ç¨‹åºçŒ¿çƒ§é¥­æŒ‡å—â€”â€”å‡†å¤‡ç¯‡</a></li>
<li><a target="_blank" rel="noopener" href="https://wk-nemo.github.io/2023/05/13/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%83%A7%E9%A5%AD%E6%8C%87%E5%8D%97%E2%80%94%E2%80%94%E7%89%9B%E6%8E%92%E7%81%AB%E9%94%85-%E9%9D%92%E6%A4%92%E7%82%92%E8%82%89%E4%B8%9D/">ç¨‹åºå‘˜çƒ§é¥­æŒ‡å—â€”â€”5æœˆä»½æŒ‡å—</a></li>
</ul>
</li>
<li>æ»‘é›ª</li>
<li>è¯»ä¹¦<ul>
<li>ã€Šå¯Œçˆ¸çˆ¸ç©·çˆ¸çˆ¸ã€‹</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/13/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%83%A7%E9%A5%AD%E6%8C%87%E5%8D%97%E2%80%94%E2%80%945%E6%9C%88%E4%BB%BD%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/13/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%83%A7%E9%A5%AD%E6%8C%87%E5%8D%97%E2%80%94%E2%80%945%E6%9C%88%E4%BB%BD%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">ç¨‹åºå‘˜çƒ§é¥­æŒ‡å—â€”â€”5æœˆä»½æŒ‡å—</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-05-13 16:57:40" itemprop="dateCreated datePublished" datetime="2023-05-13T16:57:40+08:00">2023-05-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-16 09:18:19" itemprop="dateModified" datetime="2023-05-16T09:18:19+08:00">2023-05-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%83%A7%E9%A5%AD%E6%8C%87%E5%8D%97/" itemprop="url" rel="index"><span itemprop="name">ç¨‹åºå‘˜çƒ§é¥­æŒ‡å—</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="äº”æœˆä»½ç¾é£Ÿ"><a href="#äº”æœˆä»½ç¾é£Ÿ" class="headerlink" title="äº”æœˆä»½ç¾é£Ÿ"></a>äº”æœˆä»½ç¾é£Ÿ</h2><p>ç‚’èœï¼š</p>
<ul>
<li><p><input checked="" disabled="" type="checkbox"> 
é’æ¤’ç‚’è‚‰ä¸</p>
</li>
<li><p><input disabled="" type="checkbox"> 
å°ç‚’é’èœ</p>
</li>
<li><p><input disabled="" type="checkbox"> 
å†œå®¶å°ç‚’è‚‰</p>
</li>
<li><p><input disabled="" type="checkbox"> 
æ¯›è±†ç‚’è‚‰ä¸</p>
</li>
</ul>
<p>èœï¼š</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> é’æ¤’è‚‰ä¸é¢</li>
<li><input checked="" disabled="" type="checkbox"> å¤é¸¡è›‹ã€é¸¡è…¿</li>
<li><input disabled="" type="checkbox"> é¸¡è›‹ç¾¹</li>
<li><input disabled="" type="checkbox"> æ²¹ç„–å¤§è™¾</li>
</ul>
<p>ç«é”…ï¼š</p>
<ul>
<li><input disabled="" type="checkbox"> ç‰›æ’ç«é”…</li>
</ul>
<p>æ±¤ï¼š</p>
<ul>
<li><input disabled="" type="checkbox"> è¥¿çº¢æŸ¿é¸¡è›‹æ±¤</li>
<li><input disabled="" type="checkbox"> æµ·å¸¦ç‰ç±³æ’éª¨æ±¤</li>
</ul>
<h2 id="é’æ¤’ç‚’è‚‰ä¸"><a href="#é’æ¤’ç‚’è‚‰ä¸" class="headerlink" title="é’æ¤’ç‚’è‚‰ä¸"></a>é’æ¤’ç‚’è‚‰ä¸</h2><p>é£Ÿæï¼š</p>
<ul>
<li>é’æ¤’</li>
<li>äº”èŠ±è‚‰</li>
<li>é¦™å¹²</li>
<li>è’œ</li>
<li>è°ƒæ–™ï¼šæ–™é…’ã€ç”ŸæŠ½ã€è€æŠ½ã€èšæ²¹ã€æ·€ç²‰ã€ç›ã€é¸¡ç²¾</li>
</ul>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li><p>é’æ¤’æ´—å¹²å‡€åˆ‡æˆé•¿æ¡ï¼Œå¤§è’œåˆ‡æˆä¸</p>
</li>
<li><p>é€‰ç”¨çŒªé‡Œè„Šè‚‰ï¼Œå–œæ¬¢åƒè‚¥çš„å¯ä»¥ä½¿ç”¨äº”èŠ±è‚‰</p>
<ul>
<li>å°†é€‰ç”¨çš„è‚‰åˆ‡æˆè‚‰ä¸</li>
<li>åŠ å…¥è’œä¸ï¼ˆå»è…¥ï¼‰ã€æ–™é…’ï¼ˆå»è…¥ï¼‰ã€ç”ŸæŠ½ï¼ˆä¸Šè‰²ï¼‰ã€èšæ²¹ï¼ˆæé²œï¼‰å’Œçº¢è–¯æ·€ç²‰ï¼ˆå«©æ»‘ï¼‰è…Œåˆ¶å¤‡ç”¨</li>
</ul>
</li>
<li><p>èµ·é”…çƒ§æ²¹ï¼Œæ²¹çƒ­ååŠ å…¥è…Œåˆ¶å¥½çš„è‚‰ä¸ï¼Œç¿»ç‚’è‡³å‡ºé¦™å‘³ï¼Œç››å‡ºå¤‡ç”¨</p>
</li>
<li><p>é”…ä¸­ç•™åº•æ²¹ï¼Œçˆ†é¦™è’œä¸åï¼ŒåŠ å…¥å¤‡å¥½çš„é’æ¤’å’Œé¦™å¹²ï¼Œç‚’è‡³æ–­ç”Ÿ</p>
<ul>
<li>ä¸è¦ç‚’æ—¶é—´é•¿äº†ï¼Œå¦åˆ™é’æ¤’ä¸è„†</li>
</ul>
</li>
<li><p>åŠ å…¥ç‚’å¥½çš„è‚‰ä¸ï¼Œé€‚é‡çš„ç›ã€é¸¡ç²¾è¿›è¡Œç¿»ç‚’ä¸€ä¼š</p>
</li>
<li><p>å‡ºé”…</p>
</li>
</ul>
<p>æˆå“ï¼š</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/46781dfb33d144bab7074fe793451c43~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<h2 id="é’æ¤’è‚‰ä¸é¢"><a href="#é’æ¤’è‚‰ä¸é¢" class="headerlink" title="é’æ¤’è‚‰ä¸é¢"></a>é’æ¤’è‚‰ä¸é¢</h2><p>é£Ÿæï¼š</p>
<ul>
<li>ç‚’å¥½çš„é’æ¤’è‚‰ä¸</li>
<li>å°åˆ€é¢æˆ–æ‰‹å·¥é¢</li>
<li>é¸¡è›‹</li>
<li>è‘±èŠ±</li>
<li>è°ƒæ–™ï¼šçŒªæ²¹ã€ç›ã€èƒ¡æ¤’ç²‰ã€è¾£æ¤’ç²‰ã€ç”ŸæŠ½ã€èšæ²¹</li>
</ul>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>é”…ä¸­èµ·æ°´çƒ§å¼€ååŠ å…¥é¢æ¡ï¼Œç…®5-7åˆ†é’Ÿå·¦å³</li>
<li>ç…®é¢æ—¶ï¼Œç¢—ä¸­åŠ å…¥çŒªæ²¹ã€ç›ã€èƒ¡æ¤’ç²‰ã€è¾£æ¤’ç²‰ã€ç”ŸæŠ½ã€èšæ²¹ã€è‘±èŠ±</li>
<li>é¢ç…®å¥½åï¼Œç¢—ä¸­åŠ å…¥å¼€æ°´ï¼Œå’Œä¸‹å¥½çš„é¢æ¡</li>
<li>ç…ä¸€ä¸ªé¸¡è›‹</li>
<li>ç›–ä¸Šé’æ¤’è‚‰ä¸</li>
</ul>
<p>æˆå“ï¼š</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f34a2435681340df8dd741bafeccdd4b~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1433c6fa8c284765972b16da9da7eb80~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<h2 id="ç‰›æ’ç«é”…"><a href="#ç‰›æ’ç«é”…" class="headerlink" title="ç‰›æ’ç«é”…"></a>ç‰›æ’ç«é”…</h2><p>é£Ÿæï¼š</p>
<ul>
<li>ç‰›æ’</li>
<li>å°è‘±</li>
<li>ç”Ÿå§œ</li>
<li>è’œå­</li>
<li>å¹²è¾£æ¤’</li>
<li>ç«é”…åº•æ–™</li>
<li>è°ƒæ–™ï¼šæ–™é…’ã€</li>
</ul>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>ç‰›æ’+é»„é…’+å°è‘±+ç”Ÿå§œ+ç„¯æ°´ ï¼Œç›´è‡³æ°´å¼€</li>
<li>æ°´å¼€åï¼Œæå‡ºæ¥æ´—è‚‰</li>
<li>é”…ä¸­æ”¾å…¥å°‘è®¸æ²¹  åŠ å…¥æ´—åçš„è‚‰çˆ†ç‚’</li>
<li>åŠ é€‚é‡é»„é…’ ã€å°é†‹ ã€ç”ŸæŠ½ã€è€æŠ½åï¼ŒåŠ æ°´ç›–è¿‡è‚‰ï¼Œç…®è‡³æ°´å¼€</li>
<li>æ°´å¼€ååŠ å…¥ç«é”…åº•æ–™ï¼Œç”Ÿå§œï¼Œè’œå­ï¼Œå¹²è¾£æ¤’</li>
<li>æŠŠè‚‰å’Œæ±¤å€’å…¥é”…ï¼Œå°ç«ç‚–è‡³è½¯çƒ‚ï¼ˆ2hï¼‰ï¼Œä¸­é—´è¦å»ç¿»ä¸€ä¸‹ï¼Œé¿å…ç³Šé”…</li>
</ul>
<p>æˆå“ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48f5907a789a48468c68209624a58eaa~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<h2 id="å¤é¸¡è…¿å’Œé¸¡è›‹"><a href="#å¤é¸¡è…¿å’Œé¸¡è›‹" class="headerlink" title="å¤é¸¡è…¿å’Œé¸¡è›‹"></a>å¤é¸¡è…¿å’Œé¸¡è›‹</h2><p>é£Ÿæï¼š</p>
<ol>
<li>ä¸»é£Ÿæï¼šé¸¡è…¿ã€é¸¡è›‹</li>
<li>å»è…¥ï¼šè‘±ï¼Œå§œï¼Œè’œï¼Œæ–™é…’</li>
<li>æ±¤åº•ä½æ–™ï¼š3ç²’å…«è§’ï¼Œ3ç‰‡é¦™å¶ï¼Œ2ç‰‡æ¡‚çš®ï¼Œ5ç‰‡å¹²è¾£æ¤’ï¼Œä¸€æ“èŠ±æ¤’ï¼Œ8ç²’å†°ç³–ï¼Œ4å‹ºç”ŸæŠ½ï¼Œ2å‹ºè€æŠ½ï¼Œä¸€å‹ºé»„è±†é…±ï¼Œå°‘è®¸é¸¡ç²¾ï¼Œä¸¤ç¢—åŠæ°´ï¼Œ</li>
</ol>
<p>æ­¥éª¤ï¼š</p>
<ul>
<li>è‘±ï¼Œå§œï¼Œè’œï¼Œæ–™é…’ï¼Œ4ä¸ªé¸¡è…¿æ”¹åˆ€ï¼Œ4ä¸ªé¸¡è›‹ï¼Œå†·æ°´ä¸‹é”…</li>
<li>é¸¡è…¿æ°´å¼€åä¸€ä¼šæå‡ºï¼Œæ´—å‡€æµ®æ²«ï¼Œå¤‡ç”¨</li>
<li>é¸¡ç…®ååˆ†é’Ÿæå‡ºï¼Œå‰¥å£³ï¼Œå¤‡ç”¨</li>
<li>3ç²’å…«è§’ï¼Œ3ç‰‡é¦™å¶ï¼Œ2ç‰‡æ¡‚çš®ï¼Œ5ç‰‡å¹²è¾£æ¤’ï¼Œä¸€æ“èŠ±æ¤’ï¼Œ8ç²’å†°ç³–ï¼Œ4å‹ºç”ŸæŠ½ï¼Œ2å‹ºè€æŠ½ï¼Œä¸€å‹ºé»„è±†é…±ï¼Œå°‘è®¸é¸¡ç²¾ï¼Œä¸¤ç¢—åŠæ°´ï¼Œå¤‡ç”¨é¸¡è…¿å’Œé¸¡è›‹</li>
<li>å¤§ç«çƒ§è‡³æ°´å¼€</li>
<li>å°ç«æ…¢ç‚–1h</li>
</ul>
<p>æˆå“ï¼šå·¨é¦™æ— æ¯”ï¼Œè¿™è°ƒæ–™å¤é‹åº•éƒ½å¥½åƒ</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6e4262b61c64045bb8f319fdce1ea93~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/13/%E7%A8%8B%E5%BA%8F%E7%8C%BF%E7%83%A7%E9%A5%AD%E6%8C%87%E5%8D%97%E2%80%94%E2%80%94%E5%87%86%E5%A4%87%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/13/%E7%A8%8B%E5%BA%8F%E7%8C%BF%E7%83%A7%E9%A5%AD%E6%8C%87%E5%8D%97%E2%80%94%E2%80%94%E5%87%86%E5%A4%87%E7%AF%87/" class="post-title-link" itemprop="url">ç¨‹åºçŒ¿çƒ§é¥­æŒ‡å—â€”â€”å‡†å¤‡ç¯‡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-05-13 16:38:04" itemprop="dateCreated datePublished" datetime="2023-05-13T16:38:04+08:00">2023-05-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-15 09:41:32" itemprop="dateModified" datetime="2023-05-15T09:41:32+08:00">2023-05-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%83%A7%E9%A5%AD%E6%8C%87%E5%8D%97/" itemprop="url" rel="index"><span itemprop="name">ç¨‹åºå‘˜çƒ§é¥­æŒ‡å—</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="å‡†å¤‡ï¼ˆå…±è®¡èŠ±è´¹751-4å…ƒï¼‰"><a href="#å‡†å¤‡ï¼ˆå…±è®¡èŠ±è´¹751-4å…ƒï¼‰" class="headerlink" title="å‡†å¤‡ï¼ˆå…±è®¡èŠ±è´¹751.4å…ƒï¼‰"></a>å‡†å¤‡ï¼ˆå…±è®¡èŠ±è´¹751.4å…ƒï¼‰</h2><p>å¨å…·ï¼š664å…ƒ</p>
<ul>
<li>ç”µé¥­ç…²ï¼šç…®é¥­ã€ç²¥</li>
<li>åˆ€ã€ç §æ¿ã€å‰ªåˆ€ï¼šåˆ‡èœ</li>
<li>ç‚’é”…ã€é“²å­ï¼šç‚’èœã€çƒ§å¤§èœã€ä¸‹é¢æ¡ã€ç‚’é¢</li>
<li>ç¢—ã€ç¢Ÿã€ç­·å­ã€å‹ºå­ï¼šåƒé¥­ã€è£…èœ</li>
<li>è°ƒæ–™ç›’ã€æ²¹å£¶ï¼šè£…è°ƒæ–™</li>
</ul>
<p>è°ƒæ–™ï¼š87.4å…ƒ</p>
<ul>
<li>ç›</li>
<li>ç³–</li>
<li>åä¸‰é¦™</li>
<li>è¾£æ¤’</li>
<li>é¸¡ç²¾ã€å‘³ç²¾</li>
<li>ç”ŸæŠ½</li>
<li>è€æŠ½é…±æ²¹</li>
<li>èšæ²¹</li>
<li>æ–™é…’</li>
<li>é†‹</li>
<li>é»„è±†é…±</li>
<li>è±†ç“£é…±</li>
<li>æ·€ç²‰</li>
<li>ç›ç„—ç²‰</li>
<li>ç«é”…åº•æ–™</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/20/vue3%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%B8%AD%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/20/vue3%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%B8%AD%EF%BC%89/" class="post-title-link" itemprop="url">vue3å“åº”å¼ç³»ç»Ÿä½œç”¨ä¸å®ç°ï¼ˆä¸­ï¼‰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-20 15:53:18" itemprop="dateCreated datePublished" datetime="2022-08-20T15:53:18+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-07 17:49:37" itemprop="dateModified" datetime="2023-05-07T17:49:37+08:00">2023-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0-è°ƒåº¦æ‰§è¡Œ"><a href="#0-è°ƒåº¦æ‰§è¡Œ" class="headerlink" title="0 è°ƒåº¦æ‰§è¡Œ"></a>0 è°ƒåº¦æ‰§è¡Œ</h2><p>å¯è°ƒåº¦æ€§æ˜¯å“åº”å¼ç³»ç»Ÿéå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒæ˜¯æŒ‡å½“<code>trigger</code>è§¦å‘å‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œæ—¶ï¼Œæœ‰èƒ½åŠ›å†³å®šå‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œçš„æ—¶æœºã€æ¬¡æ•°å’Œæ–¹å¼ã€‚å®ç°å¯è°ƒåº¦æ€§ï¼Œå¯ä»¥ä¸ºç”¨æˆ·è®¾è®¡ä¸€ä¸ªé€‰æ‹©å‚æ•°<code>options</code>ï¼Œå®ƒå…è®¸å®¢æˆ·æŒ‡å®šè°ƒåº¦å™¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºå‰¯ä½œç”¨å‡½æ•°æ–°å¢é€‰é¡¹å…¥å£</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">effect</span>(<span class="params">fn, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">effectFn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="title function_">cleanup</span>(effectFn)</span><br><span class="line">        activeEffect = effectFn</span><br><span class="line">        effectStack.<span class="title function_">push</span>(effectFn)</span><br><span class="line">        <span class="title function_">fn</span>()</span><br><span class="line">        effectStack.<span class="title function_">pop</span>()</span><br><span class="line">        activeEffect = effectStack[effectStack.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†optionsæŒ‚åœ¨åˆ°effectFnä¸Š</span></span><br><span class="line">    effectFn.<span class="property">options</span> = options</span><br><span class="line">    effectFn.<span class="property">deps</span> = []</span><br><span class="line">    <span class="title function_">effectFn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> depsMap = bucket.<span class="title function_">get</span>(target)</span><br><span class="line">    <span class="keyword">if</span>(!depsMap) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">const</span> effects = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> effectsToRun = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    effects &amp;&amp; effects.<span class="title function_">forEach</span>(<span class="function"><span class="params">effectFn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(effectFn !== activeEffect) &#123;</span><br><span class="line">            effectsToRun.<span class="title function_">add</span>(effectFn)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    effectsToRun.<span class="title function_">forEach</span>(<span class="function"><span class="params">effectFn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå‰¯ä½œç”¨å‡½æ•°å­˜åœ¨è°ƒåº¦å™¨ï¼Œåˆ™è°ƒç”¨è¯¥è°ƒåº¦å™¨</span></span><br><span class="line">        <span class="keyword">if</span>(effectFn.<span class="property">options</span>.<span class="property">scheduler</span>) &#123;</span><br><span class="line">            effectFn.<span class="property">options</span>.<span class="title function_">scheduler</span>(effectFn)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦åˆ™ç›´æ¥æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line">            <span class="title function_">effectFn</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ã€æœ‰äº†è°ƒåº¦å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œçš„æ—¶æœº</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(data, &#123;...&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">effect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">foo</span>) &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">foo</span> += <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç æ²¡æœ‰åŠ å…¥è°ƒåº¦å™¨ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220724144941211.png" alt="image-20220724144941211"></p>
<p>ç»™å‰¯ä½œç”¨å‡½æ•°æ·»åŠ è°ƒåº¦å™¨ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">effect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">foo</span>) &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_">scheduler</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(fn)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>é‡æ–°æ‰§è¡Œä»£ç ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220724145439211.png" alt="image-20220724145439211"></p>
<p>é€šè¿‡é…ç½®<code>scheduler</code>ï¼Œä½¿ç”¨<code>setTimeout</code>å¼€å¯äº†ä¸€ä¸ªå®ä»»åŠ¡æ¥æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼Œå¯¹å‰¯ä½œç”¨å‡½æ•°çš„<strong>å†æ¬¡æ‰§è¡Œçš„æ—¶æœº</strong>è¿›è¡Œäº†æ§åˆ¶ã€‚</p>
<p>äºŒã€æœ‰äº†è°ƒåº¦å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œçš„æ¬¡æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">effect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">foo</span>) &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">foo</span>++</span><br><span class="line">obj.<span class="property">foo</span>++</span><br></pre></td></tr></table></figure>

<p>è¯¥ä»£ç çš„æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220724150211462.png" alt="image-20220724150211462"></p>
<p>å› ä¸º<code>obj.foo</code>è¿›è¡Œäº†ä¸¤æ¬¡å†™æ“ä½œï¼Œæ‰€ä»¥ä¸Šè¿°çš„å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œä½†å¦‚æœæˆ‘ä»¬å¹¶ä¸å…³å¿ƒä¸­é—´çš„è¿‡ç¨‹ï¼Œåªå…³å¿ƒæœ€åçš„ç»“æœï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡æ‰“å°å°±æ˜¯å¤šä½™çš„ã€‚ä¸‹é¢ä½¿ç”¨è°ƒåº¦å™¨æ¥å®ç°æ­¤åŠŸèƒ½ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jobQueue = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line"><span class="keyword">const</span> p = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isFlushing = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">flushJob</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(isFlushing) <span class="keyword">return</span></span><br><span class="line">    isFlushing = <span class="literal">true</span></span><br><span class="line">    p.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        jobQueue.<span class="title function_">forEach</span>(<span class="function"><span class="params">job</span> =&gt;</span> <span class="title function_">job</span>())</span><br><span class="line">    &#125;).<span class="property">finally</span> (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        isFlushing = <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">effect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">foo</span>) &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title function_">scheduler</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">            jobQueue.<span class="title function_">add</span>(fn)</span><br><span class="line">            <span class="title function_">flushJob</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">foo</span>++</span><br><span class="line">obj.<span class="property">foo</span>++</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥è°ƒåº¦å™¨ä¸‹ï¼Œä»£ç çš„æ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ‰§è¡ŒåŒæ­¥ä»»åŠ¡<code>effect</code>å‡½æ•°ï¼Œè¾“å‡ºäº†<code>foo</code>çš„å€¼1ï¼Œè§¦å‘äº†<code>track</code>ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°å’Œè¯¥å±æ€§è¿›è¡Œä¾èµ–ç»‘å®š</li>
<li>æ‰§è¡ŒåŒæ­¥ä»»åŠ¡<code>obj.foo++</code>ï¼Œè§¦å‘<code>trigger</code>ï¼Œæ£€æŸ¥å­˜åœ¨è°ƒåº¦å™¨ï¼Œæ‰§è¡Œè°ƒåº¦å™¨<code>scheduler</code></li>
<li>å°†å‰¯ä½œç”¨å‡½æ•°åŠ å…¥<code>jobQueue</code>ï¼Œè®¾ç½®<code>isFlushing</code>ä¸º<code>true</code>ï¼Œå°†<code>jobQueue</code>çš„æ‰§è¡ŒåŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å†æ¬¡æ‰§è¡ŒåŒæ­¥ä»»åŠ¡<code>obj.foo++</code>ï¼Œè§¦å‘<code>trigger</code>ï¼Œæ£€æŸ¥å­˜åœ¨è°ƒåº¦å™¨ï¼Œæ‰§è¡Œè°ƒåº¦å™¨<code>scheduler</code></li>
<li>å°†å‰¯ä½œç”¨å‡½æ•°å†æ¬¡åŠ å…¥<code>jobQueue</code>ï¼Œå†æ¬¡æ‰§è¡Œ<code>flushJob</code><ul>
<li>å› ä¸º<code>jobQueue</code>æ˜¯<code>set</code>ç»“æ„ï¼Œå’Œå‰ä¸€æ¬¡æ·»åŠ çš„å‰¯ä½œç”¨å‡½æ•°ä¸€æ ·ï¼Œæ•…ä¸æ‰§è¡Œæ·»åŠ åŠ¨ä½œã€‚</li>
<li>å› ä¸º<code>isFlushing</code>ä¸º<code>true</code>ï¼Œç›´æ¥<code>return</code></li>
</ul>
</li>
<li>æ‰§è¡Œå¾®ä»»åŠ¡<code> jobQueue.forEach(job =&gt; job())</code>ï¼Œè¾“å‡º<code>foo</code>çš„å€¼3</li>
</ul>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220724152505285.png" alt="image-20220724152505285"></p>
<h2 id="1-è®¡ç®—å±æ€§computed"><a href="#1-è®¡ç®—å±æ€§computed" class="headerlink" title="1 è®¡ç®—å±æ€§computed"></a>1 è®¡ç®—å±æ€§computed</h2><p>è®¡ç®—å±æ€§ç”¨äºæè¿°å’Œä¾èµ–å“åº”å¼æ•°æ®çš„é€»è¾‘ï¼Œå®ƒå…·æœ‰<strong>ç¼“å­˜</strong>çš„ç‰¹ç‚¹ï¼Œå³ä¾èµ–çš„å“åº”å¼æ•°æ®æ²¡æœ‰å˜åŒ–çš„è¯ï¼Œæ— è®ºå¦‚ä½•è®¿é—®è¯¥è®¡ç®—å±æ€§éƒ½ä¸ä¼šé‡æ–°è®¡ç®—ã€‚å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">computed</span>(<span class="params">getter</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">let</span> dirty = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> effectFn = <span class="title function_">effect</span>(getter, &#123;</span><br><span class="line">        <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// å¦‚æœè§¦å‘trackï¼Œå°±ä¼šæ‰§è¡Œè°ƒåº¦ï¼Œè®¾ç½®dirtyä¸ºtrueï¼Œé‡æ–°æ‰§è¡Œ</span></span><br><span class="line">        <span class="comment">// å¦‚è‚¡ä¸è§¦å‘trackï¼Œä¸ä¼šæ‰§è¡Œè°ƒåº¦ï¼Œdirtyä¿æŒfalseï¼Œå–å€¼ç¼“å­˜</span></span><br><span class="line">        <span class="title function_">scheduler</span>(<span class="params"></span>) &#123;</span><br><span class="line">            dirty = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> obj = &#123;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span>(dirty) &#123;</span><br><span class="line">                value = <span class="title function_">effectFn</span>()</span><br><span class="line">                dirty = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">effect</span>(<span class="params">fn, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">effectFn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="title function_">cleanup</span>(effectFn)</span><br><span class="line">        activeEffect = effectFn</span><br><span class="line">        effectStack.<span class="title function_">push</span>(effectFn)</span><br><span class="line">        <span class="comment">// å°†ç»“æœå­˜å‚¨åˆ°resï¼Œå¹¶è¿”å›</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="title function_">fn</span>()</span><br><span class="line">        effectStack.<span class="title function_">pop</span>()</span><br><span class="line">        activeEffect = effectStack[effectStack.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">    effectFn.<span class="property">options</span> = options</span><br><span class="line">    effectFn.<span class="property">deps</span> = []</span><br><span class="line">    <span class="comment">// åªæœ‰é lazy æ—¶ï¼Œæ‰æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span>(!options.<span class="property">lazy</span>) &#123;</span><br><span class="line">        <span class="title function_">effectFn</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> effectFn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>computedå±æ€§é€šè¿‡è®¾ç½®lazyå±æ€§å®ç°æ‡’åŠ è½½ï¼Œåªæœ‰å½“çœŸæ­£çš„è®¿é—®è¯¥è®¡ç®—å±æ€§ï¼Œæ‰ä¼šæ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ã€‚</p>
<p>computedæ–¹æ³•å†…ç½®äº†dirtyå­—æ®µç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼š</p>
<ul>
<li>é¦–æ¬¡è°ƒç”¨computedæ—¶ï¼Œlazyä¸ºtrueï¼Œå› æ­¤ä¼šæ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°getterï¼Œè®¾ç½®dirtyä¸ºfalseå¹¶å°†å€¼å­˜å‚¨åœ¨valueä¸­è¿”å›ï¼›</li>
<li>è‹¥å‰¯ä½œç”¨å‡½æ•°getterä¾èµ–çš„å“åº”å¼æ•°æ®æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šè§¦å‘schedulerï¼Œdirtyä¾ç„¶ä¸ºfalseï¼Œæ•…è®¿é—®computedä¸ä¼šæ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°getterï¼Œç›´æ¥è¿”å›ç¼“å­˜çš„å€¼valueï¼›</li>
<li>è‹¥å‰¯ä½œç”¨å‡½æ•°getterä¾èµ–çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¼šè§¦å‘schedulerï¼Œdirtyå˜ä¸ºtrueï¼Œè®¿é—®computedé‡æ–°æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°getterï¼Œå¹¶è¿”å›æ‰§è¡Œæ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°getteråçš„valueï¼›</li>
</ul>
<p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sumRes = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> value = obj.<span class="property">foo</span> + obj.<span class="property">bar</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;computed run!&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sumRes.<span class="property">value</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sumRes.<span class="property">value</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sumRes.<span class="property">value</span>)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">foo</span>++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sumRes.<span class="property">value</span>)</span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹ï¼Œç¬¦åˆé¢„æœŸã€‚</p>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220818230818531.png" alt="image-20220818230818531"></p>
<p>ä½†æ˜¯ç°åœ¨çš„è®¡ç®—å±æ€§è¿˜ä¸å®Œå–„ï¼Œå½“æˆ‘ä»¬åœ¨å¦ä¸€ä¸ªeffectä¸­è¯»å–computedå±æ€§æ—¶ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sumRes = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> value = obj.<span class="property">foo</span> + obj.<span class="property">bar</span></span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">effect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(sumRes.<span class="property">value</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">foo</span>++</span><br></pre></td></tr></table></figure>

<p>å½“obj.fooä¿®æ”¹æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›å‰¯ä½œç”¨å‡½æ•°ä¼šé‡æ–°æ‰§è¡Œï¼Œå°±å¦‚åŒæˆ‘ä»¬åœ¨vueä¸­ä½¿ç”¨è®¡ç®—å±æ€§æ—¶ï¼Œå¸Œæœ›è®¡ç®—å±æ€§å˜åŒ–æ—¶ä¼šé‡æ–°æ¸²æŸ“æ¨¡æ¿ä¸€æ ·ï¼Œä½†æ˜¯ä¸Šè¿°ä»£ç å¹¶æ²¡æœ‰é‡æ–°æ‰§è¡Œeffectå‡½æ•°ã€‚å› ä¸ºè®¡ç®—å±æ€§æ˜¯æ‡’åŠ è½½çš„ï¼Œå¿…é¡»è®¿é—®æ‰èƒ½è§¦å‘ï¼Œå¯¹äºè®¡ç®—å±æ€§çš„getterå‰¯ä½œç”¨å‡½æ•°è€Œè¨€ï¼Œå®ƒå†…éƒ¨è®¿é—®çš„åƒåŸå§‹æ•°æ®åªä¼šæŠŠgetterå‰¯ä½œç”¨å‡½æ•°æ”¶é›†ä¸ºä¾èµ–ï¼Œä¸ä¼šæ”¶é›†è°ƒç”¨computedçš„å‰¯ä½œç”¨å‡½æ•°effectã€‚ä¿®æ”¹èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨trackè¿›è¡Œè·Ÿè¸ªï¼›å½“è®¡ç®—å±æ€§ä¾èµ–çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰‹åŠ¨è°ƒç”¨triggerè§¦å‘å“åº”ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">computed</span>(<span class="params">getter</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">let</span> dirty = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> effectFn = <span class="title function_">effect</span>(getter, &#123;</span><br><span class="line">        <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="title function_">scheduler</span>(<span class="params"></span>) &#123;</span><br><span class="line">            dirty = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨è§¦å‘å‡½æ•°å“åº”</span></span><br><span class="line">            <span class="title function_">trigger</span>(obj, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> obj = &#123;</span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span>(dirty) &#123;</span><br><span class="line">                value = <span class="title function_">effectFn</span>()</span><br><span class="line">                dirty = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨è¿½è¸ª</span></span><br><span class="line">            <span class="title function_">track</span>(obj, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220819002031612.png" alt="image-20220819002031612"></p>
<h2 id="2-ä¾¦å¬å™¨watched"><a href="#2-ä¾¦å¬å™¨watched" class="headerlink" title="2 ä¾¦å¬å™¨watched"></a>2 ä¾¦å¬å™¨watched</h2><p>åœ¨vueä¸­ï¼Œä¾¦å¬å™¨watchedåº”è¯¥åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼šç›‘å¬æ•°æ®å˜åŒ–ï¼ˆå­˜å‚¨æ—§å€¼çš„èƒ½åŠ›ï¼‰ï¼Œå¹¶æ‰§è¡Œå›è°ƒå‡½æ•°</p>
<table>
<thead>
<tr>
<th>åˆ’åˆ†å±‚æ¬¡</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>ç›‘å¬æ•°æ®</td>
<td>1ï¼‰ç›‘å¬å“åº”å¼æ•°æ® <br />2ï¼‰ç›‘å¬getterå‡½æ•°</td>
</tr>
<tr>
<td>ä»ç›‘å¬å±‚æ¬¡</td>
<td>1ï¼‰æµ…ç›‘å¬ï¼šæŸä¸ªå€¼çš„å˜åŒ–<br />2ï¼‰æ·±ç›‘å¬ï¼šå¯¹è±¡çš„æ¯ä¸ªå±æ€§</td>
</tr>
<tr>
<td>ç¬¬ä¸€æ¬¡æ˜¯å¦æ‰§è¡Œ</td>
<td>1ï¼‰å›è°ƒæ‡’æ‰§è¡Œï¼šé»˜è®¤ <br />2ï¼‰ç«‹å³å›è°ƒï¼šimmediateä¸ºtrue</td>
</tr>
<tr>
<td>å›è°ƒæ‰§è¡Œæ—¶æœº</td>
<td>1ï¼‰ç»„ä»¶æ›´æ–°ä¹‹å‰è°ƒç”¨ï¼šé»˜è®¤ï¼Œflushä¸ºpre<br />2ï¼‰åŒæ­¥æ‰§è¡Œï¼šflushä¸ºsync<br />3ï¼‰ç»„ä»¶æ›´æ–°åè°ƒç”¨ï¼šflushä¸ºpost</td>
</tr>
</tbody></table>
<h3 id="åŸºæœ¬å®ç°"><a href="#åŸºæœ¬å®ç°" class="headerlink" title="åŸºæœ¬å®ç°"></a>åŸºæœ¬å®ç°</h3><p>watchçš„æœ¬è´¨å°±æ˜¯è§‚æµ‹ä¸€ä¸ªå“åº”å¼æ•°æ®ï¼Œå¹¶åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥æ‰§è¡Œç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚</p>
<ul>
<li>é¦–å…ˆåˆ¤æ–­ç›‘å¬çš„æ•°æ®æ˜¯å“åº”å¼æ•°æ®è¿˜æ˜¯getterå‡½æ•°<ul>
<li>å“åº”å¼æ•°æ®é€’å½’è¯»å–ï¼Œå»ºç«‹ä¾èµ–å…³ç³»</li>
<li>getterå‡½æ•°ç›´æ¥æ‰§è¡Œ</li>
</ul>
</li>
<li>lazyå±æ€§é…åˆscheduleä½¿ç”¨ï¼Œåœ¨æ•°æ®å˜åŒ–æ—¶ï¼Œè§¦å‘å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”å¸¦ä¸Šæ–°è€value</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">watch</span>(<span class="params">source, cb</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> getter</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> source === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        getter = source</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        getter = <span class="function">() =&gt;</span> <span class="title function_">traverse</span>(source)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newValue, oldValue</span><br><span class="line">    <span class="keyword">const</span> effectFn = <span class="title function_">effect</span>(</span><br><span class="line">        <span class="function">() =&gt;</span> <span class="title function_">getter</span>(),</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// æ•°æ®å˜åŒ–æ—¶ï¼Œè§¦å‘å›è°ƒå‡½æ•°</span></span><br><span class="line">            <span class="title function_">scheduler</span>(<span class="params"></span>) &#123;</span><br><span class="line">                newValue = <span class="title function_">effectFn</span>()</span><br><span class="line">                <span class="title function_">cb</span>(newValue, oldValue)</span><br><span class="line">                oldValue = newValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    oldValue = <span class="title function_">effectFn</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€’å½’è¯»å–ï¼Œå»ºç«‹ä¾èµ–å…³ç³»</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">traverse</span>(<span class="params">value, seen = <span class="keyword">new</span> <span class="built_in">Set</span>()</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> value !== <span class="string">&#x27;object&#x27;</span> || value ===<span class="literal">null</span> || seen.<span class="title function_">has</span>(value)) <span class="keyword">return</span></span><br><span class="line">        seen.<span class="title function_">add</span>(value)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> k <span class="keyword">in</span> value) &#123;</span><br><span class="line">            <span class="title function_">traverse</span>(value[k], seen)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç«‹å³æ‰§è¡Œ-amp-å›è°ƒæ—¶æœº"><a href="#ç«‹å³æ‰§è¡Œ-amp-å›è°ƒæ—¶æœº" class="headerlink" title="ç«‹å³æ‰§è¡Œ &amp; å›è°ƒæ—¶æœº"></a>ç«‹å³æ‰§è¡Œ &amp; å›è°ƒæ—¶æœº</h3><p>watchçš„å›è°ƒå‡½æ•°ä¸€èˆ¬åªä¼šåœ¨å“åº”å¼æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œï¼Œè€Œå¦‚æœæˆ‘ä»¬å¸Œæœ›watchåˆ›å»ºæ—¶ç«‹å³æ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°ï¼Œå¯ä»¥æŒ‡å®šimmediateä¸ºtrueã€‚</p>
<ul>
<li>è¿™é‡Œå°†æ‰§è¡Œå›è°ƒçš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œå¯ä»¥åœ¨ä¸åŒçš„åœ°æ–¹ä½¿ç”¨</li>
<li>immediateåˆ™ç«‹å³æ‰§è¡Œä¸€æ¬¡å›è°ƒï¼Œå¦åˆ™å€¼è®¾ç½®oldValue</li>
<li>flushé€‰é¡¹å†³å®šå›è°ƒè§¦å‘æ—¶çš„æ‰§è¡Œæ—¶æœº<ul>
<li>flushä¸ºpreï¼Œåœ¨ç»„ä»¶æ›´æ–°ä¹‹å‰è°ƒç”¨ï¼Œæ¶‰åŠç»„ä»¶æ›´æ–°æ—¶æœºï¼Œæš‚æ—¶æ— æ³•æ¨¡æ‹Ÿ</li>
<li>flushä¸å­˜åœ¨æ—¶ç›¸å½“äºsyncï¼Œå³åŒæ­¥æ‰§è¡Œ</li>
<li>flushä¸ºpostï¼Œå°†å›è°ƒæ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥å»¶è¿Ÿæ‰§è¡Œ</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">watch</span>(<span class="params">source, cb, options</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> getter</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> source === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        getter = source</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        getter = <span class="function">() =&gt;</span> <span class="title function_">traverse</span>(source)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€’å½’è¯»å–ï¼Œå»ºç«‹ä¾èµ–å…³ç³»</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">traverse</span>(<span class="params">value, seen = <span class="keyword">new</span> <span class="built_in">Set</span>()</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> value !== <span class="string">&#x27;object&#x27;</span> || value ===<span class="literal">null</span> || seen.<span class="title function_">has</span>(value)) <span class="keyword">return</span></span><br><span class="line">        seen.<span class="title function_">add</span>(value)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> k <span class="keyword">in</span> value) &#123;</span><br><span class="line">            <span class="title function_">traverse</span>(value[k], seen)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newValue, oldValue</span><br><span class="line">    <span class="comment">// æå–å…¬å…±é€»è¾‘</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">job</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        newValue = <span class="title function_">effectFn</span>()</span><br><span class="line">        <span class="title function_">cb</span>(newValue, oldValue)</span><br><span class="line">        oldValue = newValue</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> effectFn = <span class="title function_">effect</span>(</span><br><span class="line">        <span class="function">() =&gt;</span> <span class="title function_">getter</span>(),</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// æ•°æ®å˜åŒ–æ—¶ï¼Œè§¦å‘å›è°ƒå‡½æ•°</span></span><br><span class="line">            <span class="attr">scheduler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(opeions.<span class="property">flush</span> === <span class="string">&#x27;post&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> p = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">                    p.<span class="title function_">then</span>(job)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">job</span>()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// immediateä¸ºtrueç«‹å³æ‰§è¡Œå›è°ƒ</span></span><br><span class="line">    <span class="keyword">if</span>(options.<span class="property">immediate</span>) &#123;</span><br><span class="line">        <span class="title function_">job</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        oldValue = <span class="title function_">effectFn</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç«æ€é—®é¢˜-amp-è¿‡æœŸçš„å‰¯ä½œç”¨"><a href="#ç«æ€é—®é¢˜-amp-è¿‡æœŸçš„å‰¯ä½œç”¨" class="headerlink" title="ç«æ€é—®é¢˜ &amp; è¿‡æœŸçš„å‰¯ä½œç”¨"></a>ç«æ€é—®é¢˜ &amp; è¿‡æœŸçš„å‰¯ä½œç”¨</h3><p>ç«æ€é—®é¢˜é€šå¸¸åœ¨å¤šè¿›ç¨‹æˆ–å¤šçº¿ç¨‹ä¸­è¢«æåŠï¼Œè€Œåœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œä¹Ÿä¼šé‡åˆ°ç±»ä¼¼çš„åœºæ™¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> finalData</span><br><span class="line"><span class="title function_">watch</span>(obj, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/path/to/request&#x27;</span>)</span><br><span class="line">    finalData = res</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œé€šè¿‡ä¿®æ”¹objçš„å€¼è§¦å‘å›è°ƒï¼Œå…ˆåå‘å‡ºäº†ä¸¤æ¬¡è¯·æ±‚Aå’ŒBã€‚æˆ‘ä»¬æœŸæœ›çš„æ˜¯finalDataæ‹¿åˆ°æœ€æ–°çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯Bè¿”å›çš„æ•°æ®ï¼Œä½†æ˜¯è‹¥Bçš„å“åº”è¾ƒå¿«ï¼Œåˆ™å¯èƒ½å‡ºç°Aå“åº”æ•°æ®ååˆ°çš„æƒ…å†µï¼Œå¹¶ä¸”å°†Bè¿”å›çš„å€¼ç»™è¦†ç›–æ‰ã€‚</p>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220820152345561.png" alt="image-20220820152345561"></p>
<p>åœ¨vueä¸­ï¼Œwatchå‡½æ•°çš„å›è°ƒå‡½æ•°æ¥å—ç¬¬ä¸‰ä¸ªå‚æ•°onInvalidateï¼ŒonInvalidateå‡½æ•°ä¼šåœ¨å½“å‰å‰¯ä½œç”¨å‡½æ•°è¿‡æœŸæ—¶æ‰§è¡Œã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> finalData</span><br><span class="line"><span class="title function_">watch</span>(obj, <span class="keyword">async</span> (newValue, oldValue, onInvalidate) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> expired = <span class="literal">false</span></span><br><span class="line">    <span class="title function_">onInvalidate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        expired = <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/path/to/request&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!expired) &#123;</span><br><span class="line">        finalData = res</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>onInvalidateå®ç°çš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨watchæ¯æ¬¡æ£€æµ‹åˆ°å˜æ›´åï¼Œåœ¨å‰¯ä½œç”¨å‡½æ•°é‡æ–°æ‰§è¡Œå‰ï¼Œä¼šè°ƒç”¨æˆ‘ä»¬é€šè¿‡onInvalidateå‡½æ•°æ³¨å†Œçš„è¿‡æœŸå›è°ƒã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">watch</span>(<span class="params">source, cb, options</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> getter</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> source === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        getter = source</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        getter = <span class="function">() =&gt;</span> <span class="title function_">traverse</span>(source)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€’å½’è¯»å–ï¼Œå»ºç«‹ä¾èµ–å…³ç³»</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">traverse</span>(<span class="params">value, seen = <span class="keyword">new</span> <span class="built_in">Set</span>()</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">typeof</span> value !== <span class="string">&#x27;object&#x27;</span> || value ===<span class="literal">null</span> || seen.<span class="title function_">has</span>(value)) <span class="keyword">return</span></span><br><span class="line">        seen.<span class="title function_">add</span>(value)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> k <span class="keyword">in</span> value) &#123;</span><br><span class="line">            <span class="title function_">traverse</span>(value[k], seen)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newValue, oldValue</span><br><span class="line">    <span class="keyword">let</span> cleanup <span class="comment">// å­˜å‚¨è¿‡æœŸå‡½æ•°</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onInvalidate</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">        cleanup = fn</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æå–å…¬å…±é€»è¾‘</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">job</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        newValue = <span class="title function_">effectFn</span>()</span><br><span class="line">        <span class="comment">// è°ƒç”¨å›è°ƒå‡½æ•°ä¹‹å‰ï¼Œå…ˆè°ƒç”¨è¿‡æœŸå›è°ƒ</span></span><br><span class="line">        <span class="keyword">if</span>(cleanup) &#123;</span><br><span class="line">            <span class="title function_">cleanup</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// onInvalidateä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¾›ç”¨æˆ·ä½¿ç”¨</span></span><br><span class="line">        <span class="title function_">cb</span>(newValue, oldValue, onInvalidate)</span><br><span class="line">        oldValue = newValue</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> effectFn = <span class="title function_">effect</span>(</span><br><span class="line">        <span class="function">() =&gt;</span> <span class="title function_">getter</span>(),</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">lazy</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// æ•°æ®å˜åŒ–æ—¶ï¼Œè§¦å‘å›è°ƒå‡½æ•°</span></span><br><span class="line">            <span class="attr">scheduler</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(opeions.<span class="property">flush</span> === <span class="string">&#x27;post&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> p = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">                    p.<span class="title function_">then</span>(job)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">job</span>()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// immediateä¸ºtrueç«‹å³æ‰§è¡Œå›è°ƒ</span></span><br><span class="line">    <span class="keyword">if</span>(options.<span class="property">immediate</span>) &#123;</span><br><span class="line">        <span class="title function_">job</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        oldValue = <span class="title function_">effectFn</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº†ä¸Šè¿°çš„ä»£ç åï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸ªç¤ºä¾‹äº†è§£æ‰§è¡Œçš„é¡ºåºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">obj.<span class="property">foo</span>++</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    obj.<span class="property">foo</span>++</span><br><span class="line">&#125;, <span class="number">200</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¿®æ”¹fooæ—¶ï¼Œcleanupä¸ºç©ºï¼Œä¸è§¦å‘è¿‡æœŸå›è°ƒï¼Œç›´æ¥æ‰§è¡Œwatchçš„å›è°ƒå‡½æ•°</li>
<li>ç¬¬ä¸€æ¬¡æ‰§è¡Œwatchå›è°ƒæ—¶ï¼Œè®¾ç½®expiredAä¸ºfalseï¼Œæ³¨å†Œäº†è¿‡æœŸå›è°ƒcleanupA</li>
<li>ç¬¬äºŒæ¬¡ä¿®æ”¹fooæ—¶ï¼Œè¿‡æœŸå›è°ƒcleanupä¸ä¸ºç©ºï¼Œå› æ­¤å…ˆæ‰§è¡ŒcleanupAï¼Œè®¾ç½®expiredAä¸ºtrueï¼Œå†æ‰§è¡Œå›è°ƒå‡½æ•°</li>
<li>ç¬¬äºŒæ¬¡æ‰§è¡Œwatchå›è°ƒæ—¶ï¼Œè®¾ç½®expiredBä¸ºfalseï¼Œæ³¨å†Œäº†è¿‡æœŸå›è°ƒcleanupB</li>
<li>Bå…ˆå“åº”ï¼Œå› ä¸ºexpiredBä¸ºfalseï¼Œè®¾ç½®finalDataä¸ºBè¿”å›çš„å€¼</li>
<li>Aåå“åº”ï¼Œå› ä¸ºexpiredAä¸ºtrueï¼Œä¸è®¾ç½®finalDataçš„å€¼</li>
</ul>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220820154630971.png" alt="image-20220820154630971"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/23/2022%E6%AF%95%E4%B8%9A%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/23/2022%E6%AF%95%E4%B8%9A%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">2022æ¯•ä¸šæ€»ç»“</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-23 21:55:29" itemprop="dateCreated datePublished" datetime="2022-07-23T21:55:29+08:00">2022-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-07 17:21:42" itemprop="dateModified" datetime="2023-05-07T17:21:42+08:00">2023-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93%E6%84%9F%E6%83%B3/" itemprop="url" rel="index"><span itemprop="name">ä¸ªäººæ€»ç»“æ„Ÿæƒ³</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0-å‰è¨€"><a href="#0-å‰è¨€" class="headerlink" title="0 å‰è¨€"></a>0 å‰è¨€</h2><p>å‰å‡ å¤©ï¼Œå’ŒåŒä¸€å±Šæ ¡æ‹›çš„åŒäº‹åƒé¥­çš„è·¯ä¸Šï¼Œæˆ‘æ„Ÿå¹é“ï¼šâ€œæ—¶é—´è¿‡çš„çœŸå¿«ï¼Œè™½ç„¶å·²ç»æˆä¸ºè¿›å…¥ç¤¾ä¼šå¼€å§‹å·¥ä½œäº†ï¼Œä½†æ˜¯æ„Ÿè§‰è‡ªå·±å¥½åƒè¿˜æ˜¯ä¸€ä¸ªå­¦ç”Ÿã€‚â€ </p>
<p>ç»†ç»†å›æƒ³æ¥ï¼Œè‡ªå·±å…­æœˆä»½å¤§å­¦æ¯•ä¸šï¼Œä¸ƒæœˆä»½å°±åŒ†åŒ†æ¥åˆ°åŒ—äº¬å…¥èŒï¼Œæ¥è¸µè€Œæ¥çš„å°±æ˜¯å„å¼å„æ ·çš„æ‰‹ç»­ã€æ ¡æ‹›åŸ¹è®­ã€æ¥éœ€æ±‚å†™ä»£ç ã€‚ç”Ÿæ´»èŠ‚å¥å¿«åˆ°æ²¡ç»™æˆ‘ç•™è¶³å¤Ÿçš„æ—¶é—´å»é€‚åº”å­¦ç”Ÿåˆ°èŒåœºäººçš„è½¬å˜ï¼Œæ²¡ç»™è‡ªå·±ç•™è¶³å¤Ÿçš„æ—¶é—´å»æ€è€ƒåŒ—äº¬è¿™ä¸ªé­”å¹»çš„åŸå¸‚å¯¹æˆ‘è€Œè¨€æ„å‘³ç€ä»€ä¹ˆã€‚</p>
<h2 id="1-æˆ‘ä¸å†æ˜¯å­¦ç”Ÿäº†"><a href="#1-æˆ‘ä¸å†æ˜¯å­¦ç”Ÿäº†" class="headerlink" title="1 æˆ‘ä¸å†æ˜¯å­¦ç”Ÿäº†"></a>1 æˆ‘ä¸å†æ˜¯å­¦ç”Ÿäº†</h2><p>æ ‡é¢˜â€œæˆ‘ä¸å†æ˜¯å­¦ç”Ÿäº†â€æ˜¯ç‰©ç†æ„ä¹‰ä¸Šçš„ï¼Œæˆ‘æ¯•ä¸šäº†ï¼Œæ²¡æœ‰é€‰æ‹©è€ƒç ”ï¼Œæ²¡æœ‰é€‰æ‹©å†æ¬¡ç»å†é«˜è€ƒé‚£æ ·çš„æ²¡æ—¥æ²¡å¤œçš„å­¦ä¹ å’Œç„¦è™‘ã€‚èº«è¾¹å¤§å¤šæ•°çš„æœ‹å‹å’ŒåŒå­¦éƒ½é€‰æ‹©äº†è€ƒç ”ï¼Œè€Œæˆ‘å´â€œé€ƒé¿â€äº†è‡ªå·±ç”Ÿå‘½ä¸­ä¸€æ¬¡æ‹¼æçš„æœºä¼šï¼Œæ²¡ç»™è‡ªå·±ç•™ä¸‹å¤±è´¥çš„é£é™©ï¼Œä½†ä½œä¸ºä»£ä»·æ˜¯æˆ‘å¤±å»äº†ä¸‰å¹´çš„ç¼“å†²æœŸï¼Œæ²¡æœ‰æ—¶é—´ä»”ç»†æ€è€ƒâ€œç¨‹åºå‘˜â€è¿™ä»½å·¥ä½œæ˜¯å¦é€‚åˆè‡ªå·±ï¼Œæ²¡æœ‰æœºä¼šä¸ºè‡ªå·±çš„æœªæ¥ç”»ä¸Šæ›´å¤šçš„å¯èƒ½ã€‚</p>
<p>ç›®å‰æ¥çœ‹ï¼Œâ€œå‰ç«¯â€æ‚„æ— å£°æ¯é—´æˆä¸ºäº†æˆ‘æ¥ä¸‹æ¥å¾ˆé•¿ä¸€æ®µäººç”Ÿä¸­æ— æ³•è„±ç¦»çš„è¯è¯­ã€‚æœ€åˆé€‰æ‹©å­¦ä¹ å‰ç«¯æ˜¯ä¸ºäº†è‡ªå·±æ¯•ä¸šèƒ½æ‰¾åˆ°å…»æ´»è‡ªå·±çš„å·¥ä½œï¼Œå­¦ä¹ çš„è¿‡ç¨‹ä¸­è®©æˆ‘è®¤è¯†äº†è‡ªå·±çš„ä¸è¶³ï¼Œä¹Ÿå¯¹è‡ªå·±çš„ä¸“ä¸šæœ‰äº†æ›´æ·±çš„è®¤è¯†ã€‚åœ¨æ²¡æœ‰å‡†å¤‡è€ƒç ”çš„ä¸€å¹´ä¸­ï¼Œæˆ‘åœ¨ç§‹æ‹›èµ›é“ä¸Šå¼€å§‹äº†ä¸€æ®µå±äºè‡ªå·±æ— å½¢çš„ç«äº‰ï¼Œè¿™æœŸé—´ä¹Ÿç»å¸¸ç„¦è™‘å’Œå¤±çœ ã€‚ç°åœ¨æƒ³æ¥ï¼Œè‡ªå·±è²Œä¼¼è¿˜æ˜¯æ²¡æœ‰é€ƒé¿â€œå¤±è´¥çš„é£é™©â€ã€‚æˆ‘ä»ä¸€å¼€å§‹å°±å¼„é”™äº†ä¸€ä»¶äº‹æƒ…ï¼Œæƒ³è¦æ‹¥æœ‰æ›´å¥½çš„ä¸œè¥¿ï¼Œå°±é¿å…ä¸äº†é€ƒç¦»è‡ªå·±çš„èˆ’é€‚åœˆï¼ŒåŠ å…¥äº’å·çš„åƒä¸‡å¤§å†›ä¸­ã€‚</p>
<p>ç§‹æ‹›ç»“æŸåçš„ä¸¤ä¸ªæœˆï¼Œæˆ‘è¿›å…¥äº†è‡ªå·±çš„â€œç–²è½¯æœŸâ€ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯å°±æ˜¯å¼€å§‹â€œæ‘†çƒ‚â€ã€‚å¾ˆå¤šä¹‹å‰è®¡åˆ’çš„äº‹æƒ…éƒ½æ²¡æœ‰å»å®è¡Œï¼Œæ¯å¤©éƒ½åœ¨çš„å¥–åŠ±å’ŒçŠ’åŠ³è‡ªå·±è¿‡å»è¾›è‹¦çš„ä¸€å¹´ã€‚è¿™ä¹Ÿæ— å¯åšéï¼Œé•¿æ—¶é—´çš„é«˜å¼ºåº¦å­¦ä¹ ï¼Œæ¾æ‡ˆåä¼šæœ‰æ‘†çƒ‚çš„æƒ…å†µå¾ˆå¸¸è§ï¼Œæ¯”å¦‚è¯´é«˜è€ƒç»“æŸçš„æš‘å‡ï¼Œæœ€é‡è¦çš„æ˜¯èƒ½è®©è‡ªå·±çš„ç”Ÿæ´»é‡æ–°å›åˆ°æ­£å¸¸çš„è½¨è¿¹ã€‚</p>
<h2 id="2-ä¾ç„¶æ‘†è„±ä¸äº†å­¦ä¹ "><a href="#2-ä¾ç„¶æ‘†è„±ä¸äº†å­¦ä¹ " class="headerlink" title="2 ä¾ç„¶æ‘†è„±ä¸äº†å­¦ä¹ "></a>2 ä¾ç„¶æ‘†è„±ä¸äº†å­¦ä¹ </h2><p>è™½ç„¶ä¸å†æ˜¯å­¦ç”Ÿï¼Œä½†æ˜¯ä¾ç„¶æ‘†è„±ä¸äº†å­¦ä¹ ï¼Œäº²èº«ä½“ä¼šäº†ä¸€éƒ¨åˆ†â€œæ´»åˆ°è€ï¼Œå­¦åˆ°è€â€è¿™å¥è€è¯çš„é­…åŠ›ã€‚è¨€å½’æ­£ä¼ ï¼Œè¿˜æ˜¯è°ˆè°ˆè‡ªå·±å…¥èŒæ¥çš„ä¸€äº›æ„Ÿå—ã€‚å› ä¸ºä¹‹å‰å‚åŠ è¿‡å®ä¹ ï¼Œæ‰€ä»¥ä¸»ç®¡å’Œå¯¼å¸ˆä¸€ç›´æ¨èæˆ‘ä¸å‚åŠ å…¬å¸çš„å°åŸ¹ï¼Œæ¥åˆ°å…¬å¸ç¬¬äºŒå‘¨å°±å¼€å¹²éœ€æ±‚ã€‚</p>
<p>ç»“æœæ‰“å¼€éœ€æ±‚ä¸€çœ‹ï¼Œå°ç¨‹åºå’Œwebã€‚</p>
<p>æˆ‘ï¼šâ€œå—¯ï¼Œå°ç¨‹åºå’Œwebï¼Œè¿˜å¯ä»¥ã€‚å—¯ï¼Ÿä¸å¯¹ï¼Œæˆ‘å¥½åƒæ²¡æœ‰å†™è¿‡åŸç”Ÿçš„å°ç¨‹åºã€‚â€</p>
<p>å¯¼å¸ˆï¼šâ€œæ²¡äº‹ï¼Œå’Œvueå·®ä¸å¤šï¼Œå†™å†™å°±ä¼šäº†ã€‚â€</p>
<p>æˆ‘ï¼šâ€œï¼Ÿâ€</p>
<p>å¿ƒé‡Œæƒ³ç€ï¼Œå°ç¨‹åºä¹‹å‰æ²¡å†™è¿‡ï¼Œè¿˜æ˜¯å…ˆå†™webå§ï¼Œæ‹¿åˆ°ä»£ç ä¸€çœ‹ã€‚</p>
<p>æˆ‘ï¼šâ€œwcï¼Œè¿™ç»„ä»¶è¦æ€ä¹ˆç”¨å•Šï¼Ÿè¿™ä¸ªè¯­æ³•æ€ä¹ˆè¿™ä¹ˆçœ¼ç†Ÿï¼Œå®ƒæ˜¯ä¸æ˜¯è®¤è¯†æˆ‘ï¼Ÿâ€</p>
<p>æœ€ç»ˆè¿˜æ˜¯ä¸ºè‡ªå·±ä¸¤ä¸ªæœˆçš„æ‘†çƒ‚ï¼ˆä¸€è¡Œä»£ç æ²¡å†™è¿‡ï¼‰ä»˜å‡ºäº†ä»£ä»·ï¼ŒèŠ±äº†åŠå¤©æ—¶é—´åˆæ’¸äº†ä¸€è¾¹vueæ–‡æ¡£å’Œç»„ä»¶åº“æ–‡æ¡£åï¼Œæ‰æ…¢æ…¢æ‰¾å›å†™ä»£ç çš„æ„Ÿè§‰ï¼Œç´§èµ¶æ…¢èµ¶å®Œæˆäº†è‡ªå·±çš„ç¬¬ä¸€ä¸ªwebéœ€æ±‚ã€‚å°ç¨‹åºè¿™è¾¹ç›´ä¹Ÿå°±ç›´æ¥ç¡¬ç€å¤´çš®å¾€ä¸Šå¹²ï¼Œå…¨å½“vueå†™ï¼Œä¸ä¼šçš„åœ°æ–¹å°±æŸ¥æ–‡æ¡£å’Œè°·æ­Œã€‚å‘ç”Ÿäº†næ¬¡ä»¥ä¸‹æƒ…å†µï¼š</p>
<p><code>wx:if</code>å†™æˆ<code>v-if</code>ï¼Œè‡ªå·±è’™åœˆåŠå¤©ï¼Œç„¶åé“ï¼šâ€œè¿™å€¼æ˜æ˜æ˜¯<code>true</code>å•Šï¼Œæ€ä¹ˆä¸æ¸²æŸ“å•Šï¼Ÿâ€</p>
<p>å—¯ï¼Œè¿™ä¸¤ä¸ªæ˜ŸæœŸçš„å¼€å‘å°±æ˜¯è¿™æ ·ä¸€ä¸ªä¸å¤ªç†æƒ³çš„å¼€å§‹ï¼Œå¥½åœ¨éœ€æ±‚æ—¶é—´å®½è£•ï¼ŒåŠ ä¸Šè‡ªå·±åº•å­ä¸å·®ï¼Œè¿˜æ˜¯æ…¢æ…¢é€‚åº”äº†â€œå‰ç«¯ç å†œâ€çš„ç”Ÿæ´»ã€‚</p>
<p>é™¤äº†ä¸Šé¢çš„å°æ’æ›²ï¼Œè‡ªå·±å¯¹æŠ€æœ¯çš„å­¦ä¹ ä¹Ÿæ˜¯å¾ˆè¿·èŒ«ï¼Œä¸€ä¼šæƒ³å­¦ç‚¹nodeï¼Œä¸€ä¼šåˆæƒ³çœ‹çœ‹æ„å»ºå·¥å…·ã€‚ä¸œä¸€æ¦”å¤´ï¼Œè¥¿ä¸€æ£’ï¼Œæœ€åå•¥éƒ½çŸ¥é“ä¸€ç‚¹ï¼Œä½†æ˜¯å•¥åˆä¸çŸ¥é“ã€‚å’Œå¯¼å¸ˆè¿›è¡Œäº†ä¸€æ¬¡æ¿€æƒ…çš„èŠå¤©åæ€»ç»“äº†å‡ ç‚¹ï¼š</p>
<ul>
<li>æŠ€æœ¯å¿…é¡»æœåŠ¡ä¸šåŠ¡ï¼Œåˆ°äº†èŒä¸šç”Ÿæ¶¯åé¢ï¼ŒæŠ€æœ¯åªæ˜¯ä¸€ç§æ‰‹æ®µ</li>
<li>æŠ€æœ¯æ˜¯å¿…é¡»è¦èŠ±æ—¶é—´å­¦ä¹ çš„ï¼Œè¿™æ˜¯ç¨‹åºå‘˜çš„åŸºæœ¬åŠŸ</li>
<li>è¦èŠ±æ—¶é—´åœ¨æŸä¸€ç‚¹ä¸Šç”¨åŠ›ï¼Œä¸èƒ½ç›²ç›®çš„ä¸œçœ‹çœ‹è¥¿çœ‹çœ‹</li>
<li>åœ¨è§£å†³é—®é¢˜ä¸­å­¦ä¹ ä¼šæ›´é«˜æ•ˆï¼Œå¤šå»æƒ³æƒ³ä¸ºä»€ä¹ˆï¼Œå¤šåˆ¨æ ¹é—®åº•ï¼Œè€Œä¸æ˜¯ç®€å•çš„å»å®Œæˆä¸€ä¸ªåŠŸèƒ½</li>
</ul>
<p>ç»™æˆ‘åˆ¶å®šçš„è¯•ç”¨æœŸç›®æ ‡ä¹Ÿå¾ˆç®€å•ï¼š</p>
<ul>
<li>ç‹¬ç«‹å®Œæˆå…¬å¸çš„éœ€æ±‚å¼€å‘</li>
<li>å¯ä»¥æ²¡æœ‰æŠ€æœ¯ä¸Šçš„è´¡çŒ®ï¼Œä½†æ˜¯è¦æœ‰æŠ€æœ¯ä¸Šçš„å­¦ä¹ </li>
<li>å¤šæ€è€ƒï¼Œå¤šæ€»ç»“ï¼Œå¤šç§¯ç´¯</li>
</ul>
<p>æˆ‘è§‰å¾—è¿™äº›äº‹çœ‹èµ·æ¥ç®€å•ï¼Œä½†æ˜¯æƒ³è¦åšå¥½æˆ–è€…æ˜¯è¶…å‡ºé¢„æœŸè¿˜æ˜¯æœ‰éš¾åº¦çš„ï¼Œè¿™äº›è¦æ±‚çš„èƒŒåæœ¬èº«å°±å¯¹ä¸ªäººçš„æ„å¿—çš„ä¸€ç§ç­›é€‰ã€‚æˆ‘è§‰å¾—ä»¤æˆ‘æ•¬ä½©çš„äººï¼Œåšå‡ºä»¤æˆ‘æ„Ÿåˆ°ä¸å¯æ€è®®çš„äº‹æƒ…ï¼Œå…¶å®å°±æ˜¯ä¸–ç•Œå¯¹è¿™ä¸ªäººæ„å¿—çš„ç­›é€‰ã€‚å½“ä½ é€‰æ‹©äº†å»åšä¸€ä»¶ç®€å•ä»¶äº‹ï¼Œå¹¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸€ç›´ä¿æŒç€è‡ªå·±çš„åˆå¿ƒå’Œæ„å¿—ï¼Œæ—¥ç§¯æœˆç´¯ï¼Œæ…¢æ…¢è¾¾åˆ°çš„é«˜åº¦å°±ä¼šè®©ä»–äººæ„Ÿåˆ°ä¸å¯æ€è®®ã€‚è€æ¿å…´å“¥è¯´è¿‡ä¸€å¥è¯ï¼šâ€œé©¬æ‹‰æ¾çš„å¼€å§‹ä¸‡äººç©ç›®ï¼Œç»ˆç‚¹è¿˜æœ‰é²œèŠ±å’Œé¼“æŒï¼Œä½†æ˜¯ä¸­é—´æ¼«é•¿çš„å¿è€å’ŒåšæŒæ˜¯æ²¡æœ‰äººèƒ½çœ‹è§çš„ã€‚â€æˆ‘è§‰å¾—è¿™ä¸­é—´çš„å¿è€å’ŒåšæŒï¼Œå°±æ˜¯ä¸–ç•Œåœ¨å¯¹ä¸ªäººæ„å¿—çš„ç­›é€‰ï¼Œä¸æ­¤åŒæ—¶ï¼Œä½ ä¹Ÿé€‰æ‹©äº†è‡ªå·±æƒ³è¦çš„æˆä¸ºçš„äººã€‚</p>
<p>æœ€åé¼“åŠ±è‡ªå·±ä¸€å¥ï¼šåŠªåŠ›æˆä¸ºè‡ªå·±æƒ³æˆä¸ºçš„äººã€‚</p>
<h2 id="3-ç”Ÿæ´»è¿˜æ˜¯æœ‰è¯—å’Œè¿œæ–¹"><a href="#3-ç”Ÿæ´»è¿˜æ˜¯æœ‰è¯—å’Œè¿œæ–¹" class="headerlink" title="3 ç”Ÿæ´»è¿˜æ˜¯æœ‰è¯—å’Œè¿œæ–¹"></a>3 ç”Ÿæ´»è¿˜æ˜¯æœ‰è¯—å’Œè¿œæ–¹</h2><p>æˆ‘è¿™ç›®å‰ä¹Ÿç®—åŠåªè„šæ­¥å…¥äº†ç¤¾ä¼šï¼Œåº”è¯¥ä¸»åŠ¨æ‰¿æ‹…æ›´å¤šçš„è´£ä»»ã€‚</p>
<p>å¯¹è‡ªå·±æ›´è´Ÿè´£ä¸€ç‚¹ï¼Œä¸Šå¤§å­¦åèƒ–äº†å››åæ–¤ï¼Œå¹³æ—¶æ§åˆ¶é¥®é£Ÿï¼Œå°‘å–ç¢³é…¸é¥®æ–™ï¼Œå¤šå‡ºå»èµ°èµ°ï¼Œå¤šè¿åŠ¨è¿åŠ¨ã€‚è‡ªå·±å¼€é”€å°ä¸€ç‚¹ï¼Œå°½é‡å¤šå­˜ä¸€äº›é’±ã€‚</p>
<p>å¯¹å¥³æœ‹å‹æ›´è´Ÿè´£ä¸€ç‚¹ï¼Œå¼‚åœ°æ‹æœ¬æ¥å°±å¾ˆéš¾ï¼Œå¦‚ä»Šåˆè¦ä¸‰å¹´ï¼Œå¹³æ—¶å¤šé™ªé™ªèŠå¤©ï¼Œæœ‰çŸ›ç›¾æ—¶å¤šä¸€ç‚¹è€å¿ƒï¼Œæœ‰ç©ºå¤šå’Œå¥¹ä¸€èµ·å»æ—…æ¸¸ã€‚</p>
<p>å¯¹å®¶åº­æ›´è´Ÿè´£ä¸€ç‚¹ï¼Œå¤šå­é¡ºçˆ¶æ¯ï¼Œå†å¿™å†ç´¯ä¹ŸæŠ½æ—¶é—´å’Œçˆ¶æ¯èŠèŠå¤©ï¼Œå›å®¶çœ‹çœ‹ã€‚</p>
<h2 id="4-Todo-List"><a href="#4-Todo-List" class="headerlink" title="4 Todo List"></a>4 Todo List</h2><p>æœ€åç»™è‡ªå·±æ¥ä¸‹æ¥çš„åŠå¹´è®°ä¸€ä¸ªTodoå§ã€‚</p>
<p>å·¥ä½œï¼š</p>
<ul>
<li>æŒæ¡å·¥ä½œä¸­ç”¨åˆ°çš„æ‰€æœ‰æŠ€èƒ½</li>
<li>è®¤çœŸåšå¥½è‡ªå·±çš„å·¥ä½œï¼Œå¤šä¸€ç‚¹è€å¿ƒå’ŒåšæŒ</li>
<li>å¤šæ€è€ƒã€å¤šæ€»ç»“ã€å¤šç§¯ç´¯</li>
</ul>
<p>æŠ€æœ¯ï¼š</p>
<ul>
<li>è¯»å®Œã€ŠVueè®¾è®¡ä¸å®ç°ã€‹ï¼Œå¹¶è¾“å‡ºåšå®¢</li>
<li>å­¦ä¹ æ„å»ºå·¥å…·<ul>
<li>viteå­¦ä¹ ï¼Œè¾“å‡ºåšå®¢</li>
<li>webpackå­¦ä¹ ï¼Œè¾“å‡ºåšå®¢</li>
<li>å…¬å¸å†…éƒ¨æ„å»ºå·¥å…·å­¦ä¹ ï¼Œäº‰å–èƒ½åœ¨æ€§èƒ½ä¸Šåšä¸€äº›ä¼˜åŒ–</li>
</ul>
</li>
</ul>
<p>ç”Ÿæ´»ï¼š</p>
<ul>
<li>å‡è‚¥ï¼Œæ§åˆ¶é¥®é£Ÿï¼Œç›®æ ‡ç˜¦20æ–¤</li>
<li>è¿åŠ¨ï¼Œæ¯å‘¨è·‘æ­¥ä¸‰æ¬¡ï¼Œç¯®çƒä¸€æ¬¡</li>
<li>çˆ¶æ¯ï¼Œæ¯å‘¨è‡³å°‘ä¸€æ¬¡ç”µè¯</li>
<li>å¯¹è±¡ï¼Œæ¯å¤©éƒ½è¦èŠå¤©ï¼Œæœ‰æ—¶é—´å°±ç”µè¯</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/17/vue3%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%B8%8A%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/17/vue3%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%B8%8A%EF%BC%89/" class="post-title-link" itemprop="url">vue3å“åº”å¼ç³»ç»Ÿä½œç”¨ä¸å®ç°ï¼ˆä¸Šï¼‰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-17 18:56:18" itemprop="dateCreated datePublished" datetime="2022-07-17T18:56:18+08:00">2022-07-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-07 17:49:25" itemprop="dateModified" datetime="2023-05-07T17:49:25+08:00">2023-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0-å“åº”å¼æ•°æ®å’Œå‰¯ä½œç”¨å‡½æ•°"><a href="#0-å“åº”å¼æ•°æ®å’Œå‰¯ä½œç”¨å‡½æ•°" class="headerlink" title="0 å“åº”å¼æ•°æ®å’Œå‰¯ä½œç”¨å‡½æ•°"></a>0 å“åº”å¼æ•°æ®å’Œå‰¯ä½œç”¨å‡½æ•°</h2><p>åœ¨äº†è§£å“åº”å¼ç³»ç»Ÿä¹‹å‰ï¼Œå…ˆäº†è§£ä»€ä¹ˆæ˜¯<strong>å‰¯ä½œç”¨å‡½æ•°</strong>å’Œ<strong>å“åº”å¼æ•°æ®</strong>ã€‚</p>
<p>å‰¯ä½œç”¨å‡½æ•°ï¼š<code>effect</code>å‡½æ•°çš„æ‰§è¡Œä¼šç›´æ¥æˆ–è€…é—´æ¥çš„å½±å“å…¶ä»–å‡½æ•°çš„æ‰§è¡Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">effect1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerText</span> = <span class="string">&#x27;hello vue3&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> val = <span class="number">1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">effect2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    val = <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å“åº”å¼æ•°æ®ï¼šå½“<code>obj.text</code>çš„å€¼å˜åŒ–åï¼Œå‰¯ä½œç”¨å‡½æ•°èƒ½å¤Ÿé‡æ–°æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯é‡æ–°è®¾ç½®<code>body</code>çš„<code>innerText</code>å±æ€§ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">text</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">effect</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerText</span> = obj.<span class="property">text</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œæ­¤ä»£ç æ—¶ï¼Œeffectå‡½æ•°é‡æ–°æ‰§è¡Œ</span></span><br><span class="line">opj.<span class="property">text</span> = <span class="string">&#x27;hello wk&#x27;</span></span><br></pre></td></tr></table></figure>



<p>å®ç°ä¸€ä¸ªç®€å•çš„å“åº”å¼ç³»ç»Ÿï¼š</p>
<ul>
<li>å½“<code>effect</code>æ‰§è¡Œæ—¶ï¼Œè§¦å‘<code>obj.text</code>çš„<strong>è¯»æ“ä½œ</strong>ï¼Œå°†<code>effect</code>å‡½æ•°å­˜å‚¨åˆ°<code>bucket</code>æ•°æ®ç»“æ„ä¸­ã€‚</li>
<li>å½“<code>obj.text</code>è¢«ä¿®æ”¹æ—¶ï¼Œè§¦å‘<code>obj.text</code>çš„<strong>å†™æ“ä½œ</strong>ï¼Œä»<code>bucket</code>ä¸­æ‹¿å‡º<code>effect</code>å‡½æ•°å¹¶æ‰§è¡Œã€‚</li>
</ul>
<p>åœ¨vue2ä¸­ï¼Œæ˜¯é€šè¿‡<code>Object.defineProperty</code>å‡½æ•°å®ç°çš„ï¼Œåœ¨vue3ä¸­ï¼Œä½¿ç”¨äº†ES5+çš„ä»£ç†å¯¹è±¡<code>Proxy</code>å®ç°ã€‚ä¸‹é¢ä½¿ç”¨<code>Proxy</code>å®ç°ä¸€ä¸ªç®€å•çš„å“åº”å¼ç³»ç»Ÿï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨å‰¯ä½œç”¨å‡½æ•°çš„æ•°æ®ç»“æ„ï¼Œç›®å‰ä½¿ç”¨çš„æ˜¯Set</span></span><br><span class="line"><span class="keyword">const</span> bucket = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨Proxyå¯¹dataè¿›è¡Œä»£ç†</span></span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(data, &#123;</span><br><span class="line">    <span class="comment">// æ‹¦æˆªè¯»çš„æ“ä½œ</span></span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">        <span class="comment">// å°†å‰¯ä½œç”¨å‡½æ•°æ·»åŠ åˆ°bucketä¸­</span></span><br><span class="line">        bucket.<span class="title function_">add</span>(effect)</span><br><span class="line">        <span class="keyword">return</span> target[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æ‹¦æˆªå†™çš„æ“ä½œ</span></span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, newVal</span>) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®å±æ€§</span></span><br><span class="line">        target[key] = newVal</span><br><span class="line">        <span class="comment">// ä»bucketä¸­å–å‡ºå‰¯ä½œç”¨å‡½æ•°å¹¶æ‰§è¡Œ</span></span><br><span class="line">        bucket.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">effect</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// è¯»å–äº†obj.text</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">text</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">effect</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;After 2s....&#x27;</span>)</span><br><span class="line">    obj.<span class="property">text</span> = <span class="string">&#x27;hello wk&#x27;</span></span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª<code>data</code>å¯¹è±¡ï¼Œéšåä½¿ç”¨äº†<code>Proxy</code>å¯¹å…¶è¿›è¡Œäº†ä»£ç†ã€‚åœ¨è¿™ä¸ªç®€å•çš„å“åº”å¼ç³»ç»Ÿä¸­ï¼Œ<code>Proxy</code>ä»£ç†åšäº†ä¸¤ä»¶äº‹ï¼š1ï¼‰æ‹¦æˆªè¯»å–æ“ä½œï¼Œå½“å‰¯ä½œç”¨å‡½æ•°<code>effect</code>è¯»å–<code>obj.text</code>å±æ€§æ—¶ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°<code>effect</code>æ·»åŠ åˆ°<code>bucket</code>ã€‚2ï¼‰æ‹¦æˆªå†™æ“ä½œï¼Œå½“é‡å†™<code>obj.text</code>å±æ€§æ—¶ï¼Œä»<code>bucket</code>ä¸­å–å‡º<code>effect</code>å¹¶æ‰§è¡Œã€‚</p>
<p>è¿è¡Œä¸Šè¿°ä»£ç ï¼š</p>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220716203916335.png" alt="image-20220716203916335"></p>
<p>äº†è§£äº†å®ç°å“åº”å¼ç³»ç»Ÿæœ€åŸºæœ¬çš„åŸç†åï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªåŸºç¡€ä¸Šä¸€æ­¥ä¸€æ­¥çš„å®Œå–„ï¼Œè®©è¯¥å“åº”å¼çœ‹èµ·æ¥â€œç‰›é€¼â€ä¸€äº›ã€‚</p>
<h2 id="1-å‘Šåˆ«ç¡¬ç¼–ç "><a href="#1-å‘Šåˆ«ç¡¬ç¼–ç " class="headerlink" title="1 å‘Šåˆ«ç¡¬ç¼–ç "></a>1 å‘Šåˆ«ç¡¬ç¼–ç </h2><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œç¡¬ç¼–ç äº†å‰¯ä½œç”¨å‡½æ•°<code>effect</code>ï¼Œè€Œåœ¨å®é™…çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œå‰¯ä½œç”¨å¯ä»¥æ˜¯å„ç§å„æ ·çš„åå­—ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå› æ­¤æœ¬èŠ‚å®ç°<strong>æ³¨å†Œå‰¯ä½œç”¨å‡½æ•°çš„æœºåˆ¶</strong>ã€‚</p>
<ul>
<li>æä¾›æ³¨å†Œå‰¯ä½œç”¨å‡½æ•°çš„å…¥å£</li>
<li>å»ºç«‹å‰¯ä½œç”¨å‡½æ•°ä¸è¢«æ“ä½œç›®æ ‡å­—æ®µä¹‹é—´çš„ä¾èµ–å…³ç³»</li>
</ul>
<p>æä¾›æ³¨å†Œå‰¯ä½œç”¨å‡½æ•°çš„å…¥å£ï¼šå…¶å®å°±æ˜¯æä¾›ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å°†å‰¯ä½œç”¨å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bucket = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line"><span class="comment">// å…¨å±€å˜é‡ï¼Œå­˜å‚¨è¢«æ³¨å†Œçš„å‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> activeEffect</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œå‰¯ä½œç”¨å‡½æ•°çš„å…¥å£</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">effect</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="comment">// å½“è°ƒç”¨effectæ³¨å†Œå‰¯ä½œç”¨å‡½æ•°æ—¶ï¼Œå°†å‰¯ä½œç”¨å‡½æ•°fnèµ‹å€¼ç»™activeEffect</span></span><br><span class="line">    activeEffect = fn</span><br><span class="line">    <span class="title function_">fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(data, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(activeEffect) &#123;</span><br><span class="line">            bucket.<span class="title function_">add</span>(activeEffect)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, newVal</span>) &#123;</span><br><span class="line">        target[key] = newVal</span><br><span class="line">        bucket.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä¸Šè¿°ä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="title function_">effect</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">text</span>)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;After 2s....&#x27;</span>)</span><br><span class="line">    obj.<span class="property">text</span> = <span class="string">&#x27;hello wk&#x27;</span></span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;After 3s....&#x27;</span>)</span><br><span class="line">    obj.<span class="property">noExit</span> = <span class="string">&#x27;hello wk&#x27;</span></span><br><span class="line">&#125;, <span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220716211208321.png" alt="image-20220716211208058"></p>
<p>ç¬¬ä¸€æ¬¡çš„è¾“å‡ºåœ¨é¢„æœŸä¹‹å†…ï¼Œå½“<code>obj.text</code>å±æ€§è¢«ä¿®æ”¹æ—¶ï¼Œèƒ½å¤Ÿæ‰§è¡Œåœ¨<code>effect</code>ä¸­æ³¨å†Œçš„åŒ¿åå‡½æ•°ã€‚ä½†ç¬¬äºŒæ¬¡çš„è¾“å‡ºä¸é¢„æœŸä¸ç¬¦åˆï¼Œå› ä¸ºåœ¨ç¬¬äºŒä¸ª<code>setTimeout</code>ä¸­æ²¡æœ‰ä¿®æ”¹<code>obj.text</code>å±æ€§ï¼Œè€Œæ˜¯ä¸º<code>obj</code>æä¾›ä¸€ä¸ªæ–°çš„å±æ€§<code>noExit</code>ã€‚æŒ‰ç…§æ­£å¸¸çš„é€»è¾‘æ€ç»´ï¼Œè¯¥<strong>åŒ¿åå‡½æ•°</strong>åœ¨æ³¨å†Œæ—¶<code>Proxy</code>æ‹¦æˆªçš„<code>key</code>å€¼ä¸º<code>text</code>ï¼Œä¹Ÿå°±æ˜¯è¯¥<strong>åŒ¿åå‡½æ•°</strong>æ˜¯ä½œä¸º<code>obj.text</code>å±æ€§çš„<strong>å‰¯ä½œç”¨å‡½æ•°</strong>ç»‘å®šåœ¨ä¸€èµ·ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¸Œæœ›åœ¨<code>Proxy</code>æ‹¦æˆª<strong>å…¶å®ƒå±æ€§çš„å†™æ“ä½œ</strong>ï¼ˆ<code>noExit</code>ï¼‰æ—¶ä¼šè§¦å‘è¯¥å‰¯ä½œç”¨å‡½æ•°ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œåœ¨æ³¨å†Œé˜¶æ®µå»ºç«‹èµ·<strong>å¯¹è±¡å±æ€§</strong>å’Œ<strong>å‰¯ä½œç”¨å‡½æ•°</strong>å¯¹åº”çš„å…³ç³»å³å¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ›¿æ¢setçš„æ•°æ®ç»“æ„ï¼Œä½¿ç”¨WeakMap</span></span><br><span class="line"><span class="keyword">const</span> bucket = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">let</span> activeEffect</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">effect</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    activeEffect = fn</span><br><span class="line">    <span class="title function_">fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(data, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">        <span class="title function_">track</span>(target, key)</span><br><span class="line">        <span class="keyword">return</span> target[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, newVal</span>) &#123;</span><br><span class="line">        target[key] = newVal</span><br><span class="line">        <span class="title function_">trigger</span>(target, key)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ‹¦æˆªè¯»å–çš„æ“ä½œæå–å‡ºæ¥</span></span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šå°†å‰¯ä½œç”¨å‡½æ•°activeEffectå‡½æ•°æ·»åŠ åˆ°bucketä¸­</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">track</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!activeEffect) <span class="keyword">return</span></span><br><span class="line">    <span class="comment">// å–å‡ºå¯¹è±¡ï¼ˆtargetï¼‰çš„Map</span></span><br><span class="line">    <span class="keyword">let</span> depsMap = bucket.<span class="title function_">get</span>(target)</span><br><span class="line">    <span class="comment">// å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ–°å»ºç«‹ä¸€ä¸ªMapï¼Œå¹¶å»ºç«‹ä¸targetçš„è”ç³»</span></span><br><span class="line">    <span class="keyword">if</span>(!depsMap) &#123;</span><br><span class="line">        bucket.<span class="title function_">set</span>(target, (depsMap = <span class="keyword">new</span> <span class="title class_">Map</span>()))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å–å‡ºå±æ€§ï¼ˆkeyï¼‰çš„set</span></span><br><span class="line">    <span class="keyword">let</span> deps = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line">    <span class="comment">// å¦‚æœä¸å­˜åœ¨ï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„setï¼Œå¹¶å»ºç«‹ä¸keyçš„å…³ç³»</span></span><br><span class="line">    <span class="keyword">if</span>(!deps) &#123;</span><br><span class="line">        depsMap.<span class="title function_">set</span>(key, (deps = <span class="keyword">new</span> <span class="title class_">Set</span>()))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†å½“å‰å…¨å±€å˜é‡ä¸­çš„å‰¯ä½œç”¨å‡½æ•°æ·»åŠ åˆ°â€œå¯¹è±¡-å±æ€§-setâ€å±‚é¢çš„ä¾èµ–ä¸­</span></span><br><span class="line">    deps.<span class="title function_">add</span>(activeEffect)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ‹¦æˆªå†™çš„æ“ä½œæå–å‡ºæ¥</span></span><br><span class="line"><span class="comment">// ä½œç”¨ï¼šä»bucketä¸­å–å‡ºå‰¯ä½œç”¨å‡½æ•°å¹¶æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="comment">// å–å‡ºå¯¹è±¡ï¼ˆtargetï¼‰å±‚çº§çš„ä¾èµ–å…³ç³»</span></span><br><span class="line">    <span class="keyword">const</span> depsMap = bucket.<span class="title function_">get</span>(target)</span><br><span class="line">    <span class="keyword">if</span>(!depsMap) <span class="keyword">return</span></span><br><span class="line">    <span class="comment">// å–å‡ºå±æ€§ï¼ˆkeyï¼‰å±‚çº§çš„ä¾èµ–å…³ç³»</span></span><br><span class="line">    <span class="keyword">const</span> effects = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line">    <span class="comment">// æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line">    effects &amp;&amp; effects.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">fn</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œåšäº†ä¸¤ç‚¹å˜åŠ¨ï¼š</p>
<p>1ï¼‰é€»è¾‘ä¸Šçš„å˜åŠ¨</p>
<p>é¦–å…ˆæ˜¯é€»è¾‘ä¸Šçš„å˜åŠ¨ï¼Œåœ¨<code>bucket</code>çš„æ•°æ®ç»“æ„ä¸Šï¼Œä½¿ç”¨äº†<code>WeakMap</code>ä»£æ›¿äº†<code>set</code>ç»“æ„ã€‚<code>Map</code>æ•°æ®ç»“æ„æ¯”<code>Set</code>æ•°æ®ç»“æ„èƒ½æ›´å¥½çš„å»ºç«‹èµ·ä¸€ä¸€å¯¹åº”çš„ä¾èµ–å…³ç³»ï¼Œè¿™é‡Œé€‰ç”¨äº†<code>WeakMap</code>è€Œæ²¡æœ‰<code>Map</code>ï¼Œæ˜¯å› ä¸º<code>WeakMap</code>å¯¹<code>key</code>æ˜¯å¼±å¼•ç”¨ï¼Œä¸ä¼šå½±å“åƒåœ¾å›æ”¶çš„å·¥ä½œã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“ä½œä¸º<code>WeakMap</code>çš„<code>key</code>é”®å­˜åœ¨çš„å¯¹è±¡ä¸€æ—¦æ²¡æœ‰ä»»ä½•å¼•ç”¨äº†ï¼Œå°±ä¼šè¢«jså¼•æ“è‡ªåŠ¨å›æ”¶ï¼Œåé¢ä¹Ÿæ— æ³•é€šè¿‡è¯¥<code>key</code>é”®å¯¹åº”çš„å€¼ã€‚</p>
<p>æ”¹å˜äº†å­˜å‚¨å‰¯ä½œç”¨å‡½æ•°çš„<code>bucket</code>çš„æ•°æ®ç»“æ„åï¼Œç›¸åº”çš„<strong>è¯»æ‹¦æˆªæ“ä½œ</strong>é€»è¾‘ä¹Ÿè¿›è¡Œæ”¹å˜ï¼Œè®©å…¶ä»çº§åˆ«1çš„æ•è·ï¼Œç»†åŒ–ä¸ºçº§åˆ«2çš„æ•è·ã€‚ç»†åŒ–åçš„<strong>è¯»æ‹¦æˆªæ“ä½œ</strong>èƒ½å¤Ÿç²¾å‡†çš„å»ºç«‹èµ·<strong>æŸä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§</strong>å’Œ<strong>å‰¯ä½œç”¨å‡½æ•°</strong>çš„ä¾èµ–å…³ç³»ã€‚åœ¨<strong>æ‹¦æˆªå†™æ“ä½œ</strong>æ—¶ï¼Œæ ¹æ®è¯»é˜¶æ®µæ‹¦æˆªçš„å±‚çº§å…³ç³»ï¼Œæ‰¾å‡ºå¯¹åº”å±æ€§çš„æ‰€ä»¥å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶ä¾æ¬¡æ‰§è¡Œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">çº§åˆ«1ï¼šbucketï¼ˆsetï¼‰- å¯¹è±¡ï¼ˆkeyï¼‰- å‰¯ä½œç”¨å‡½æ•°ï¼ˆvalueï¼‰</span><br><span class="line">çº§åˆ«2ï¼šbucketï¼ˆweakmapï¼‰-å¯¹è±¡ï¼ˆkeyï¼‰- å±æ€§Mapï¼ˆvalueï¼‰ =&gt;  å±æ€§Mapï¼ˆmapï¼‰- å±æ€§ï¼ˆkeyï¼‰- å‰¯ä½œç”¨å‡½æ•°é›†åˆsetï¼ˆvalueï¼‰</span><br></pre></td></tr></table></figure>

<p>2ï¼‰ä»£ç å±‚é¢çš„å°è£…</p>
<p>å°†<code>Proxy</code>ä¸­æ‹¦æˆªæ“ä½œçš„ç›¸å…³é€»è¾‘æç‚¼å‡ºæ¥ï¼Œå¾—åˆ°äº†<code>track</code>å‡½æ•°å’Œ<code>trigger</code>å‡½æ•°ï¼š<code>track</code>å‡½æ•°åæœ‰â€œè¿½è¸ªâ€çš„å«ä¹‰ï¼Œè´Ÿè´£å°†å‰¯ä½œç”¨å‡½æ•°<code>activeEffect</code>å‡½æ•°æ·»åŠ åˆ°<code>bucket</code>ä¸­ï¼›<code>trigger</code>æ„å‘³è§¦å‘æœºï¼Œåœ¨å¯¹è±¡å±æ€§è¿›è¡Œæ”¹åŠ¨æ—¶ï¼Œä»<code>bucket</code>ä¸­å–å‡ºç›¸åº”çš„å‰¯ä½œç”¨å‡½æ•°å¹¶æ‰§è¡Œã€‚</p>
<h2 id="2-å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”åˆ†æ”¯åˆ‡æ¢-amp-cleanup"><a href="#2-å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”åˆ†æ”¯åˆ‡æ¢-amp-cleanup" class="headerlink" title="2 å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”åˆ†æ”¯åˆ‡æ¢&amp;cleanup"></a>2 å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”åˆ†æ”¯åˆ‡æ¢&amp;cleanup</h2><p>åœ¨1ä¸­ï¼Œæˆ‘ä»¬å¯¹ä»£ç è¿›è¡Œäº†ä¸¤ä¸ªæ–¹é¢çš„æ”¹åŠ¨ï¼Œå…¶ä¸­èŠ±è´¹äº†å¾ˆå¤§çš„åŠ›æ°”é‡æ–°å»ºç«‹äº†å‰¯ä½œç”¨å‡½æ•°å’Œå¯¹åº”å±æ€§çš„ä¾èµ–å…³ç³»ï¼Œä½†è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚çœ‹ä¸‹è¿°æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">    <span class="attr">ok</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">effect</span>(</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">effectFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> out = obj.<span class="property">ok</span> ? obj.<span class="property">text</span> : <span class="string">&#x27;hello wk&#x27;</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(out)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">ok</span> = <span class="literal">false</span></span><br><span class="line">obj.<span class="property">text</span> = <span class="string">&#x27;hello my world&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœå¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220716224627370.png" alt="image-20220716224627370"></p>
<p><code>obj.ok</code>å€¼è®¾ç½®ä¸º<code>false</code>æ—¶ï¼Œå‰¯ä½œç”¨å‡½æ•°è§¦å‘äº†ä¸¤æ¬¡ï¼Œè¿™ä¸æ˜¯æœŸæœ›å¾—åˆ°çš„ç»“æœã€‚å› ä¸º<code>obj.ok</code>å€¼è®¾ç½®ä¸º<code>false</code>æ—¶ï¼Œå‰¯ä½œç”¨å‡½æ•°<code>effectFn</code>ä¸ä¼šè¯»å–<code>obj.text</code>ï¼Œæ‰€ä»¥åº”è¯¥åˆ é™¤<code>obj.text</code>å±æ€§ä¸å‰¯ä½œç”¨å‡½æ•°<code>effectFn</code>ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p>
<ul>
<li>ç»™å‰¯ä½œç”¨å‡½æ•°æ–°å¢<code>deps</code>æ•°ç»„ï¼Œå­˜å‚¨æ‰€æœ‰ä¸å‰¯ä½œç”¨å‡½æ•°å»ºç«‹ä¾èµ–å…³ç³»çš„å¯¹è±¡å±æ€§çš„<code>set</code></li>
<li><code>deps</code>çš„æ”¶é›†æ”¾åœ¨<code>track</code>ä¸­</li>
<li><code>trigger</code>å‡½æ•°éœ€è¦é‡æ–°å»ºç«‹<code>effectsToRun</code>ï¼Œé¿å…æ— çº¿å¾ªç¯æ‰§è¡Œã€‚<ul>
<li>å¦‚æœä¸ä¿®æ”¹ï¼Œå‰¯ä½œç”¨å‡½æ•°æ¯æ¬¡ä¼šè°ƒç”¨<code>cleanup</code>æ¸…é™¤<code>deps</code>ä¸­çš„ç›¸å…³ä¾èµ–</li>
<li>æ‰§è¡Œ<code>fn</code>æ—¶ï¼Œåˆä¼šå°†ä¾èµ–æ·»åŠ å…¥<code>deps</code>ä¸­</li>
<li>å¾ªç¯ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤ï¼Œå°±ä¼šæ— é™æ‰§è¡Œ</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">effect</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">effectFn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="title function_">cleanup</span>(effectFn)</span><br><span class="line">        activeEffect = effectFn</span><br><span class="line">        <span class="title function_">fn</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸ºå‰¯ä½œç”¨å‡½æ•°æ–°å¢ä¾èµ–æ”¶é›†çš„å…¥å£</span></span><br><span class="line">    effectFn.<span class="property">deps</span> = []</span><br><span class="line">    <span class="title function_">effectFn</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸…é™¤æ‰€æœ‰ä¸å‰¯ä½œç”¨å‡½æ•°å»ºç«‹ä¾èµ–å…³ç³»çš„å¯¹è±¡å±æ€§setä¸­çš„è¯¥å‰¯ä½œç”¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cleanup</span>(<span class="params">effectFn</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; effectFn.<span class="property">deps</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> deps = effectFn.<span class="property">deps</span>[i]</span><br><span class="line">        deps.<span class="title function_">delete</span>(effectFn)</span><br><span class="line">    &#125;</span><br><span class="line">    effectFn.<span class="property">deps</span>.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">track</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!activeEffect) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">let</span> depsMap = bucket.<span class="title function_">get</span>(target)</span><br><span class="line">    <span class="keyword">if</span>(!depsMap) &#123;</span><br><span class="line">        bucket.<span class="title function_">set</span>(target, (depsMap = <span class="keyword">new</span> <span class="title class_">Map</span>()))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> deps = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line">    <span class="keyword">if</span>(!deps) &#123;</span><br><span class="line">        depsMap.<span class="title function_">set</span>(key, (deps = <span class="keyword">new</span> <span class="title class_">Set</span>()))</span><br><span class="line">    &#125;</span><br><span class="line">    deps.<span class="title function_">add</span>(activeEffect)</span><br><span class="line">	<span class="comment">// å‰¯ä½œç”¨å‡½æ•°æ”¶é›†ä¾èµ–çš„è¿‡ç¨‹</span></span><br><span class="line">    activeEffect.<span class="property">deps</span>.<span class="title function_">push</span>(deps)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> depsMap = bucket.<span class="title function_">get</span>(target)</span><br><span class="line">    <span class="keyword">if</span>(!depsMap) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">const</span> effects = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line">	<span class="comment">// é¿å…æ— çº¿å¾ªç¯</span></span><br><span class="line">    <span class="keyword">const</span> effectsToRun = <span class="keyword">new</span> <span class="title class_">Set</span>(effects)</span><br><span class="line">    effectsToRun.<span class="title function_">forEach</span>(<span class="function"><span class="params">effectFn</span> =&gt;</span> <span class="title function_">effectFn</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”effectåµŒå¥—"><a href="#3-å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”effectåµŒå¥—" class="headerlink" title="3 å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”effectåµŒå¥—"></a>3 å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”effectåµŒå¥—</h2><p>å‰¯ä½œç”¨å‡½æ•°å¯ä»¥è¿›è¡ŒåµŒå¥—</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">bar</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">effect</span>(<span class="keyword">function</span> <span class="title function_">effectFn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;effectFn1æ‰§è¡Œ&#x27;</span>)</span><br><span class="line">    <span class="title function_">effect</span>(<span class="keyword">function</span> <span class="title function_">effectFn2</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;effectFn2æ‰§è¡Œ&#x27;</span>)</span><br><span class="line">        <span class="keyword">const</span> b = obj.<span class="property">bar</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> a = obj.<span class="property">foo</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">obj.<span class="property">foo</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>åœ¨åµŒå¥—å‘ç”Ÿçš„æƒ…å†µä¸‹ï¼ŒæœŸæœ›å»ºç«‹çš„ä¾èµ–å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>obj.foo</code>ä¿®æ”¹è§¦å‘<code>effectFn1</code>ï¼Œè€Œ<code>effectFn1</code>åˆé—´æ¥è§¦å‘<code>effectFn2</code></li>
<li><code>obj.bar</code>ä¿®æ”¹è§¦å‘<code>effectFn2</code></li>
</ul>
<p><img src="https://raw.githubusercontent.com/wk-Nemo/imgBed/main/imgimage-20220717132816916.png" alt="image-20220717132816916"></p>
<p>ä½†å®é™…ä»£ç çš„è¿è¡Œç»“æœå¦‚ä¸Šï¼Œå½“<code>obj.foo</code>ä¿®æ”¹æ—¶ï¼Œä¸ä½†æ²¡æœ‰è§¦å‘<code>effectFn1</code>åè€Œè§¦å‘äº†<code>effectFn2</code>ã€‚è¿™æ˜¯å› ä¸ºå½“<code>effectFn2</code>ç»“æŸè¿è¡Œåï¼Œ<code>obj.foo</code>çš„è¯»æ“ä½œæ‹¦æˆª<code>track</code>åœ¨æ”¶é›†ä¾èµ–çš„è¿‡ç¨‹ä¸­ï¼Œå°†å…¨å±€å˜é‡<code>activeEffect</code>ï¼ˆæ­¤æ—¶ä¸º<code>effectFn2</code>ï¼‰æ·»åŠ åˆ°äº†å¯¹åº”çš„å±æ€§çš„å‰¯ä½œç”¨å‡½æ•°ä¾èµ–ä¸­ã€‚å› æ­¤ï¼Œåœ¨å‰¯ä½œç”¨å‡½æ•°å‘ç”ŸåµŒå¥—æ—¶ï¼Œ<strong>éœ€è¦ä¸€ä¸ªå‡½æ•°æ ˆ<code>effectStack</code>ï¼Œåœ¨å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œæ—¶å°†å…¶å‹å…¥æ ˆåº•ï¼Œå¾…å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œç»“æŸæ—¶å†å°†å…¶ä»æ ˆä¸­å¼¹å‡ºï¼Œå¹¶å§‹ç»ˆè®©<code>activeEffect</code>æŒ‡å‘æ ˆé¡¶çš„å‰¯ä½œç”¨å‡½æ•°</strong>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeEffect</span><br><span class="line"><span class="comment">// effectæ ˆ é¢„é˜²å‰¯ä½œç”¨å‡½æ•°åµŒå¥—</span></span><br><span class="line"><span class="keyword">const</span> effectStack = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">effect</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">effectFn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="title function_">cleanup</span>(effectFn)</span><br><span class="line">        activeEffect = effectFn</span><br><span class="line">        <span class="comment">// å‰¯ä½œç”¨å‡½æ•°è°ƒç”¨ä¹‹å‰å…¥æ ˆ</span></span><br><span class="line">        effectStack.<span class="title function_">push</span>(effectFn)</span><br><span class="line">        <span class="title function_">fn</span>()</span><br><span class="line">        <span class="comment">// å‰¯ä½œç”¨å‡½æ•°è°ƒç”¨å®Œå‡ºæ ˆ</span></span><br><span class="line">        effectStack.<span class="title function_">pop</span>()</span><br><span class="line">        <span class="comment">// æ¿€æ´»çš„å‰¯ä½œç”¨å‡½æ•°å§‹ç»ˆæŒ‡å‘æ ˆé¡¶</span></span><br><span class="line">        activeEffect = effectStack[effectStack.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    effectFn.<span class="property">deps</span> = []</span><br><span class="line">    <span class="title function_">effectFn</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”é¿å…æ— é™é€’å½’å¾ªç¯"><a href="#4-å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”é¿å…æ— é™é€’å½’å¾ªç¯" class="headerlink" title="4 å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”é¿å…æ— é™é€’å½’å¾ªç¯"></a>4 å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹â€”â€”é¿å…æ— é™é€’å½’å¾ªç¯</h2><p>ç»§ç»­å®Œå–„ä¾èµ–å…³ç³»çš„å»ºç«‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(data, &#123;...&#125;)</span><br><span class="line">                       </span><br><span class="line"><span class="title function_">effect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">	obj.<span class="property">foo</span> = obj.<span class="property">foo</span> + <span class="number">1</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°çš„å‰¯ä½œç”¨å‡½æ•°ä¼šé€ æˆæ— é™å¾ªç¯ï¼š</p>
<ul>
<li>å‰¯ä½œç”¨å‡½æ•°è¯»å–<code>obj.foo</code>ï¼Œè§¦å‘<code>track</code>ï¼Œå»ºç«‹ä¸¤è€…çš„ä¾èµ–å…³ç³»</li>
<li>å‰¯ä½œç”¨å‡½æ•°ç»™<code>obj.foo</code>èµ‹å€¼+1åçš„æ•°å­—ï¼Œè§¦å‘<code>trigger</code>ï¼Œç»§ç»­æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°</li>
<li>ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤ä¸€ç›´å¾ªç¯ä¸‹å»ï¼Œä¼šé€ æˆæ ˆæº¢å‡º</li>
</ul>
<p>å¯ä»¥ç»™<code>trigger</code>å¢åŠ <strong>å®ˆå«æ¡ä»¶</strong>ï¼šå¦‚æœ<code>trigger</code>è§¦å‘çš„å‰¯ä½œç”¨å‡½æ•°ä¸å½“å‰æ¿€æ´»çš„å‰¯ä½œç”¨å‡½æ•°<code>activeEffect</code>ç›¸åŒï¼Œåˆ™ä¸è§¦å‘</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> depsMap = bucket.<span class="title function_">get</span>(target)</span><br><span class="line">    <span class="keyword">if</span>(!depsMap) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">const</span> effects = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> effectsToRun = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">    effects &amp;&amp; effects.<span class="title function_">forEach</span>(<span class="function"><span class="params">effectFn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// é¿å…æ— é™å¾ªç¯</span></span><br><span class="line">        <span class="keyword">if</span>(effectFn !== activeEffect) &#123;</span><br><span class="line">            effectsToRun.<span class="title function_">add</span>(effectFn)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    effectsToRun.<span class="title function_">forEach</span>(<span class="function"><span class="params">effectFn</span> =&gt;</span> <span class="title function_">effectFn</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/24/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E7%99%BD%E5%AB%96%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/24/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E7%99%BD%E5%AB%96%E7%AF%87/" class="post-title-link" itemprop="url">å‰ç«¯æ€§èƒ½ä¼˜åŒ–â€”â€”ç™½å«–ç¯‡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-24 21:53:09" itemprop="dateCreated datePublished" datetime="2022-03-24T21:53:09+08:00">2022-03-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-07 17:41:47" itemprop="dateModified" datetime="2023-05-07T17:41:47+08:00">2023-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">æ€§èƒ½ä¼˜åŒ–</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>æœ€è¿‘æ‰“ç®—äº†è§£æ€§èƒ½ä¼˜åŒ–ï¼Œçœ‹åˆ°ä¸€ç¯‡ä¸é”™çš„æ–‡ç« ï¼Œç™½å«–ä¸€ä¸‹ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/6974565176427151397">å‰ç«¯æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡ + æ£€æµ‹å·¥å…·</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/24/%E8%B7%9F%E7%9D%80%E3%80%8AVue.js%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E3%80%8B%E5%AD%A6%E4%B9%A0Vue3%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/24/%E8%B7%9F%E7%9D%80%E3%80%8AVue.js%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E3%80%8B%E5%AD%A6%E4%B9%A0Vue3%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91/" class="post-title-link" itemprop="url">è·Ÿç€ã€ŠVue.jsè®¾è®¡ä¸å®ç°ã€‹å­¦ä¹ Vue3æ¨¡æ¿ç¼–è¯‘</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-24 21:19:29" itemprop="dateCreated datePublished" datetime="2022-03-24T21:19:29+08:00">2022-03-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-07 17:40:28" itemprop="dateModified" datetime="2023-05-07T17:40:28+08:00">2023-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0-å†™åœ¨å‰é¢"><a href="#0-å†™åœ¨å‰é¢" class="headerlink" title="0 å†™åœ¨å‰é¢"></a>0 å†™åœ¨å‰é¢</h2><p>å‰æ®µæ—¶é—´åŠ å…¥çš„å‰ç«¯è®¨è®ºç¾¤å’Œå…³æ³¨çš„ä¸€äº›å…¬ä¼—å·è¢«ã€ŠVue.jsè®¾è®¡ä¸å®ç°ã€‹åˆ·å±ï¼ŒæŠ±ç€å¥½å¥‡çš„å¿ƒæ€ä¹°äº†ä¸€æœ¬å›æ¥å­¦ä¹ ã€‚ä¹‹å‰å­¦ä¹  Vue2 æ—¶å°±å¯¹æ¨¡æ¿ç¼–è¯‘è¿™ä¸€å—ä¸æ˜¯å¾ˆç†è§£ï¼Œäºæ˜¯ä¹ä¹¦åˆ°æ‰‹å°±å¼€å§‹è·Ÿç€ä¹¦å»å­¦è¿™ä¸€éƒ¨åˆ†ï¼Œå¹¶æ€»ç»“äº†è¿™ç¯‡åšå®¢ã€‚æœ‰å¾ˆå¤šåœ°æ–¹å†™çš„ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œåªæ˜¯æ–¹ä¾¿å¤§å®¶äº†è§£æ•´ä½“çš„æµç¨‹ï¼Œè¯¦ç»†å†…å®¹è¿˜æ˜¯å¼ºçƒˆæ¨èå¤§å®¶å»çœ‹åŸè‘—ã€‚</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a5b8f5465bb45fb86ebdbdaf2423e01~tplv-k3u1fbpfcp-watermark.image" alt="CD2FBF3CCBF00D968BB051266B38C06C.jpg"></p>
<h2 id="1-è™šæ‹ŸDOM"><a href="#1-è™šæ‹ŸDOM" class="headerlink" title="1 è™šæ‹ŸDOM"></a>1 è™šæ‹ŸDOM</h2><p>Vueä¸ºæˆ‘ä»¬æä¾›äº†<strong>æ¨¡ç‰ˆè¯­æ³•</strong>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™å¦‚ä¸‹çš„ä»£ç è·å–æˆ‘ä»¬æƒ³è¦çš„ dom ç»“æ„</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> @<span class="attr">click</span>=<span class="string">&quot;handler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™å¹¶ä¸æ˜¯çœŸå®çš„ HTML è¯­å¥ï¼Œå› ä¸ºæ¨¡æ¿è¯­æ³•é‡Œé¢æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>v-if</code>ã€<code>v-for</code>ã€<code>v-on</code>ç­‰æŒ‡ä»¤ï¼Œæ¨¡æ¿é‡Œçš„è¯­æ³•æœ€ç»ˆä¼šè¢«è½¬æ¢æˆè™šæ‹Ÿ DOM æè¿°çš„ UIã€‚å¦‚æœä½ æ¯”è¾ƒç†Ÿæ‚‰è™šæ‹Ÿ DOMï¼Œä½ å¯ä»¥ä¸ä½¿ç”¨æ¨¡æ¿ï¼Œç›´æ¥å†™<strong>æ¸²æŸ“ï¼ˆrenderï¼‰å‡½æ•°</strong>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;h&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;h1&#x27;</span>, &#123; <span class="attr">onClick</span>: handler &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <strong>h å‡½æ•°</strong>æ˜¯ä¸ºäº†å¸®åŠ©æˆ‘ä»¬ç¼–å†™è™šæ‹Ÿ DOM æ›´åŠ çš„è½»æ¾ï¼Œå…¶æœ€ç»ˆè¿”å›çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">tag</span>: <span class="string">&#x27;h1&#x27;</span>,</span><br><span class="line">      <span class="attr">props</span>: &#123; <span class="attr">onClick</span>: handler &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªç»„ä»¶è¦æ¸²æŸ“çš„å†…å®¹æ˜¯é€šè¿‡<strong>æ¸²æŸ“å‡½æ•°</strong>æ¥æè¿°çš„ï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°ä»£ç çš„ <strong>render å‡½æ•°</strong>ã€‚Vue ä¼šæ ¹æ®ç»„ä»¶çš„ render å‡½æ•°è¿”å›å€¼æ‹¿åˆ°è™šæ‹Ÿ DOM ï¼Œç„¶åå†ç»è¿‡<strong>æ¸²æŸ“å™¨</strong>çš„æ¸²æŸ“ï¼Œå°±å¯ä»¥æŠŠ<strong>è™šæ‹Ÿ DOM</strong> æ¸²æŸ“æˆ<strong>çœŸå®çš„ DOM</strong>ã€‚</p>
<h2 id="2-æ¨¡æ¿ç¼–è¯‘"><a href="#2-æ¨¡æ¿ç¼–è¯‘" class="headerlink" title="2 æ¨¡æ¿ç¼–è¯‘"></a>2 æ¨¡æ¿ç¼–è¯‘</h2><p>ä¸Šé¢æˆ‘ä»¬è®²äº†æ¨¡æ¿è¯­æ³•æœ€ç»ˆä¼šè¢«è½¬æ¢æˆæ¸²æŸ“å‡½æ•°ï¼Œæ¸²æŸ“å‡½æ•°æœ€ç»ˆä¼šè¿”å›æˆè™šæ‹Ÿ DOMï¼Œä»¥ä¾¿åé¢çš„æµç¨‹æ­£å¸¸çš„è¿›è¡Œã€‚è€Œæ¨¡æ¿è¯­æ³•è½¬æ¢æˆæ¸²æŸ“å‡½æ•°ä¾¿æ˜¯<strong>ç¼–è¯‘å™¨</strong>åšçš„å·¥ä½œï¼Œå¯¹äºå¦‚ä¸‹çš„æ¨¡æ¿ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">&quot;handler&quot;</span>&gt;</span></span><br><span class="line">  click me</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»è¿‡ç¼–è¯‘å™¨çš„å·¥ä½œæœ€ç»ˆä¼šè½¬æ¢æˆå¦‚ä¸‹çš„æ¸²æŸ“å‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">onClick</span>: handler &#125;, <span class="string">&#x27;click me&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥æˆ‘ä»¬ç†Ÿæ‚‰çš„ .vue æ–‡ä»¶ä¸ºä¾‹ï¼Œä¸€ä¸ª .vue æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªç»„ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div @click=&quot;handler&quot;&gt;</span><br><span class="line">    click me</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // æ•°æ®...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;ï¼Œ</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handler: function() &#123;</span><br><span class="line">      // å‡½æ•°ä½“...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;template&gt;</code> æ ‡ç­¾é‡Œçš„å†…å®¹å°±æ˜¯æ¨¡æ¿å†…å®¹ï¼Œç¼–è¯‘å™¨ä¼šæŠŠæ¨¡æ¿å†…å®¹ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°å¹¶æ·»åŠ åˆ° <code>&lt;script&gt;</code> æ ‡ç­¾å—çš„ç»„ä»¶å¯¹è±¡ä¸Šï¼Œæœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// æ•°æ®...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;ï¼Œ</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">handler</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// å‡½æ•°ä½“...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">onClick</span>: handler &#125;, <span class="string">&#x27;click me&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-ä¼ ç»Ÿç¼–è¯‘å™¨"><a href="#3-ä¼ ç»Ÿç¼–è¯‘å™¨" class="headerlink" title="3  ä¼ ç»Ÿç¼–è¯‘å™¨"></a>3  ä¼ ç»Ÿç¼–è¯‘å™¨</h2><p>ç¼–è¯‘å™¨å…¶å®åªæ˜¯ä¸€æ®µç¨‹åºï¼Œå®ƒç”¨äºå°† A è¯­è¨€ç¿»è¯‘æˆ B è¯­è¨€ã€‚</p>
<ul>
<li>A è¯­è¨€ï¼šæºä»£ç </li>
<li>B è¯­è¨€ï¼š ç›®æ ‡ä»£ç </li>
<li>æºä»£ç  -&gt; ç›®æ ‡ä»£ç ï¼šç¼–è¯‘</li>
</ul>
<p>å®Œæ•´çš„ç¼–è¯‘ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p>
<ul>
<li>è¯æ³•åˆ†æ</li>
<li>è¯­æ³•åˆ†æ</li>
<li>è¯­ä¹‰åˆ†æ</li>
<li>ä¸­é—´ä»£ç ç”Ÿæˆ</li>
<li>ä¼˜åŒ–</li>
<li>ç›®æ ‡ä»£ç ç”Ÿæˆ</li>
</ul>
<h2 id="4-Vueç¼–è¯‘å™¨æ¦‚è§ˆ"><a href="#4-Vueç¼–è¯‘å™¨æ¦‚è§ˆ" class="headerlink" title="4 Vueç¼–è¯‘å™¨æ¦‚è§ˆ"></a>4 Vueç¼–è¯‘å™¨æ¦‚è§ˆ</h2><p>Vue çš„æ¨¡æ¿ä½œä¸º DSLï¼ˆæ¶‰åŠä¸€ç§é¢†åŸŸç‰¹å®šçš„è¯­è¨€ï¼‰ï¼Œå…¶ç¼–è¯‘æµç¨‹ä¼šæœ‰æ‰€ä¸åŒã€‚å¯¹ Vue æ¥è¯´ï¼Œæºä»£ç å°±æ˜¯ç»„ä»¶æ¨¡æ¿ï¼Œç›®æ ‡ä»£ç å°±æ˜¯èƒ½åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ js ä»£ç ï¼Œæˆ–è€…å…¶ä»–æ‹¥æœ‰ js è¿è¡Œæ—¶çš„å¹³å°ä»£ç </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æºä»£ç  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">:id</span>=<span class="string">&quot;dynamicId&quot;</span>&gt;</span></span><br><span class="line">    Vue Template</span><br><span class="line">  <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›®æ ‡ä»£ç </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;h1&#x27;</span>, &#123;<span class="attr">id</span>: dynamic&#125;, <span class="string">&#x27;Vue Template&#x27;</span>)</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Vue çš„æ¨¡æ¿ç¼–è¯‘å™¨é¦–å…ˆå¯¹æ¨¡æ¿è¿›è¡Œ<strong>è¯æ³•åˆ†æ</strong>å’Œ<strong>è¯­æ³•åˆ†æ</strong>ï¼Œå¾—åˆ°<strong>æ¨¡æ¿ AST</strong>ã€‚æ¥ç€ï¼Œå°†<strong>æ¨¡æ¿ AST</strong> è½¬æ¢æˆ <strong>JavaScriptAST</strong>ã€‚æœ€åï¼Œæ ¹æ® <strong>JavaScriptAST</strong> ç”Ÿæˆ <strong>JavaScript ä»£ç </strong>ï¼ˆå³æ¸²æŸ“å‡½æ•°ä»£ç ï¼‰ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/44e9c0f5e84244ed848ba1a79fea17ae~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>æ€»çš„æ¥è¯´Vueç¼–è¯‘çš„æ ¸å¿ƒ<strong>ä¸»è¦æ˜¯ä¸‰ä¸ªé˜¶æ®µ</strong>ï¼šparseã€transformã€generateã€‚Vue æ ¸å¿ƒ compiler çš„ä»£ç åªæ˜¯ç®€å•çš„è°ƒç”¨äº†è¿™ä¸‰ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compiler</span>(<span class="params">template</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ast = <span class="title function_">parse</span>(template)</span><br><span class="line">  <span class="title function_">transform</span>(ast)</span><br><span class="line">  <span class="keyword">const</span> code = <span class="title function_">generate</span>(ast.<span class="property">jsNode</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> code</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬ä¸€æ­¥ parseï¼š</strong> è¿™é‡Œå°†<strong>æ¨¡æ¿</strong>è½¬æ¢æˆ<strong>æ¨¡æ¿AST</strong></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0415701b0ea848318924490a81dce9cc~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tokens</span></span><br><span class="line">[</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;tag&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;div&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;tag&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;p&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>, <span class="attr">context</span>: <span class="string">&#x27;Vue&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;tagEnd&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;p&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;tag&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;p&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>, <span class="attr">context</span>: <span class="string">&#x27;Template&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;tagEnd&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;p&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;tagEnd&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;div&#x27;</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡ç‰ˆAST</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;Root&#x27;</span>,</span><br><span class="line">  <span class="attr">childrent</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;Element&#x27;</span>,</span><br><span class="line">      <span class="attr">tag</span>: <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;Element&#x27;</span>,</span><br><span class="line">          <span class="attr">tag</span>: <span class="string">&#x27;p&#x27;</span></span><br><span class="line">          <span class="attr">children</span>: [&#123; <span class="attr">type</span>: <span class="string">&#x27;Text&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;Vue&#x27;</span> &#125;]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;Element&#x27;</span>,</span><br><span class="line">          <span class="attr">tag</span>: <span class="string">&#x27;p&#x27;</span></span><br><span class="line">          <span class="attr">children</span>: [&#123; <span class="attr">type</span>: <span class="string">&#x27;Text&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;Template&#x27;</span> &#125;]</span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬äºŒæ­¥ transformï¼š</strong> è¿™é‡Œä¸ºç¬¬ä¸€æ­¥ç”Ÿæˆçš„<strong>æ¨¡æ¿AST</strong>ä¸­æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ª <strong>jsNode</strong>ï¼Œä¹Ÿå°±æ˜¯ <strong>JavaScriptAST</strong></p>
<p>è¿™é‡Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ç›´æ¥å°†æ¨¡æ¿ASTè½¬æ¢æˆç›®æ ‡ä»£ç å‘¢ï¼Ÿ</p>
<p>å› ä¸ºæˆ‘ä»¬éœ€è¦å°†æ¨¡æ¿ASTç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°ï¼Œè€Œæ¸²æŸ“å‡½æ•°æ˜¯ç”± JavaScript ä»£ç æ¥æè¿°çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†<strong>æ¨¡æ¿AST</strong>è½¬æ¢æˆç”¨äº<strong>æè¿°æ¸²æŸ“å‡½æ•°çš„AST</strong>ï¼Œå³ <strong>JavaScriptAST</strong>ã€‚ä¸‹é¢ä¸¾ä¸ªä¾‹å­æ›´æ¸…æ¥šçš„å»äº†è§£è¿™å¥è¯çš„æ„æ€ï¼š</p>
<p><code>&lt;div&gt;&lt;p&gt;Vue&lt;/p&gt;&lt;p&gt;Template&lt;/p&gt;&lt;/div&gt;</code>æ¨¡æ¿æœ€ç»ˆè¿”å›çš„æ¸²æŸ“å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;Vue&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;Template&#x27;</span>)</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œ transform è¦åšçš„å·¥ä½œå°±æ˜¯å°†ç¬¬ä¸€æ­¥ä¸­çš„æ¨¡æ¿ASTè½¬æ¢æˆå¦‚ä¸‹ç”¨äºæè¿°æ¸²æŸ“å‡½æ•°çš„æ•°æ®ç»“æ„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">FunctionDeclNode</span> = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;FunctionDecl&#x27;</span>, <span class="comment">// èŠ‚ç‚¹ç±»å‹</span></span><br><span class="line">    <span class="comment">// å‡½æ•°åç§°</span></span><br><span class="line">    <span class="attr">id</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Identifier&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;render&#x27;</span>&#125;,</span><br><span class="line">    <span class="comment">// å‡½æ•°å‚æ•°</span></span><br><span class="line">    <span class="attr">params</span>: [],</span><br><span class="line">    <span class="comment">// å‡½æ•°ä½“</span></span><br><span class="line">    <span class="attr">body</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;ReturnStatement&#x27;</span>,</span><br><span class="line">            <span class="attr">return</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;CallExpression&#x27;</span>,</span><br><span class="line">                <span class="attr">callee</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Indentifier&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;h&#x27;</span> &#125;,</span><br><span class="line">                <span class="attr">arguments</span>: [</span><br><span class="line">                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;div&#x27;</span> &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;ArrayExpression&#x27;</span>,</span><br><span class="line">                        <span class="attr">elements</span>: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;CallExpression&#x27;</span>,</span><br><span class="line">                                <span class="attr">callee</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Indentifier&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;h&#x27;</span> &#125;,</span><br><span class="line">                                <span class="attr">arguments</span>: [</span><br><span class="line">                                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;p&#x27;</span> &#125;,</span><br><span class="line">                                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;Vue&#x27;</span>&#125;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;,</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;CallExpression&#x27;</span>,</span><br><span class="line">                                <span class="attr">callee</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Indentifier&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;h&#x27;</span> &#125;,</span><br><span class="line">                                <span class="attr">arguments</span>: [</span><br><span class="line">                                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;p&#x27;</span> &#125;,</span><br><span class="line">                                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;Template&#x27;</span> &#125;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬ä¸‰æ­¥ generateï¼š</strong> åœ¨ç¬¬äºŒæ­¥ä¸­æˆ‘ä»¬è·å–äº†æè¿°æ¸²æŸ“å‡½æ•°çš„ astï¼Œè¿™ä¸€æ­¥ä¸­æˆ‘ä»¬æ ¹æ®è¯¥ ast è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥å¾—å€’æ¸²æŸ“å‡½æ•°æ®å³å¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;Vue&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;Template&#x27;</span>)</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-parseè¯¦è§£"><a href="#5-parseè¯¦è§£" class="headerlink" title="5 parseè¯¦è§£"></a>5 parseè¯¦è§£</h2><p>ä¸Šé¢æˆ‘ä»¬äº†è§£äº† parse çš„ä¸»è¦çš„å·¥ä½œæ˜¯è¯»å– Vue çš„æ¨¡æ¿ä»£ç ï¼Œç„¶åå°†ä»–ä»¬è§£ææˆä¸€ä¸ªä¸€ä¸ª Tokenï¼Œæœ€åå†æ ¹æ®è¿™äº› Token ç”Ÿæˆæ¨¡æ¿ASTã€‚</p>
<p>é¦–å…ˆäº†è§£è§£ææˆ Token çš„è§„åˆ™ï¼Œè¿™é‡Œç”¨åˆ°äº†<strong>æœ‰é™çŠ¶æ€æœº</strong>ã€‚å­¦è¿‡ç¼–è¯‘çš„åŒå­¦è‚¯å®šå¯¹è¿™ä¸ªè¯ä¸é™Œç”Ÿï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œè§£æå™¨åœ¨è§£ææ¨¡æ¿æ—¶ä¼šé‡åˆ° n ç§çš„çŠ¶æ€ï¼Œæ¯ä¸ªçŠ¶æ€ä¸‹é‡åˆ°ä¸åŒæƒ…å†µè¦è·³è½¬åˆ°å“ªä¸€ç§æƒ…å†µã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çŠ¶æ€æœºçŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">State</span> = &#123;</span><br><span class="line">    <span class="attr">initial</span>: <span class="number">1</span>,      <span class="comment">// åˆå§‹çŠ¶æ€</span></span><br><span class="line">    <span class="attr">tagOpen</span>: <span class="number">2</span>,      <span class="comment">// æ ‡ç­¾å¼€å§‹çŠ¶æ€</span></span><br><span class="line">    <span class="attr">tagName</span>: <span class="number">3</span>,      <span class="comment">// æ ‡ç­¾åç§°çŠ¶æ€</span></span><br><span class="line">    <span class="attr">text</span>: <span class="number">4</span>,         <span class="comment">// æ–‡æœ¬çŠ¶æ€</span></span><br><span class="line">    <span class="attr">tagEnd</span>: <span class="number">5</span>,       <span class="comment">// ç»“æŸæ ‡ç­¾çŠ¶æ€</span></span><br><span class="line">    <span class="attr">tagEndName</span>: <span class="number">6</span>    <span class="comment">// ç»“æŸæ ‡ç­¾åç§°çŠ¶æ€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯å­—æ¯</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isAlpha</span>(<span class="params">char</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> char &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; char &lt;= <span class="string">&#x27;z&#x27;</span> || char &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; char&lt;= <span class="string">&#x27;Z&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tokenSize</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="comment">//ä¸€å¼€å§‹æ˜¯åˆå§‹çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">let</span> currentState = <span class="title class_">State</span>.<span class="property">initial</span></span><br><span class="line">    <span class="keyword">const</span> chars = []</span><br><span class="line">    <span class="keyword">const</span> tokens = []</span><br><span class="line">    <span class="comment">// çŠ¶æ€æœºä¸æ–­å¾ªç¯ï¼Œå½“å…¨éƒ¨è§£æå®Œæ¯•åå¾ªç¯åœæ­¢</span></span><br><span class="line">    <span class="keyword">while</span>(str) &#123;</span><br><span class="line">        <span class="keyword">const</span> char = str[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">switch</span>(currentState) &#123;</span><br><span class="line">            <span class="comment">// åˆå§‹çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">State</span>.<span class="property">initial</span>:</span><br><span class="line">                <span class="keyword">if</span>(char === <span class="string">&#x27;&lt;&#x27;</span>) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ° &lt; è¿›å…¥æ ‡ç­¾å¼€å§‹çŠ¶æ€</span></span><br><span class="line">                    currentState = <span class="title class_">State</span>.<span class="property">tagOpen</span></span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_">isAlpha</span>(char)) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ°å­—æ¯è¿›å…¥æ–‡æœ¬çŠ¶æ€</span></span><br><span class="line">                    currentState = <span class="title class_">State</span>.<span class="property">text</span></span><br><span class="line">                    chars.<span class="title function_">push</span>(char)</span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment">// æ ‡ç­¾å¼€å§‹çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">State</span>.<span class="property">tagOpen</span>:</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_">isAlpha</span>(char)) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ°å­—æ¯è¿›å…¥æ ‡ç­¾åç§°çŠ¶æ€</span></span><br><span class="line">                    currentState = <span class="title class_">State</span>.<span class="property">tagName</span></span><br><span class="line">                    chars.<span class="title function_">push</span>(char)</span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (char === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ° / è¿›å…¥ç»“æŸæ ‡ç­¾çŠ¶æ€</span></span><br><span class="line">                    currentState = <span class="title class_">State</span>.<span class="property">tagEnd</span></span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment">// æ ‡ç­¾åç§°çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">State</span>.<span class="property">tagName</span>:</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_">isAlpha</span>(char)) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ°å­—æ¯ï¼Œä»»ç„¶å¤„äºæ ‡ç­¾åç§°çŠ¶æ€</span></span><br><span class="line">                    chars.<span class="title function_">push</span>(char)</span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (char === <span class="string">&#x27;&gt;&#x27;</span>) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ° &gt; è¿›å…¥åˆå§‹çŠ¶æ€</span></span><br><span class="line">                    currentState = <span class="title class_">State</span>.<span class="property">initial</span></span><br><span class="line">                    <span class="comment">// è§£ææˆåŠŸä¸€ä¸ª tag</span></span><br><span class="line">                    tokens.<span class="title function_">push</span>(&#123;</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;tag&#x27;</span>,</span><br><span class="line">                        <span class="attr">name</span>: chars.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                    &#125;)</span><br><span class="line">                    chars.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment">// æ–‡æœ¬çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">State</span>.<span class="property">text</span>:</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_">isAlpha</span>(char)) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ°å­—æ¯ä»»ç„¶ä¿æŒæ–‡æœ¬çŠ¶æ€</span></span><br><span class="line">                    chars.<span class="title function_">push</span>(char)</span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (char === <span class="string">&#x27;&lt;&#x27;</span>) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ° &lt; è¿›å…¥æ ‡ç­¾å¼€å§‹çŠ¶æ€</span></span><br><span class="line">                    currentState = <span class="title class_">State</span>.<span class="property">tagOpen</span></span><br><span class="line">                    <span class="comment">// è§£ææˆåŠŸä¸€ä¸ª text</span></span><br><span class="line">                    tokens.<span class="title function_">push</span>(&#123;</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">                        <span class="attr">content</span>: chars.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                    &#125;)</span><br><span class="line">                    chars.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment">// ç»“æŸæ ‡ç­¾çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">State</span>.<span class="property">tagEnd</span>:</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_">isAlpha</span>(char)) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ°å­—æ¯è¿›å…¥ç»“æŸæ ‡ç­¾åç§°çŠ¶æ€</span></span><br><span class="line">                    currentState = <span class="title class_">State</span>.<span class="property">tagEndName</span></span><br><span class="line">                    chars.<span class="title function_">push</span>(char)</span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment">// ç»“æŸæ ‡ç­¾åç§°çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">case</span> <span class="title class_">State</span>.<span class="property">tagEndName</span>:</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_">isAlpha</span>(char)) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ°å­—æ¯ä¿æŒç»“æŸæ ‡ç­¾åç§°çŠ¶æ€</span></span><br><span class="line">                    chars.<span class="title function_">push</span>(char)</span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(char === <span class="string">&#x27;&gt;&#x27;</span>) &#123;</span><br><span class="line">                    <span class="comment">// é‡åˆ° &gt; è¿›å…¥åˆå§‹çŠ¶æ€</span></span><br><span class="line">                    currentState = <span class="title class_">State</span>.<span class="property">initial</span></span><br><span class="line">                    <span class="comment">// æˆåŠŸè§£æ tagEnd</span></span><br><span class="line">                    tokens.<span class="title function_">push</span>(&#123;</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;tagEnd&#x27;</span>,</span><br><span class="line">                        <span class="attr">name</span>: chars.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                    &#125;)</span><br><span class="line">                    chars.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">                    str = str.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tokens</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = <span class="string">&#x27;&lt;div&gt;&lt;p&gt;Vue&lt;/p&gt;&lt;p&gt;Template&lt;/p&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line"><span class="keyword">const</span> tokens = <span class="title function_">tokenSize</span>(template)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(tokens)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œæœ€å <code>&lt;div&gt;&lt;p&gt;Vue&lt;/p&gt;&lt;p&gt;Template&lt;/p&gt;&lt;/div&gt;</code> è¢«è§£ææˆ tokensï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3bc2521530e3439c9f535656b99efc2d~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p>
<p>æ‹¿åˆ°ä¸Šé¢çš„ tokens åï¼Œæˆ‘ä»¬è¦å°†å…¶è½¬æ¢æˆæ¨¡æ¿ASTã€‚æ€è·¯æ¯”è¾ƒç®€å•ï¼Œç”¨ä¸€ä¸ªæ ˆè¿›è¡Œå­˜å‚¨ï¼Œé¦–å…ˆæ¨å…¥æ ¹ç»“ç‚¹ rootï¼Œæ¥ç€éå†ä¸€é tokensï¼Œæ ¹æ®ä¸åŒçš„æƒ…å†µè¿›è¡Œè¿›æ ˆå’Œå‡ºæ ˆçš„æ“ä½œå³å¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; tokenSize &#125; = <span class="built_in">require</span>(<span class="string">&#x27;./token&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parse</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="comment">// è·å– tokens</span></span><br><span class="line">    <span class="keyword">const</span> tokens = <span class="title function_">tokenSize</span>(str)</span><br><span class="line">    <span class="comment">// æ ¹ç»“ç‚¹</span></span><br><span class="line">    <span class="keyword">const</span> root = &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;Root&#x27;</span>,</span><br><span class="line">        <span class="attr">children</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ˆ</span></span><br><span class="line">    <span class="keyword">const</span> elementStack = [root]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(tokens.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> parent = elementStack[elementStack.<span class="property">length</span> - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">const</span> t = tokens[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">switch</span>(t.<span class="property">type</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;tag&#x27;</span>:</span><br><span class="line">                <span class="keyword">const</span> elementNode = &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;Element&#x27;</span>,</span><br><span class="line">                    <span class="attr">tag</span>: t.<span class="property">name</span>,</span><br><span class="line">                    <span class="attr">children</span>: []</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹çš„childrenå±æ€§ä¸­</span></span><br><span class="line">                parent.<span class="property">children</span>.<span class="title function_">push</span>(elementNode)</span><br><span class="line">                <span class="comment">// åŠ å…¥æ ˆé¡¶</span></span><br><span class="line">                elementStack.<span class="title function_">push</span>(elementNode)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;text&#x27;</span>:</span><br><span class="line">                <span class="keyword">const</span> textNode = &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;Text&#x27;</span>,</span><br><span class="line">                    <span class="attr">content</span>: t.<span class="property">content</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹çš„childrenå±æ€§ä¸­</span></span><br><span class="line">                parent.<span class="property">children</span>.<span class="title function_">push</span>(textNode)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;tagEnd&#x27;</span>:</span><br><span class="line">                <span class="comment">// å¼¹å‡ºæ ˆé¡¶</span></span><br><span class="line">                elementStack.<span class="title function_">pop</span>()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tokens.<span class="title function_">shift</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œæœ€å <code>&lt;div&gt;&lt;p&gt;Vue&lt;/p&gt;&lt;p&gt;Template&lt;/p&gt;&lt;/div&gt;</code> è¢«è§£ææˆæ¨¡æ¿ASTå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;Root&#x27;</span>,</span><br><span class="line">  <span class="attr">childrent</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;Element&#x27;</span>,</span><br><span class="line">      <span class="attr">tag</span>: <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;Element&#x27;</span>,</span><br><span class="line">          <span class="attr">tag</span>: <span class="string">&#x27;p&#x27;</span></span><br><span class="line">          <span class="attr">children</span>: [&#123; <span class="attr">type</span>: <span class="string">&#x27;Text&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;Vue&#x27;</span> &#125;]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;Element&#x27;</span>,</span><br><span class="line">          <span class="attr">tag</span>: <span class="string">&#x27;p&#x27;</span></span><br><span class="line">          <span class="attr">children</span>: [&#123; <span class="attr">type</span>: <span class="string">&#x27;Text&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;Template&#x27;</span> &#125;]</span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-transform-è¯¦è§£"><a href="#6-transform-è¯¦è§£" class="headerlink" title="6 transform è¯¦è§£"></a>6 transform è¯¦è§£</h2><p>ä¸Šé¢æˆ‘ä»¬æåˆ°äº†ï¼Œä¸ºäº†ç”Ÿæˆæœ€ç»ˆçš„ render å‡½æ•°ï¼Œæˆ‘ä»¬åªæ‹¿åˆ°<strong>æ¨¡æ¿AST</strong>è¿˜ä¸å¤Ÿï¼Œéœ€è¦å°†ç”¨äº<strong>æè¿°æ¨¡æ¿çš„ASTè½¬æ¢æˆç”¨äºæè¿°JavaScriptçš„AST</strong>ã€‚</p>
<p>æˆ‘ä»¬æœ€ç»ˆè¦è½¬æ¢çš„ç›®æ ‡å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;Vue&#x27;</span>),</span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;Template&#x27;</span>)</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ç”¨å¦‚ä¸‹ AST æ¥æè¿°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">FunctionDeclNode</span> = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;FunctionDecl&#x27;</span>, <span class="comment">// èŠ‚ç‚¹ç±»å‹</span></span><br><span class="line">    <span class="comment">// å‡½æ•°åç§°</span></span><br><span class="line">    <span class="attr">id</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Identifier&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;render&#x27;</span>&#125;,</span><br><span class="line">    <span class="comment">// å‡½æ•°å‚æ•°</span></span><br><span class="line">    <span class="attr">params</span>: [],</span><br><span class="line">    <span class="comment">// å‡½æ•°ä½“</span></span><br><span class="line">    <span class="attr">body</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;ReturnStatement&#x27;</span>,</span><br><span class="line">            <span class="attr">return</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;CallExpression&#x27;</span>,</span><br><span class="line">                <span class="attr">callee</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Indentifier&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;h&#x27;</span> &#125;,</span><br><span class="line">                <span class="attr">arguments</span>: [</span><br><span class="line">                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;div&#x27;</span> &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">type</span>: <span class="string">&#x27;ArrayExpression&#x27;</span>,</span><br><span class="line">                        <span class="attr">elements</span>: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;CallExpression&#x27;</span>,</span><br><span class="line">                                <span class="attr">callee</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Indentifier&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;h&#x27;</span> &#125;,</span><br><span class="line">                                <span class="attr">arguments</span>: [</span><br><span class="line">                                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;p&#x27;</span> &#125;,</span><br><span class="line">                                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;Vue&#x27;</span>&#125;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;,</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;CallExpression&#x27;</span>,</span><br><span class="line">                                <span class="attr">callee</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Indentifier&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;h&#x27;</span> &#125;,</span><br><span class="line">                                <span class="attr">arguments</span>: [</span><br><span class="line">                                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;p&#x27;</span> &#125;,</span><br><span class="line">                                    &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;Template&#x27;</span> &#125;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ç°åœ¨çš„æ€è·¯å°±æ˜¯å°†ç¬¬äº”æ­¥ä¸­æ‹¿åˆ°çš„ASTè½¬æ¢æˆä¸Šè¿°çš„ASTã€‚å…ˆå®šä¹‰ä¸€äº›è¾…åŠ©å‡½æ•°ä¸ºå®ç°è¿™ä¸€æ­¥éª¤åšä¸€äº›é“ºå«ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º StringLiteral ç±»å‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createStringLiteral</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>,</span><br><span class="line">        value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º Identifier ç±»å‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createIdentifier</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;Identifier&#x27;</span>,</span><br><span class="line">        name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º ArrayExpression ç±»å‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createArrayExpression</span>(<span class="params">elements</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;ArrayExpression&#x27;</span>,</span><br><span class="line">        elements</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»º CallExpression ç±»å‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createCallExpression</span>(<span class="params">callee, <span class="variable language_">arguments</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;CallExpression&#x27;</span>,</span><br><span class="line">        <span class="attr">callee</span>: <span class="title function_">createIdentifier</span>(callee),</span><br><span class="line">        <span class="variable language_">arguments</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ¨¡æ¿ASTä¸­Textç±»å‹èŠ‚ç‚¹è½¬æ¢æˆJSASTä¸­StringLiteralç±»å‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformText</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(node.<span class="property">type</span> !== <span class="string">&#x27;Text&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    node.<span class="property">jsNode</span> = <span class="title function_">createStringLiteral</span>(node.<span class="property">content</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ¨¡æ¿ASTä¸­Elementç±»å‹èŠ‚ç‚¹è½¬æ¢æˆJSASTä¸­ç±»å‹èŠ‚ç‚¹CallExpressionç±»å‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformElement</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(node.<span class="property">type</span> !== <span class="string">&#x27;Element&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> callExp = <span class="title function_">createCallExpression</span>(<span class="string">&#x27;h&#x27;</span>, [</span><br><span class="line">            <span class="title function_">createStringLiteral</span>(node.<span class="property">tag</span>)</span><br><span class="line">        ])</span><br><span class="line">        node.<span class="property">children</span>.<span class="property">length</span> === <span class="number">1</span></span><br><span class="line">            ? callExp.<span class="property">arguments</span>.<span class="title function_">push</span>(node.<span class="property">children</span>[<span class="number">0</span>].<span class="property">jsNode</span>)</span><br><span class="line">            : callExp.<span class="property">arguments</span>.<span class="title function_">push</span>(</span><br><span class="line">                <span class="title function_">createArrayExpression</span>(node.<span class="property">children</span>.<span class="title function_">map</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">jsNode</span>))</span><br><span class="line">            )</span><br><span class="line">        node.<span class="property">jsNode</span> = callExp</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ¨¡æ¿ASTä¸­Elementç±»å‹èŠ‚ç‚¹è½¬æ¢æˆJSASTä¸­ç±»å‹èŠ‚ç‚¹FunctionDeclç±»å‹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">transformRoot</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(node.<span class="property">type</span> !== <span class="string">&#x27;Root&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> vnodeJSAST = node.<span class="property">children</span>[<span class="number">0</span>].<span class="property">jsNode</span></span><br><span class="line">        node.<span class="property">jsNode</span> = &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;FunctionDecl&#x27;</span>,</span><br><span class="line">            <span class="attr">id</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Identifier&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;render&#x27;</span> &#125;,</span><br><span class="line">            <span class="attr">params</span>: [],</span><br><span class="line">            <span class="attr">body</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;ReturnStatement&#x27;</span>,</span><br><span class="line">                    <span class="attr">return</span>: vnodeJSAST</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è€ƒè™‘å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p>
<p><strong>é—®é¢˜ä¸€ï¼š</strong> ASTæ˜¯æ ‘å½¢ç»“æ„ï¼Œæ‰€ä»¥æƒ³è¦å°†ä¸€ç§ASTè½¬æ¢æˆå¦ä¸€ç§ASTæˆ‘ä»¬éœ€è¦è¿›è¡Œæ ‘çš„æ·±åº¦éå†ï¼Œå¦‚ä½•åœ¨éå†çš„è¿‡ç¨‹ä¸­å¯¹å…¶ä¸­çš„èŠ‚ç‚¹è¿›è¡Œä¿®æ”¹ã€åˆ é™¤å’Œæ›¿æ¢ç­‰æ“ä½œï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª context ä¸Šä¸‹æ–‡ï¼Œç”¨äºå­˜å‚¨å½“å‰çš„èŠ‚ç‚¹ï¼Œçˆ¶èŠ‚ç‚¹ï¼Œä»¥åŠéœ€è¦æ“ä½œçš„å‡½æ•°ã€‚åœ¨éå†çš„å¼€å§‹è®©èŠ‚ç‚¹æ‰§è¡Œæ¯ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p><strong>é—®é¢˜äºŒï¼š</strong> åœ¨è½¬æ¢ASTçš„è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€éœ€è¦æ ¹æ®å­èŠ‚ç‚¹çš„æƒ…å†µæ¥åˆ¤æ–­å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡Œæ›¿æ¢ï¼Œè¿™å°±è¦æ±‚çˆ¶èŠ‚ç‚¹è½¬æ¢æ“ä½œå¿…é¡»ç­‰å¾…æ‰€æœ‰å­èŠ‚ç‚¹è½¬æ¢å®Œæ¯•ä»¥åå†æ‰§è¡Œã€‚è¿™ç‚¹å¦‚ä½•å»åšï¼Ÿ</p>
<p>åœ¨ä¸Šè¿°éå†è¿‡ç¨‹ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªæ•°ç»„ç”¨äºå­˜å‚¨å‡½æ•°ï¼Œåœ¨éå†çš„æœ€åå†å»æ‰§è¡Œè¿™äº›å‡½æ•°</p>
<p>è§£å†³äº†ä¸Šé¢ä¸¤ä¸ªé—®é¢˜æˆ‘ä»¬ä¸Šä»£ç ï¼Œæˆ‘ä»¬åœ¨æ·±åº¦éå†çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä¸Šé¢å®šä¹‰çš„è¾…åŠ©å‡½æ•°ï¼Œå®ç°äº†ASTçš„è½¬æ¢ï¼Œå¾—åˆ°äº†æœ¬å°ç»“å¼€å§‹å¤„æ‰€æƒ³è¦çš„ <code>FunctionDeclNode</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">transform</span>(<span class="params">ast</span>) &#123;</span><br><span class="line">    <span class="title function_">dump</span>(ast)</span><br><span class="line">    <span class="keyword">const</span> context = &#123;</span><br><span class="line">        <span class="attr">currentNode</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">childIndex</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">parent</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">nodeTransforms</span>: [</span><br><span class="line">            transformRoot,</span><br><span class="line">            transformElement,</span><br><span class="line">            transformText</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">traverseNode</span>(ast, context)</span><br><span class="line">    <span class="title function_">dump</span>(ast)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·±åº¦éå†æ¨¡æ¿AST</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">traverseNode</span>(<span class="params">ast, context</span>) &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰åˆå§‹èŠ‚ç‚¹</span></span><br><span class="line">    context.<span class="property">currentNode</span> = ast</span><br><span class="line">    <span class="comment">// å­˜å‚¨å‡½æ•°çš„æ•°ç»„</span></span><br><span class="line">    <span class="keyword">const</span> exitFns = []</span><br><span class="line">    <span class="comment">// ä¸Šä¸‹æ–‡ä¸­çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> transforms = context.<span class="property">nodeTransforms</span></span><br><span class="line">    <span class="comment">// ä¾æ¬¡å°†å‡½æ•°å­˜å…¥exitFnsä¸­</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; transforms.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> onExit = transforms[i](context.<span class="property">currentNode</span>, context)</span><br><span class="line">        <span class="keyword">if</span>(onExit) &#123;</span><br><span class="line">            exitFns.<span class="title function_">push</span>(onExit)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!context.<span class="property">currentNode</span>) <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">const</span> children = context.<span class="property">currentNode</span>.<span class="property">children</span></span><br><span class="line">    <span class="keyword">if</span>(children) &#123;</span><br><span class="line">        <span class="comment">// æ·±åº¦éå†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            context.<span class="property">parent</span> = context.<span class="property">currentNode</span></span><br><span class="line">            context.<span class="property">childIndex</span> = i</span><br><span class="line">            <span class="title function_">traverseNode</span>(children[i], context)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œå‡½æ•°</span></span><br><span class="line">    <span class="keyword">let</span> i = exitFns.<span class="property">length</span></span><br><span class="line">    <span class="keyword">while</span>(i--) &#123;</span><br><span class="line">        exitFns[i]()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-generate-è¯¦è§£"><a href="#7-generate-è¯¦è§£" class="headerlink" title="7 generate è¯¦è§£"></a>7 generate è¯¦è§£</h2><p>æœ‰äº† JavaScriptASTï¼Œæ¥ä¸‹æ¥å°±æ˜¯<strong>å­—ç¬¦ä¸²æ‹¼æ¥çš„è‰ºæœ¯</strong>äº†ã€‚æˆ‘ä»¬éœ€è¦æ ¹æ® JavaScriptAST æ¥ç”Ÿæˆæœ€ç»ˆçš„ render å‡½æ•°ï¼ŒVue ä¼šæ ¹æ®ç»„ä»¶çš„ render å‡½æ•°è¿”å›å€¼æ‹¿åˆ°è™šæ‹Ÿ DOM ï¼Œç„¶åå†ç»è¿‡æ¸²æŸ“å™¨çš„æ¸²æŸ“ï¼Œå°±å¯ä»¥æŠŠè™šæ‹Ÿ DOM æ¸²æŸ“æˆçœŸå®çš„ DOMã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compile</span>(<span class="params">template</span>) &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆæ¨¡æ¿AST</span></span><br><span class="line">    <span class="keyword">const</span> ast = <span class="title function_">parse</span>(template)</span><br><span class="line">    <span class="comment">// è½¬æ¢æˆJavaScriptAST</span></span><br><span class="line">    <span class="title function_">transform</span>(ast)</span><br><span class="line">    <span class="comment">// ç”Ÿæˆæ¸²æŸ“å‡½æ•°</span></span><br><span class="line">    <span class="keyword">const</span> code = <span class="title function_">generate</span>(ast.<span class="property">jsNode</span>)</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶è¿™æ˜¯åè¯äº†ï¼Œåœ¨æ¨¡æ¿ç¼–è¯‘çš„æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨<strong>å¦‚ä½•æ ¹æ® JavaScriptAST æ‹¼æ¥æˆæœ€åçš„ render å‡½æ•°ã€‚</strong></p>
<p>å› ä¸ºè¦ç”Ÿæˆå‡½æ•°çš„æè¿°ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€äº›è¦ç”¨åˆ°çš„è¾…åŠ©å‡½æ•°åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒ context ä¸­ï¼Œcontext ä¸­çš„ code å°±æ˜¯æˆ‘ä»¬æœ€ç»ˆéœ€è¦çš„ render å‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">generate</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> context = &#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="title function_">push</span>(<span class="params">code</span>) &#123;</span><br><span class="line">            context.<span class="property">code</span> += code</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">currentIndent</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="title function_">newline</span>(<span class="params"></span>) &#123;</span><br><span class="line">            context.<span class="property">code</span> += <span class="string">&#x27;\n&#x27;</span> + <span class="string">`  `</span>.<span class="title function_">repeat</span>(context.<span class="property">currentIndent</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">indent</span>(<span class="params"></span>) &#123;</span><br><span class="line">            context.<span class="property">currentIndent</span>++</span><br><span class="line">            context.<span class="title function_">newline</span>()</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">deIndent</span>(<span class="params"></span>) &#123;</span><br><span class="line">            context.<span class="property">currentIndent</span>--</span><br><span class="line">            context.<span class="title function_">newline</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">genNode</span>(node, context)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> context.<span class="property">code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>genNode çš„é€»è¾‘å¾ˆç®€å•ï¼Œæ ¹æ®èŠ‚ç‚¹çš„ä¸åŒç±»å‹æ‰§è¡Œä¸åŒçš„å‡½æ•°ï¼Œè¿™é‡Œçš„ node å°±æ˜¯è½¬æ¢è€Œæ¥çš„ JavaScriptASTã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">genNode</span>(<span class="params">node, context</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(node.<span class="property">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;FunctionDecl&#x27;</span>:</span><br><span class="line">            <span class="title function_">genFunctionDecl</span>(node, context)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;ReturnStatement&#x27;</span>:</span><br><span class="line">            <span class="title function_">genReturnStatement</span>(node, context)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;CallExpression&#x27;</span>:</span><br><span class="line">            <span class="title function_">genCallExpression</span>(node, context)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;StringLiteral&#x27;</span>:</span><br><span class="line">            <span class="title function_">genStringLiteral</span>(node, context)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;ArrayExpression&#x27;</span>:</span><br><span class="line">            <span class="title function_">genArrayExpression</span>(node, context)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èŠ‚ç‚¹ç±»å‹ä¸º FunctionDeclï¼Œéœ€è¦ç”Ÿæˆ <code>function(...) &#123; ... &#125;</code>ã€‚</p>
<ul>
<li>å‚æ•°éƒ¨åˆ†éœ€è¦è°ƒç”¨ genNodeï¼Œæœ€ç»ˆèµ°åˆ° ArrayExpression ç±»å‹çš„åˆ¤æ–­ã€‚è¿™é‡Œæˆ‘ä»¬å‚æ•°ä¸ºç©ºï¼Œå› æ­¤ä¸æ‰§è¡Œã€‚</li>
<li>å‡½æ•°ä½“å†…å®¹éœ€è¦è°ƒç”¨ genNode å°† FunctionDecl å†…éƒ¨çš„ body æ•°ç»„ä¸­çš„å¯¹è±¡ä¾æ¬¡æ‰§è¡Œä¸€éã€‚è¿™é‡Œæˆ‘ä»¬çš„å¯¹è±¡åªæœ‰ä¸€ä¸ª ReturnStatement ç±»å‹çš„èŠ‚ç‚¹ï¼Œçœ‹ä¸‹ä¸€æ­¥</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">genFunctionDecl</span>(<span class="params">node, context</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; push, indent, deIndent &#125; = context</span><br><span class="line">    <span class="title function_">push</span>(<span class="string">`function <span class="subst">$&#123;node.id.name&#125;</span>`</span>)</span><br><span class="line">    <span class="title function_">push</span>(<span class="string">`(`</span>)</span><br><span class="line">    <span class="comment">// ä¸ºå‡½æ•°çš„å‚æ•°ç”Ÿæˆä»£ç </span></span><br><span class="line">    <span class="title function_">genNodeList</span>(node.<span class="property">params</span>, context)</span><br><span class="line">    <span class="title function_">push</span>(<span class="string">`) `</span>)</span><br><span class="line">    <span class="title function_">push</span>(<span class="string">&#x27;&#123;&#x27;</span>)</span><br><span class="line">    <span class="title function_">indent</span>()</span><br><span class="line">    node.<span class="property">body</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">n</span> =&gt;</span> <span class="title function_">genNode</span>(n, context))</span><br><span class="line">    <span class="title function_">deIndent</span>()</span><br><span class="line">    <span class="title function_">push</span>(<span class="string">`&#125;`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èŠ‚ç‚¹ç±»å‹ä¸º ReturnStatementï¼Œç”Ÿæˆ <code>return ...</code></p>
<ul>
<li>return åé¢çš„å†…å®¹è°ƒç”¨ genNode ç”Ÿæˆã€‚è¿™é‡Œæˆ‘ä»¬ node.return çš„ç±»å‹æ˜¯ CallExpression</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">genReturnStatement</span>(<span class="params">node, context</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; push &#125; = context</span><br><span class="line">    <span class="title function_">push</span>(<span class="string">`return `</span>)</span><br><span class="line">    <span class="title function_">genNode</span>(node.<span class="property">return</span>, context)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èŠ‚ç‚¹ç±»å‹ä¸º CallExpressionï¼Œç”Ÿæˆ<code>funName(...)</code>ï¼Œæˆ‘ä»¬çš„ funName ä¸º hï¼Œå› æ­¤æœ€ç»ˆç”Ÿæˆçš„å°±æ˜¯<code>h(...)</code>ï¼Œå‡½æ•°è°ƒç”¨çš„å‚æ•°å†æ¬¡é€šè¿‡è°ƒç”¨ genNode ç”Ÿæˆã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">genCallExpression</span>(<span class="params">node, context</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; push &#125; = context</span><br><span class="line">    <span class="keyword">const</span> &#123; callee, <span class="attr">arguments</span>: args &#125; = node</span><br><span class="line">    <span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;callee.name&#125;</span>(`</span>)</span><br><span class="line">    <span class="title function_">genNodeList</span>(args, context)</span><br><span class="line">    <span class="title function_">push</span>(<span class="string">`)`</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>èŠ‚ç‚¹ç±»å‹ä¸º StringLiteralï¼Œå°†å¯¹åº”çš„ value å€¼åŠ åˆ° code ä¸Šå³å¯</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">genStringLiteral</span>(<span class="params">node, context</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; push &#125; = context</span><br><span class="line">    <span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;node.value&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/23/js%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E2%80%94%E2%80%94%E9%80%BB%E8%BE%91%E6%AD%A3%E7%A1%AE%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="wk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wkçš„åšå®¢">
      <meta itemprop="description" content="ä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | wkçš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/23/js%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E2%80%94%E2%80%94%E9%80%BB%E8%BE%91%E6%AD%A3%E7%A1%AE%E6%80%A7/" class="post-title-link" itemprop="url">jsä»£ç è´¨é‡â€”â€”é€»è¾‘æ­£ç¡®æ€§</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-03-23 13:40:38" itemprop="dateCreated datePublished" datetime="2022-03-23T13:40:38+08:00">2022-03-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-07 17:48:23" itemprop="dateModified" datetime="2023-05-07T17:48:23+08:00">2023-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>å¯¹äºåˆå…¥èŒåœºçš„æˆ‘ä»¬ï¼Œæœ€é‡è¦çš„å°±æ˜¯å­¦ä¹ å¦‚ä½•å†™å‡ºé«˜è´¨é‡çš„ js ä»£ç ã€‚å­¦ä¹ çš„é€”å¾„ä¹Ÿå¾ˆç®€å•ï¼Œå¤šçœ‹ï¼Œå¤šå†™ï¼Œå¤šæ€»ç»“ï¼š</p>
<ul>
<li>å¤šçœ‹ï¼šçœ‹å¤§ä½¬ä»¬å†™çš„ä»£ç ï¼Œå­¦ä¹ ä»–ä»¬æ™ºæ…§çš„ç»“æ™¶</li>
<li>å¤šå†™ï¼šçº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œä¸åœçš„æ•²ä»£ç æ‰èƒ½å‘ç°è‡ªå·±çš„é—®é¢˜ï¼Œæå‡è‡ªå·±</li>
<li>å¤šæ€»ç»“ï¼šæˆ‘ä¸€ç›´ä»¥æ¥å¥‰è¡Œçš„å­¦ä¹ æ–¹æ³•æœ‰ä¸¤ç§â€”â€”<strong>é—®é¢˜é©±åŠ¨å­¦ä¹ </strong>å’Œ<strong>è¾“å‡ºå€’é—­è¾“å…¥</strong>ã€‚åªæœ‰è‡ªå·±è®¤çœŸçš„æ€è€ƒæ€»ç»“è¿‡ï¼Œæ‰èƒ½å‘ç°å¾ˆå¤šé—®é¢˜çš„ç»†èŠ‚ï¼ŒçœŸæ­£çš„å»æŒæ¡çŸ¥è¯†ã€‚</li>
</ul>
<p>å½“ç„¶ï¼Œ<strong>æˆ‘ä¹Ÿæ˜¯ä¸€ä¸ªåˆå…¥å‰ç«¯çš„å°èœé¸¡</strong>ï¼Œæœ¬ç¯‡åšå®¢æœ‰å†…å®¹æˆ–è®¤çŸ¥ä¸Šçš„é”™è¯¯å±äºæ­£å¸¸ç°è±¡ï¼Œå¸Œæœ›å„ä½è§‚ä¼—è€çˆ·ä»¬ä¸åèµæ•™ã€‚æœ¬ç¯‡åšå®¢ä¹Ÿä¸æ˜¯ä¸€æ¬¡å°±å®Œæˆï¼Œåé¢æ¯æ¬¡å°çŒªé‡åˆ°æ–°çš„é—®é¢˜éƒ½ä¼šè·Ÿè¿›åšå®¢ï¼Œå½“ç„¶ä¹Ÿæ¬¢è¿å¤§å®¶æ¥è¯„è®ºåŒºè¡¥å……ï¼</p>
<h2 id="0-ä»€ä¹ˆæ˜¯é€»è¾‘æ­£ç¡®æ€§ï¼Ÿ"><a href="#0-ä»€ä¹ˆæ˜¯é€»è¾‘æ­£ç¡®æ€§ï¼Ÿ" class="headerlink" title="0 ä»€ä¹ˆæ˜¯é€»è¾‘æ­£ç¡®æ€§ï¼Ÿ"></a>0 ä»€ä¹ˆæ˜¯é€»è¾‘æ­£ç¡®æ€§ï¼Ÿ</h2><h2 id="1-ä¸‰å…ƒè¡¨è¾¾å¼"><a href="#1-ä¸‰å…ƒè¡¨è¾¾å¼" class="headerlink" title="1. ä¸‰å…ƒè¡¨è¾¾å¼"></a>1. ä¸‰å…ƒè¡¨è¾¾å¼</h2><p>æœ‰æ—¶å€™ä¼šå‡ºç°ä¸‹é¢æ¯”è¾ƒç–‘æƒ‘çš„å†™æ³•</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> isTrue === <span class="literal">true</span> ? <span class="string">&#x27;yes&#x27;</span> : <span class="string">&#x27;no&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ—¢ç„¶ isTrue å·²ç»æ˜¯å¸ƒå°”ç±»å‹ï¼Œä¸ºä»€ä¹ˆä¸å°è¯•ä¸‹é¢è¿™ç§ä¼˜é›…çš„å†™æ³•å‘¢ï¼Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> isTrue ? <span class="string">&#x27;yes&#x27;</span> : <span class="string">&#x27;no&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wk</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
