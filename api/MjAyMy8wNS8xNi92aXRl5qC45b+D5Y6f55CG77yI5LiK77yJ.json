{"title":"viteæ ¸å¿ƒåŸç†ï¼ˆä¸Šï¼‰","date":"2023-05-16T01:30:09.000Z","date_formatted":{"ll":"May 16, 2023","L":"05/16/2023","MM-DD":"05-16"},"link":"2023/05/16/viteæ ¸å¿ƒåŸç†ï¼ˆä¸Šï¼‰","tags":["å‰ç«¯","æ„å»ºå·¥å…·"],"categories":["Vite"],"updated":"2023-05-21T23:58:50.533Z","content":"<p>æ„å»ºå·¥å…·æ˜¯å‰ç«¯å¼€å‘ææ•ˆçš„é‡è¦å·¥å…·ï¼Œå®ƒæ‹¥æœ‰å„ç§å„æ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ€»ç»“ä¸ºä¸€æ¡å°±æ˜¯â€”â€”è§£å†³å‰ç«¯å·¥ç¨‹ä¸­çš„ç—›ç‚¹ã€‚å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>æ¨¡å—åŠ è½½ï¼šæŒ‰ç…§åˆ¶å®šçš„æ¨¡å—è§„èŒƒï¼ŒåŠ è½½æ–‡ä»¶</li>\n<li>å¼€å‘æ•ˆç‡ï¼šçƒ­æ›´æ–°</li>\n<li>è¯­æ³•è½¬è¯‘ï¼štsè½¬æ¢jsã€scssè½¬æ¢css</li>\n<li>äº§ç‰©è´¨é‡ï¼šå‹ç¼©ä»£ç ã€ä»£ç æ£€æµ‹ã€tree-shaking</li>\n</ul>\n<h2 id=\"1-æ¨¡å—åŒ–\">1 æ¨¡å—åŒ–<a title=\"#1-æ¨¡å—åŒ–\" href=\"#1-æ¨¡å—åŒ–\"></a></h2>\n<blockquote>\n<p>æ¨¡å—åŒ–è§„èŒƒ</p>\n<p>æ„å»ºå·¥å…·è§£å†³çš„é—®é¢˜</p>\n</blockquote>\n<p>åœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè‡ªèº«å°±å…·å¤‡äº†å¾ˆå¥½çš„æ–‡ä»¶å’ŒåŒ…ç®¡ç†æœºåˆ¶ï¼Œé€šè¿‡importã€includeã€requireç­‰ç­‰å‘½ä»¤ï¼Œå¯ä»¥å¼•å…¥å…¶ä»–æ¨¡å—ã€åŒ…æˆ–è€…æ–‡ä»¶ã€‚è€Œjsæ—©æœŸè¢«è®¤å®šä¸ºç®€å•çš„ç½‘é¡µè„šæœ¬è¯­è¨€ï¼Œåšä¸€äº›ç®€å•çš„è¡¨å•éªŒè¯æˆ–åŠ¨ç”»ï¼Œé‚£æ—¶å€™çš„ä»£ç é‡è¿˜æ˜¯å¾ˆå°‘çš„ï¼Œå› æ­¤åªéœ€è¦å°†jså†™å…¥scriptæ ‡ç­¾å³å¯ã€‚ä½†æ˜¯éšç€å‰ç«¯å’Œjsçš„å¿«é€Ÿå‘å±•ï¼Œjsçš„ä»£ç è¶Šæ¥è¶Šå¤æ‚ï¼Œæ²¡æœ‰æ¨¡å—åŒ–ä¼šå¸¦æ¥å¾ˆå¤šçš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šä»£ç çš„å¤ç”¨æ€§ã€éš”ç¦»æ€§å’Œå¯ç»´æŠ¤æ€§ç­‰ã€‚ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p>\n<p><strong>ä¸€ã€æ—©æœŸçš„æ¨¡å—åŒ–æ‰‹æ®µ</strong></p>\n<p>æ—©æœŸæ¨¡å—åŒ–è¿˜æ²¡æœ‰è¯ç”Ÿæ—¶ï¼Œä¸šç•Œå°±å·²ç»äº§ç”Ÿäº†ä¸€äº›æ¨¡å—åŒ–å¼€å‘çš„æ‰‹æ®µâ€”â€”<strong>æ–‡ä»¶åˆ’åˆ†</strong></p>\n<p>æ–‡ä»¶åˆ’åˆ†æ˜¯å°†åº”ç”¨çš„çŠ¶æ€å’Œé€»è¾‘åˆ†æ•£åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œæœ€åé€šè¿‡scriptæ ‡ç­¾å¼•å…¥ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// moudle-a.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">&#x27;wukui&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// module-b.js</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">helloWorld</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;hello world&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;!<span class=\"variable constant_\">DOCTYPE</span> html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class=\"line\">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;script src=&quot;./modlue-a.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script src=&quot;./modlue-b.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">        console.log(name)</span><br><span class=\"line\">        helloWorld()</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>è¿™ç§æ–¹å¼å­˜åœ¨å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p>\n<ul>\n<li>**ä¾èµ–ç®¡ç†ï¼š**æ–‡ä»¶ä¹‹é—´å­˜åœ¨åŠ è½½é¡ºåºï¼Œå½“æ¨¡å—ä¹‹é—´ç›¸äº’ä¾èµ–æ—¶ï¼Œéšç€æ¨¡å—çš„å¢åŠ å¾ˆéš¾æ¢³ç†æ¸…æ¥šï¼Œè¿˜ä¼šäº§ç”Ÿè¿è¡Œæ—¶çš„é”™è¯¯</li>\n<li>**éš”ç¦»æ€§ï¼š**å„æ¨¡å—ä¹‹é—´çš„å˜é‡å‘½åä¼šäº§ç”Ÿå†²çª</li>\n</ul>\n<p><strong>äºŒã€è¶…å¤§æ–‡ä»¶çš„ç»´æŠ¤</strong></p>\n<p>å½“ä»£ç è¡Œæ•°è¶Šæ¥è¶Šå¤šæ—¶ï¼Œé€æ¸å°±æ¼”å˜æˆäº†æˆ‘ä»¬å£ä¸­çš„ğŸ’©å±±ï¼Œä»£ç å˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç†è§£å’Œç»´æŠ¤ï¼Œå¯¹ç¨‹åºå‘˜é€ æˆäº†æå¤§çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚æ¨¡å—åŒ–å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡åˆç†çš„å±‚æ¬¡å’Œé€»è¾‘åˆ’åˆ†ï¼Œå¯ä»¥è®©ä»£ç ä¹‹é—´çš„å…³è”å˜å¾—æ¸…æ™°ï¼Œå•ä¸ªæ¨¡å—çš„èŒè´£æ˜ç¡®ï¼Œä»£ç é‡è‡ªç„¶å°±å°‘äº†ï¼Œå¯é˜…è¯»æ€§å’Œç»´æŠ¤æ€§ä¹Ÿéšä¹‹è€Œå‡ã€‚</p>\n<p>ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p>\n<p>ä»è¾ƒä¸ºå®è§‚çš„è§’åº¦æ¥çœ‹ï¼Œç°ä»£å‰ç«¯å¼€å‘æ¡†æ¶çš„æ¨¡å¼MVVM(Model-View-ViewModel)ï¼ŒModelå±‚ç”±åç«¯æ§åˆ¶ï¼ŒViewå±‚ç”±æ¡†æ¶æ¥æ§åˆ¶ï¼Œå› æ­¤å¼€å‘äººå‘˜ä¸éœ€è¦å…³æ³¨æ•°æ®æ•°æ®çš„ä¸šåŠ¡é€»è¾‘å’ŒDOMçš„æ“ä½œï¼Œåªéœ€è¦ä¸“æ³¨äºViewModelå¤„ç†ç›¸åº”çš„æ•°æ®çš„çŠ¶æ€å³å¯ã€‚æå¤§çš„ä¿ƒè¿›äº†å‰åç«¯çš„åˆ†ç¦»ï¼Œä¹Ÿæå‡äº†å‰ç«¯çš„å¼€å‘æ•ˆç‡ã€‚</p>\n<p>å†ç»†ç²’åº¦çš„æ¥çœ‹ï¼Œä¼šæœ‰ä¸€äº›çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå¸®åŠ©æˆ‘ä»¬å°†ViewModelåˆ†ä¸ºæœåŠ¡å±‚å’Œé€»è¾‘å±‚ã€‚æœåŠ¡å±‚ä¸“æ³¨äºå’Œåç«¯çš„äº¤äº’ï¼Œé€šè¿‡ajaxæ‹¿åˆ°åç«¯çš„æ•°æ®ã€‚é€»è¾‘å±‚è´Ÿè´£å¤„ç†æ•°æ®ï¼Œå®ƒä¸å…³å¿ƒå¦‚ä½•è·å–æ•°æ®ï¼Œåªéœ€è¦å…³æ³¨æ•°æ®çš„çŠ¶æ€å˜åŒ–ã€‚</p>\n<p>é™¤äº†ä»£ç å±‚é¢ï¼Œä»ä»£ç çš„ç®¡ç†ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°æ¨¡å—åŒ–çš„å¥½å¤„ã€‚vue2æºç æ‰˜ç®¡åœ¨srcç›®å½•ä¸­ï¼Œç„¶åæ›´å…·åŠŸèƒ½æ‹†åˆ†å‡ºäº†ç„¶åä¾æ®åŠŸèƒ½æ‹†åˆ†å‡ºäº† compilerã€coreã€platformsã€serverã€sfcã€sharedç­‰ç›®å½•ã€‚è€Œåˆ°äº†vue3ï¼Œåˆ™æ˜¯é€šè¿‡monoropeçš„æ–¹å¼ç»´æŠ¤ï¼Œå°†ä¸åŒçš„åŠŸèƒ½æ‹†åˆ†åˆ°ä¸åŒçš„æ¨¡å—å½“ä¸­ã€‚äº‹å®ä¸Šä¸æ­¢vueï¼Œéšç€monoropeæ–¹æ¡ˆçš„æˆç†Ÿï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€æºé¡¹ç›®éƒ½åœ¨ä½¿ç”¨monoropeçš„æ–¹å¼è¿›è¡Œç®¡ç†ã€‚</p>\n<p><strong>ä¸‰ã€CommonJS æ¨ªç©ºå‡ºä¸–ï¼Œnodeåº”è¿è€Œç”Ÿ</strong></p>\n<p>2009å¹´1æœˆ29æ—¥ï¼ŒMozillaçš„å·¥ç¨‹å¸ˆKevin Dangoorå‘å¸ƒäº†ä¸€ç¯‡æ–‡ç« ã€ŠWhat Server Side JavaScript needsã€‹ï¼Œå¹¶åœ¨Google Groupsä¸­åˆ›å»ºäº†ä¸€ä¸ªServerJSå°ç»„ï¼Œæ—¨åœ¨æ„å»ºæ›´å¥½çš„JavaScriptç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬æœåŠ¡å™¨ç«¯ã€æµè§ˆå™¨ç«¯ï¼Œè€Œåæ›´åä¸ºCommonJSå°ç»„ï¼Œå‘èµ·äº†CommonJSçš„ææ¡ˆã€‚å½“å¹´å¹´æœ«ï¼ŒnodeåŸºäºCommonJSè§„èŒƒæ¨ªç©ºå‡ºä¸–ï¼Œnodeè·Ÿå…·æ¨¡å—çš„ä¸åŒæ¥æºåˆ†ä¸ºäº†ä¸‰å¤§ç±»ï¼š</p>\n<ul>\n<li>å†…ç½®æ¨¡å—ï¼šfsã€pathã€httpç­‰</li>\n<li>è‡ªå®šä¹‰æ¨¡å—ï¼šç”¨æˆ·æŒ‰ç…§CommonJSè§„èŒƒåˆ›å»ºçš„ js æ–‡ä»¶</li>\n<li>ç¬¬ä¸‰æ–¹æ¨¡å—ï¼šç”±ç¬¬ä¸‰æ–¹å¼€å‘çš„æ¨¡å—ï¼Œå¹¶ä½¿ç”¨npmè¿›è¡Œç®¡ç†</li>\n</ul>\n<p>å‡­å€Ÿç€nodeâ€œå•çº¿ç¨‹â€å’Œâ€œå¤©ç„¶å¼‚æ­¥APIâ€ä¸‹çš„é«˜æ€§èƒ½è¿è¡Œæ—¶ï¼ŒJavaScriptæ­£å¼çš„è¸å…¥äº†æœåŠ¡ç«¯é¢†åŸŸã€‚è‡ªCommonJSè¯ç”Ÿä»¥æ¥ï¼Œå‰ç«¯ç¤¾åŒºå¯¹æ¨¡å—åŒ–æ¢ç´¢çš„è„šæ­¥ä¸€ç›´æœªåœæ­¢ï¼Œå…ˆåå‡ºç°äº†AMDã€CMDã€UMDå’ŒESModuleç­‰æ¨¡å—åŒ–è§„èŒƒï¼Œå¹¶è¯ç”Ÿå‡ºäº†ä¸€ç³»åˆ—çš„å·¥å…·</p>\n<ul>\n<li>åŸºäºCommonJSè§„èŒƒï¼šnode</li>\n<li>åŸºäºAMDè§„èŒƒï¼šrequireJS</li>\n<li>åŸºäºCMDè§„èŒƒï¼šSeaJS</li>\n<li>åŸºäºESModuleï¼šnodeã€webpackã€viteã€æµè§ˆå™¨åŸç”Ÿæ”¯æŒ</li>\n</ul>\n<p><strong>å››ã€ESModule</strong></p>\n<p>ES Moduleç®€ç§°ESMï¼ŒESMæ˜¯ES6çš„å¼€å‘è§„èŒƒã€‚ES6äº2015å¹´6æœˆæ­£å¼å‘å¸ƒï¼Œç›®å‰å·²ç»è¢«å¤§éƒ¨åˆ†ä¸»æµæµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼Œåªè¦HTMLä¸­æœ‰type=&quot;module&quot;å±æ€§çš„scriptæ ‡ç­¾ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šæŒ‰ç…§ES Moduleè§„èŒƒäº†æ¥è¿›è¡Œä¾èµ–åŠ è½½å’Œæ¨¡å—è§£æã€‚Nodeæœ€å¼€å§‹ä½¿ç”¨çš„æ˜¯CommonJSè§„èŒƒï¼Œä½†è‡ªä»v13.2.0ä¹‹åä¹Ÿå¼•å…¥äº†ES Moduleæœºåˆ¶ã€‚ä¸‹é¢ä¸¤å¼ å›¾æ˜¯æ¥è‡ª<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules\" target=\"_blank\">MDN</a>ï¼Œæ˜¾ç¤ºäº†importå’Œexportçš„åœ¨æµè§ˆå™¨ä¸Šçš„å…¼å®¹æ€§ã€‚</p>\n<p>importï¼š</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7effc532c8c46b49fcf250f724e9e41~tplv-k3u1fbpfcp-watermark.image?\" alt=\"image.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>exportï¼š</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f7c6e427c874515b7a7946c306d1225~tplv-k3u1fbpfcp-watermark.image?\" alt=\"image.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>ç®€å•åˆ—ä¸¾ä¸€ä¸‹ESModuleçš„ä½¿ç”¨ï¼š</p>\n<p>1ï¼‰å¯¼å‡ºæ¨¡å—</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> name = <span class=\"string\">&#x27;wk&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">helloWorld</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;hello world&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// name.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">&#x27;wk&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">helloWorld</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;hello world&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; name, helloWorld &#125;</span><br></pre></td></tr></table></figure>\n<p>2ï¼‰å¯¼å…¥åŠŸèƒ½</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; name, helloWorld &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./name.js&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>3ï¼‰HTMLåº”ç”¨</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script type=<span class=\"string\">&quot;module&quot;</span> src=<span class=\"string\">&quot;./name.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p>4ï¼‰é»˜è®¤å¯¼å‡ºå¯¼å…¥</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// name.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">&#x27;wk&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> name</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// hello.js å¯¼å‡ºåŒ¿åå‡½æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t<span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;hello world&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">import</span> name <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./name.js&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> helloWorld <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./hello.js&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>5ï¼‰as é¿å…å‘½åå†²çª</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// inside module.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123;</span><br><span class=\"line\">  function1 <span class=\"keyword\">as</span> newFunctionName,</span><br><span class=\"line\">  function2 <span class=\"keyword\">as</span> anotherNewFunctionName</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// inside main.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; newFunctionName, anotherNewFunctionName &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;/modules/module.js&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// inside module.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; function1, function2 &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// inside main.js</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; function1 <span class=\"keyword\">as</span> newFunctionName,</span><br><span class=\"line\">         function2 <span class=\"keyword\">as</span> anotherNewFunctionName &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;/modules/module.js&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>6ï¼‰åˆå¹¶æ¨¡å—</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> * <span class=\"keyword\">from</span> <span class=\"string\">&#x27;a.js&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; name &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;name.js&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> &#123; helloWorld &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./hello.js&#x27;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"2-viteçš„ä½¿ç”¨\">2 viteçš„ä½¿ç”¨<a title=\"#2-viteçš„ä½¿ç”¨\" href=\"#2-viteçš„ä½¿ç”¨\"></a></h2>\n<blockquote>\n<p>ç®€ä»‹</p>\n<p>é¡¹ç›®æ­å»º</p>\n<p>é…ç½®</p>\n</blockquote>\n<p>viteä½œä¸ºæ–°ä¸€ä»£çš„æ„å»ºå·¥å…·ï¼Œæœ€çªå‡ºçš„äº®ç‚¹å°±æ˜¯æå¿«çš„æ„å»ºé€Ÿåº¦å’Œçƒ­æ›´æ–°é€Ÿåº¦ï¼Œå¤§å¤§çš„æå‡äº†ç ”å‘æ•ˆç‡ï¼Œè¿™ä¸€ç‚¹ä¼šåœ¨åé¢è¯¦ç»†ä»‹ç»ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œviteåœ¨å…¶ä»–æ–¹é¢ä¹Ÿè¡¨ç°ä¸ä¿—ã€‚</p>\n<p>è¿™é‡Œä½¿ç”¨viteæ­å»ºvue3é¡¹ç›®</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm create vite</span><br></pre></td></tr></table></figure>\n<p>ç›®å½•:</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7424f96355c74ae595050e65e6563592~tplv-k3u1fbpfcp-watermark.image?\" alt=\"image.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>package.json:</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6188a5ea1d314b199fd88a1e25a4724a~tplv-k3u1fbpfcp-watermark.image?\" alt=\"image.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>é¡¹ç›®å®‰è£…å’Œå¯åŠ¨ï¼šè™½ç„¶é¡¹ç›®è¾ƒå°ï¼Œä½†æ˜¯viteæ„å»ºå®Œæˆçš„æ—¶é—´ä»…ä½¿ç”¨äº†789ms</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i // å®‰è£…</span><br><span class=\"line\">npm run dev // å¯åŠ¨</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81d34826c3a544a08bf08efa35b34763~tplv-k3u1fbpfcp-watermark.image?\" alt=\"image.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h3 id=\"2.1-çƒ­æ›´æ–°\">2.1 çƒ­æ›´æ–°<a title=\"#2.1-çƒ­æ›´æ–°\" href=\"#2.1-çƒ­æ›´æ–°\"></a></h3>\n<blockquote>\n<p>viteçš„æ’ä»¶å…¼å®¹äº†rollupçš„æ‰€æœ‰é’©å­ã€‚å¦‚æœä½ çš„æ’ä»¶ä»…ä½¿ç”¨äº†è¿™äº›é’©å­ï¼Œé‚£ä¹ˆè¯¥æ’ä»¶ä»¥ rollup-plugin- å‰ç¼€ï¼Œè¡¨ç¤ºè¯¥æ’ä»¶æ˜¯å…¼å®¹rollupçš„ã€‚</p>\n<ul>\n<li>æœåŠ¡å™¨å¯åŠ¨æ—¶è¢«è°ƒç”¨ï¼šoptionsã€buildStart</li>\n<li>ä¼ å…¥æ¨¡å—æ—¶è¢«è°ƒç”¨ï¼šresolveIdã€loadã€transform</li>\n<li>æœåŠ¡å™¨å…³é—­æ—¶è¢«è°ƒç”¨ï¼šbuildEndã€closeBundle</li>\n</ul>\n<p>é™¤æ­¤ä¹‹å¤–ï¼Œviteè¿˜æä¾›äº†ä¸€äº›ä¸“å±çš„é’©å­ï¼Œè¿™äº›é’©å­ä¼šè¢«rollupå¿½ç•¥ï¼Œè¿™ç±»æ’ä»¶ä»¥ vite-plugin- å‰ç¼€ã€‚</p>\n<ul>\n<li>è§£æviteé…ç½®å‰ï¼šconfig</li>\n<li>è§£æviteé…ç½®åï¼šconfigResolve</li>\n<li>é…ç½®å¼€å‘æœåŠ¡å™¨ï¼šconfigureServer</li>\n<li>è½¬æ¢index.htmlï¼štransformIndexHtml</li>\n<li>HMRå¤„ç†ï¼šhandleHotUpdate</li>\n</ul>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8c0d21817694bcf8170f404373c27a3~tplv-k3u1fbpfcp-watermark.image?\" alt=\"image.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n</blockquote>\n<p>Vite æä¾›äº†ä¸€å¥—åŸç”Ÿ ESM çš„ <strong><a href=\"https://cn.vitejs.dev/guide/api-hmr.html\" target=\"_blank\">HMR API</a></strong>ã€‚ å…·æœ‰ HMR åŠŸèƒ½çš„æ¡†æ¶å¯ä»¥åˆ©ç”¨è¯¥ API æä¾›å³æ—¶ã€å‡†ç¡®çš„æ›´æ–°ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½é¡µé¢æˆ–æ¸…é™¤åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚Vite å†…ç½®äº† HMR åˆ° <strong><a href=\"https://github.com/vitejs/vite-plugin-vue/tree/main/packages/plugin-vue\" target=\"_blank\">Vue å•æ–‡ä»¶ç»„ä»¶ï¼ˆSFCï¼‰</a></strong> å’Œ <strong><a href=\"https://github.com/vitejs/vite-plugin-react/tree/main/packages/plugin-react\" target=\"_blank\">React Fast Refresh</a></strong> ä¸­ï¼Œå½“ä½ é€šè¿‡ <strong><a href=\"https://cn.vitejs.dev/guide/\" target=\"_blank\">create-vite</a></strong> åˆ›å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œæ‰€é€‰æ¨¡æ¿å·²ç»ä¸ºä½ é¢„å…ˆé…ç½®äº†è¿™äº›ã€‚å¾—ç›Šäºæµè§ˆå™¨åŸç”Ÿæ”¯æŒESMï¼Œå½“ä¿®æ”¹æŸä¸ªæ–‡ä»¶æ—¶ï¼Œçƒ­æ›´æ–°åŸºæœ¬ä¸éœ€è¦æ—¶é—´ã€‚è¿™ç‚¹ä¼šåœ¨ä¸‹é¢è¯¦ç»†æè¿°ã€‚</p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b668a1fc3fd64a60aca3c81f47949f15~tplv-k3u1fbpfcp-watermark.image?\" alt=\"image.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>æ¥ä¸‹æ¥ä»æºç çš„è§’åº¦æ¥åˆ†æviteå¦‚ä½•åšåˆ°çƒ­æ›´æ–°ã€‚</p>\n<p><img src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f56a81a6cddc40eaa4fb70d3d7f99a63~tplv-k3u1fbpfcp-watermark.image?\" alt=\"image.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<h4 id=\"æœåŠ¡ç«¯\">æœåŠ¡ç«¯<a title=\"#æœåŠ¡ç«¯\" href=\"#æœåŠ¡ç«¯\"></a></h4>\n<p>node.js æœ¬èº«æä¾›äº†å®˜æ–¹çš„ API ä¾‹å¦‚ fs.watch fs.watchFile æ¥ç›‘å¬æ–‡ä»¶çš„å˜åŒ–ï¼Œvite åˆ™ä½¿ç”¨äº†è¿™äº› API æ›´ä¸Šå±‚çš„å°è£…æ¨¡å—<a href=\"https://www.npmjs.com/package/chokidar\" target=\"_blank\">chokidar</a>æ¥è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿçš„å˜åŠ¨ç›‘å¬ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å¼€å¯ç›‘å¬</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> watcher = chokidar.<span class=\"title function_\">watch</span>(</span><br><span class=\"line\">  <span class=\"comment\">// config file dependencies and env file might be outside of root</span></span><br><span class=\"line\">  [root, ...config.<span class=\"property\">configFileDependencies</span>, config.<span class=\"property\">envDir</span>],</span><br><span class=\"line\">  resolvedWatchOptions,</span><br><span class=\"line\">) <span class=\"keyword\">as</span> <span class=\"title class_\">FSWatcher</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è§¦å‘é’©å­å‡½æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">onHMRUpdate</span> = <span class=\"keyword\">async</span> (<span class=\"params\">file: string, configOnly: boolean</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (serverConfig.<span class=\"property\">hmr</span> !== <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">await</span> <span class=\"title function_\">handleHMRUpdate</span>(file, server, configOnly)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">      ws.<span class=\"title function_\">send</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">type</span>: <span class=\"string\">&#x27;error&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">err</span>: <span class=\"title function_\">prepareError</span>(err),</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ–‡ä»¶æ–°å¢ã€åˆ é™¤è§¦å‘é’©å­</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">onFileAddUnlink</span> = <span class=\"keyword\">async</span> (<span class=\"params\">file: string</span>) =&gt; &#123;</span><br><span class=\"line\">  file = <span class=\"title function_\">normalizePath</span>(file)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> <span class=\"title function_\">handleFileAddUnlink</span>(file, server)</span><br><span class=\"line\">  <span class=\"keyword\">await</span> <span class=\"title function_\">onHMRUpdate</span>(file, <span class=\"literal\">true</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç›‘å¬æ–‡ä»¶å˜åŒ–</span></span><br><span class=\"line\">watcher.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;change&#x27;</span>, <span class=\"keyword\">async</span> (file) =&gt; &#123;</span><br><span class=\"line\">  file = <span class=\"title function_\">normalizePath</span>(file)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (file.<span class=\"title function_\">endsWith</span>(<span class=\"string\">&#x27;/package.json&#x27;</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">invalidatePackageData</span>(packageCache, file)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// invalidate module graph cache on file change</span></span><br><span class=\"line\">  moduleGraph.<span class=\"title function_\">onFileChange</span>(file)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">await</span> <span class=\"title function_\">onHMRUpdate</span>(file, <span class=\"literal\">false</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç›‘å¬æ–°å¢æ–‡ä»¶</span></span><br><span class=\"line\">watcher.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;add&#x27;</span>, onFileAddUnlink)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç›‘å¬åˆ é™¤æ–‡ä»¶</span></span><br><span class=\"line\">watcher.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;unlink&#x27;</span>, onFileAddUnlink)</span><br></pre></td></tr></table></figure>\n<p>å½“æ–‡ä»¶æœ‰å˜åŠ¨æ—¶ï¼Œviteä¼šè§¦å‘handleHotUpdateé’©å­ï¼Œæ‹¿åˆ°å¤„ç†åçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶é€šè¿‡webSocketå»ºç«‹çš„é€šé“å‘ŠçŸ¥æµè§ˆå™¨è¿›è¡Œåˆ·æ–°æˆ–è€…åŠ è½½æ–‡ä»¶ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ‰§è¡Œé’©å­å‡½æ•°ï¼Œè·å–ä¸Šä¸‹æ–‡</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> hook <span class=\"keyword\">of</span> config.<span class=\"title function_\">getSortedPluginHooks</span>(<span class=\"string\">&#x27;handleHotUpdate&#x27;</span>)) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> filteredModules = <span class=\"keyword\">await</span> <span class=\"title function_\">hook</span>(hmrContext)</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (filteredModules) &#123;</span><br><span class=\"line\">    hmrContext.<span class=\"property\">modules</span> = filteredModules</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// é€šçŸ¥é‡æ–°åŠ è½½</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!hmrContext.<span class=\"property\">modules</span>.<span class=\"property\">length</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// html file cannot be hot updated</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (file.<span class=\"title function_\">endsWith</span>(<span class=\"string\">&#x27;.html&#x27;</span>)) &#123;</span><br><span class=\"line\">    config.<span class=\"property\">logger</span>.<span class=\"title function_\">info</span>(colors.<span class=\"title function_\">green</span>(<span class=\"string\">`page reload `</span>) + colors.<span class=\"title function_\">dim</span>(shortFile), &#123;</span><br><span class=\"line\">      <span class=\"attr\">clear</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">timestamp</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    ws.<span class=\"title function_\">send</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">type</span>: <span class=\"string\">&#x27;full-reload&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">path</span>: config.<span class=\"property\">server</span>.<span class=\"property\">middlewareMode</span></span><br><span class=\"line\">      ? <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">      : <span class=\"string\">&#x27;/&#x27;</span> + <span class=\"title function_\">normalizePath</span>(path.<span class=\"title function_\">relative</span>(config.<span class=\"property\">root</span>, file)),</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// loaded but not in the module graph, probably not js</span></span><br><span class=\"line\">    <span class=\"title function_\">debugHmr</span>(<span class=\"string\">`[no modules matched] <span class=\"subst\">$&#123;colors.dim(shortFile)&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// é€šçŸ¥æ›´æ–°</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (updates.<span class=\"property\">length</span> === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">debugHmr</span>(colors.<span class=\"title function_\">yellow</span>(<span class=\"string\">`no update happened `</span>) + colors.<span class=\"title function_\">dim</span>(file))</span><br><span class=\"line\">  <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">config.<span class=\"property\">logger</span>.<span class=\"title function_\">info</span>(</span><br><span class=\"line\">  colors.<span class=\"title function_\">green</span>(<span class=\"string\">`hmr update `</span>) +</span><br><span class=\"line\">  colors.<span class=\"title function_\">dim</span>([...<span class=\"keyword\">new</span> <span class=\"title class_\">Set</span>(updates.<span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">u</span>) =&gt;</span> u.<span class=\"property\">path</span>))].<span class=\"title function_\">join</span>(<span class=\"string\">&#x27;, &#x27;</span>)),</span><br><span class=\"line\">  &#123; <span class=\"attr\">clear</span>: !afterInvalidation, <span class=\"attr\">timestamp</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">)</span><br><span class=\"line\">ws.<span class=\"title function_\">send</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">type</span>: <span class=\"string\">&#x27;update&#x27;</span>,</span><br><span class=\"line\">  updates,</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"å®¢æˆ·ç«¯\">å®¢æˆ·ç«¯<a title=\"#å®¢æˆ·ç«¯\" href=\"#å®¢æˆ·ç«¯\"></a></h4>\n<p>æµè§ˆå™¨åœ¨æ•´ä¸ªç³»ç»Ÿæ‰®æ¼”ç€å®¢æˆ·ç«¯çš„è§’è‰²ï¼Œviteé€šè¿‡transformIndexHtmlçš„hookå°†å®¢æˆ·ç«¯ä»£ç æ’å…¥äº†index.html</p>\n<p><img src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5fdcd95093904b2ab41230c566748ceb~tplv-k3u1fbpfcp-watermark.image?\" alt=\"image.png\" loading=\"lazy\" class=\"Ï†bp\"></p>\n<p>å®¢æˆ·ç«¯æ¥å—åˆ°æ¶ˆæ¯åï¼Œä¼šæ ¹æ®æœåŠ¡ç«¯å‘é€çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚ä¼šæ ¹æ®ä¸åŒæƒ…å†µï¼Œè¿›è¡Œè¯·æ±‚æ–‡ä»¶å†åˆ·æ–°æˆ–è€…æ˜¯ç›´æ¥åˆ·æ–°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">&#x27;update&#x27;</span>:</span><br><span class=\"line\">      <span class=\"title function_\">notifyListeners</span>(<span class=\"string\">&#x27;vite:beforeUpdate&#x27;</span>, payload)</span><br><span class=\"line\">      <span class=\"comment\">// if this is the first update and there&#x27;s already an error overlay, it</span></span><br><span class=\"line\">      <span class=\"comment\">// means the page opened with existing server compile error and the whole</span></span><br><span class=\"line\">      <span class=\"comment\">// module script failed to load (since one of the nested imports is 500).</span></span><br><span class=\"line\">      <span class=\"comment\">// in this case a normal update won&#x27;t work and a full reload is needed.</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isFirstUpdate &amp;&amp; <span class=\"title function_\">hasErrorOverlay</span>()) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">window</span>.<span class=\"property\">location</span>.<span class=\"title function_\">reload</span>()</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">clearErrorOverlay</span>()</span><br><span class=\"line\">        isFirstUpdate = <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">await</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">all</span>(</span><br><span class=\"line\">        payload.<span class=\"property\">updates</span>.<span class=\"title function_\">map</span>(<span class=\"keyword\">async</span> (update): <span class=\"title class_\">Promise</span>&lt;<span class=\"keyword\">void</span>&gt; =&gt; &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (update.<span class=\"property\">type</span> === <span class=\"string\">&#x27;js-update&#x27;</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"title function_\">queueUpdate</span>(<span class=\"title function_\">fetchUpdate</span>(update))</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// css-update</span></span><br><span class=\"line\">          <span class=\"comment\">// this is only sent when a css file referenced with &lt;link&gt; is updated</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> &#123; path, timestamp &#125; = update</span><br><span class=\"line\">          <span class=\"keyword\">const</span> searchUrl = <span class=\"title function_\">cleanUrl</span>(path)</span><br><span class=\"line\">          <span class=\"comment\">// can&#x27;t use querySelector with `[href*=]` here since the link may be</span></span><br><span class=\"line\">          <span class=\"comment\">// using relative paths so we need to use link.href to grab the full</span></span><br><span class=\"line\">          <span class=\"comment\">// URL for the include check.</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> el = <span class=\"title class_\">Array</span>.<span class=\"title function_\">from</span>(</span><br><span class=\"line\">            <span class=\"variable language_\">document</span>.<span class=\"property\">querySelectorAll</span>&lt;<span class=\"title class_\">HTMLLinkElement</span>&gt;(<span class=\"string\">&#x27;link&#x27;</span>),</span><br><span class=\"line\">          ).<span class=\"title function_\">find</span>(</span><br><span class=\"line\">            <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span></span><br><span class=\"line\">              !outdatedLinkTags.<span class=\"title function_\">has</span>(e) &amp;&amp; <span class=\"title function_\">cleanUrl</span>(e.<span class=\"property\">href</span>).<span class=\"title function_\">includes</span>(searchUrl),</span><br><span class=\"line\">          )</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (!el) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">const</span> newPath = <span class=\"string\">`<span class=\"subst\">$&#123;base&#125;</span><span class=\"subst\">$&#123;searchUrl.slice(<span class=\"number\">1</span>)&#125;</span><span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">            searchUrl.includes(<span class=\"string\">&#x27;?&#x27;</span>) ? <span class=\"string\">&#x27;&amp;&#x27;</span> : <span class=\"string\">&#x27;?&#x27;</span></span></span></span><br><span class=\"line\"><span class=\"subst\"><span class=\"string\">          &#125;</span>t=<span class=\"subst\">$&#123;timestamp&#125;</span>`</span></span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// rather than swapping the href on the existing tag, we will</span></span><br><span class=\"line\">          <span class=\"comment\">// create a new link tag. Once the new stylesheet has loaded we</span></span><br><span class=\"line\">          <span class=\"comment\">// will remove the existing link tag. This removes a Flash Of</span></span><br><span class=\"line\">          <span class=\"comment\">// Unstyled Content that can occur when swapping out the tag href</span></span><br><span class=\"line\">          <span class=\"comment\">// directly, as the new stylesheet has not yet been loaded.</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> newLinkTag = el.<span class=\"title function_\">cloneNode</span>() <span class=\"keyword\">as</span> <span class=\"title class_\">HTMLLinkElement</span></span><br><span class=\"line\">            newLinkTag.<span class=\"property\">href</span> = <span class=\"keyword\">new</span> <span class=\"title function_\">URL</span>(newPath, el.<span class=\"property\">href</span>).<span class=\"property\">href</span></span><br><span class=\"line\">            <span class=\"keyword\">const</span> <span class=\"title function_\">removeOldEl</span> = (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">              el.<span class=\"title function_\">remove</span>()</span><br><span class=\"line\">              <span class=\"variable language_\">console</span>.<span class=\"title function_\">debug</span>(<span class=\"string\">`[vite] css hot updated: <span class=\"subst\">$&#123;searchUrl&#125;</span>`</span>)</span><br><span class=\"line\">              <span class=\"title function_\">resolve</span>()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            newLinkTag.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;load&#x27;</span>, removeOldEl)</span><br><span class=\"line\">            newLinkTag.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;error&#x27;</span>, removeOldEl)</span><br><span class=\"line\">            outdatedLinkTags.<span class=\"title function_\">add</span>(el)</span><br><span class=\"line\">            el.<span class=\"title function_\">after</span>(newLinkTag)</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      )</span><br><span class=\"line\">      <span class=\"title function_\">notifyListeners</span>(<span class=\"string\">&#x27;vite:afterUpdate&#x27;</span>, payload)</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br><span class=\"line\"><span class=\"keyword\">case</span> <span class=\"string\">&#x27;full-reload&#x27;</span>:</span><br><span class=\"line\">      <span class=\"title function_\">notifyListeners</span>(<span class=\"string\">&#x27;vite:beforeFullReload&#x27;</span>, payload)</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (payload.<span class=\"property\">path</span> &amp;&amp; payload.<span class=\"property\">path</span>.<span class=\"title function_\">endsWith</span>(<span class=\"string\">&#x27;.html&#x27;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// if html file is edited, only reload the page if the browser is</span></span><br><span class=\"line\">        <span class=\"comment\">// currently on that page.</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> pagePath = <span class=\"built_in\">decodeURI</span>(location.<span class=\"property\">pathname</span>)</span><br><span class=\"line\">        <span class=\"keyword\">const</span> payloadPath = base + payload.<span class=\"property\">path</span>.<span class=\"title function_\">slice</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (</span><br><span class=\"line\">          pagePath === payloadPath ||</span><br><span class=\"line\">          payload.<span class=\"property\">path</span> === <span class=\"string\">&#x27;/index.html&#x27;</span> ||</span><br><span class=\"line\">          (pagePath.<span class=\"title function_\">endsWith</span>(<span class=\"string\">&#x27;/&#x27;</span>) &amp;&amp; pagePath + <span class=\"string\">&#x27;index.html&#x27;</span> === payloadPath)</span><br><span class=\"line\">        ) &#123;</span><br><span class=\"line\">          location.<span class=\"title function_\">reload</span>()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        location.<span class=\"title function_\">reload</span>()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">break</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"3-viteçš„å¿«ä¸æ…¢\">3 viteçš„å¿«ä¸æ…¢<a title=\"#3-viteçš„å¿«ä¸æ…¢\" href=\"#3-viteçš„å¿«ä¸æ…¢\"></a></h2>\n<blockquote>\n<p>å†·å¯åŠ¨ã€çƒ­æ›´æ–°</p>\n<p>é¦–å±æ¸²æŸ“ã€æ‡’åŠ è½½</p>\n</blockquote>\n<h3 id=\"3.1-viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ\">3.1 viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ<a title=\"#3.1-viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ\" href=\"#3.1-viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ\"></a></h3>\n<p>viteç»™äººçš„ç¬¬ä¸€å°è±¡å°±æ˜¯å¿«ï¼Œå¿«é€Ÿçš„æ„å»ºï¼Œå¿«é€Ÿçš„çƒ­æ›´æ–°ï¼Œå¤§å¹…åº¦çš„æå‡äº†å‰ç«¯å¼€å‘çš„æ•ˆç‡ã€‚è€Œè¿™ä¸»è¦å½’åŠŸäºï¼š1ï¼‰åŸºäºæµè§ˆå™¨æ”¯æŒESçš„å®ç° 2ï¼‰é«˜æ€§èƒ½å¼•æ“ESBuild</p>\n<p><strong>ä¸€ã€åŸºäºæµè§ˆå™¨æ”¯æŒESçš„å®ç°</strong></p>\n<p><strong>äºŒã€é«˜æ€§èƒ½å¼•æ“ESBuild</strong></p>\n<h3 id=\"3.2-viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ\">3.2 viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ<a title=\"#3.2-viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ\" href=\"#3.2-viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ\"></a></h3>\n<p>æˆä¹Ÿè§ä½•ï¼Œè´¥ä¹Ÿè§ä½•ã€‚å› ä¸ºä¼ ç»Ÿæ„å»ºå·¥å…·çš„æ‰“åŒ…å·¥ä½œäº¤ç»™äº†æµè§ˆå™¨å¤„ç†ï¼Œå› æ­¤åœ¨é¡µé¢æ‰“å¼€æ—¶éœ€è¦å¤§é‡çš„åŠ è½½httpè¯·æ±‚ï¼Œå¯¼è‡´äº†viteæ„å»ºå¼€å‘ç¯å¢ƒä¸‹çš„äº§ç‰©é¦–å±æ¸²æŸ“å’Œæ‡’åŠ è½½ä¼šå¾ˆæ…¢ã€‚ç„¶è€Œviteåœ¨æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒçš„äº§ç‰©æ—¶ä½¿ç”¨çš„rollupï¼Œå› æ­¤ä¸ä¼šå­˜åœ¨é¦–å±æ¸²æŸ“å’Œæ‡’åŠ è½½çš„é—®é¢˜ã€‚æ‰€ä»¥ç›¸æ¯”viteå¸¦æ¥çš„æé€Ÿæ„å»ºé€Ÿåº¦ï¼Œé¦–å±æ¸²æŸ“å’Œæ‡’åŠ è½½å¸¦æ¥çš„é—®é¢˜æ˜¾å¾—â€œå¾®ä¸è¶³é“â€ï¼Œè€Œä¸”é’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œä¸šç•Œä¹Ÿæœ‰äº†å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p>\n<h2 id=\"4-viteæ’ä»¶å¼€å‘\">4 viteæ’ä»¶å¼€å‘<a title=\"#4-viteæ’ä»¶å¼€å‘\" href=\"#4-viteæ’ä»¶å¼€å‘\"></a></h2>\n<h2 id=\"å‚è€ƒæ–‡ç« \">å‚è€ƒæ–‡ç« <a title=\"#å‚è€ƒæ–‡ç« \" href=\"#å‚è€ƒæ–‡ç« \"></a></h2>\n<p><a href=\"https://juejin.cn/post/7068273153952186398#heading-7\" target=\"_blank\">è¯¦è°ˆå‰ç«¯æ¨¡å—åŒ–è¿™åå››å¹´çš„å‘å±•å²ï¼šCommonJSã€AMDã€CMDã€ES6</a></p>\n<p><a href=\"https://juejin.cn/book/7050063811973218341/section/7050063812044685343\" target=\"_blank\">æ·±å…¥æµ…å‡º Vite</a></p>\n<p><a href=\"https://juejin.cn/post/7129041114174062628\" target=\"_blank\">æ¼«è°ˆæ„å»ºå·¥å…·(å››): ä¸ºä»€ä¹ˆæœ‰äººè¯´ vite å¿«ï¼Œæœ‰äººå´è¯´ vite æ…¢ï¼Ÿ</a></p>\n<p><a href=\"https://juejin.cn/post/7067827608842403848#heading-3\" target=\"_blank\">ååˆ†é’Ÿå¸¦ä½ äº†è§£viteæ’ä»¶å¼€å‘</a></p>\n<p><a href=\"https://juejin.cn/post/6968793122029436959#heading-3\" target=\"_blank\">viteæºç åˆ†æ(4) :vite çƒ­æ›´æ–°åŸç†åˆ†æ</a></p>\n","next":{"title":"2023å¹´åº¦è®¡åˆ’","link":"2023/05/15/2023å¹´åº¦è®¡åˆ’"},"plink":"http://example.com/2023/05/16/viteæ ¸å¿ƒåŸç†ï¼ˆä¸Šï¼‰/","toc":[{"id":"1-æ¨¡å—åŒ–","title":"1 æ¨¡å—åŒ–","index":"1"},{"id":"2-viteçš„ä½¿ç”¨","title":"2 viteçš„ä½¿ç”¨","index":"2","children":[{"id":"2.1-çƒ­æ›´æ–°","title":"2.1 çƒ­æ›´æ–°","index":"2.1"}]},{"id":"3-viteçš„å¿«ä¸æ…¢","title":"3 viteçš„å¿«ä¸æ…¢","index":"3","children":[{"id":"3.1-viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ","title":"3.1 viteä¸ºä»€ä¹ˆå¿«ï¼Ÿ","index":"3.1"},{"id":"3.2-viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ","title":"3.2 viteä¸ºä»€ä¹ˆæ…¢ï¼Ÿ","index":"3.2"}]},{"id":"4-viteæ’ä»¶å¼€å‘","title":"4 viteæ’ä»¶å¼€å‘","index":"4"},{"id":"å‚è€ƒæ–‡ç« ","title":"å‚è€ƒæ–‡ç« ","index":"5"}],"reading_time":"3524 words in 23 min"}